!function(){"use strict";function t(t,n){return{x:t||0,y:n||0}}const n=(t,n)=>(t.x=n.x,t.y=n.y,t),e=(t,n,e)=>(t.x=n,t.y=e,t),o=(t,n,e)=>(t.x=n.x+e.x,t.y=n.y+e.y,t),c=(t,n,e)=>(t.x=n.x-e.x,t.y=n.y-e.y,t),s=(t,n)=>t.x*n.x+t.y*n.y,r=(t,n,e)=>(t.x=n.x*e,t.y=n.y*e,t),i=(t,n)=>{const e=t.x-n.x,o=t.y-n.y;return Math.sqrt(e*e+o*o)},a=t=>{const n=t.x,e=t.y;return Math.sqrt(n*n+e*e)},u=(t,n)=>{const e=n.x,o=n.y;let c=e*e+o*o;return c>0&&(c=1/Math.sqrt(c),t.x=n.x*c,t.y=n.y*c),t},h=(t,n)=>{t.t.x+=t.o.x*n*n*.001,t.t.y+=t.o.y*n*n*.001,e(t.o,0,0)},l=t(),f=t(),p=t(),w=t(),d=t(),v=t(),M=t(),g=t(),y=t(),x=t(),b=t(),m=t(),k=t(),S=t(),T=(i,h,T,A,L,C,O,R,D,H,N,P,I,E,K)=>{e(l,0,0),e(f,0,0),e(p,0,0),e(w,0,0),e(d,0,0),e(v,0,0),e(M,0,0),e(g,0,0),e(y,0,0),e(x,0,0),e(b,0,0),e(m,0,0),e(k,0,0),e(S,0,0),!I||0===I.x&&0===I.y?(c(l,i,O),u(l,l)):e(l,I.x,I.y),r(f,l,-1);const W=T+D,j=1+(A>H?A:H);c(p,i,h);const F=s(l,p);r(w,l,F),c(d,p,w),c(v,O,R);const $=s(f,v);r(M,f,$),c(g,v,M),r(b,w,(T-D)/W),r(m,M,j*D/W),o(y,b,m),o(y,y,d),r(k,w,j*T/W),r(S,M,(D-T)/W),o(x,k,S),o(x,x,g);const G=o(t(),y,x),B=t();r(B,l,s(G,l));const U=c(t(),G,B);u(U,U);let Y=-s(G,U);Y/=1/(T+D);const q=Math.abs(Y);if(q>1e-4){const n=a(d),e=a(g),c=t(),s=t();r(c,U,q<n*L?L:-n*C),r(s,U,q<e*N?N:-e*P),o(y,y,c),o(x,x,s)}n(E,y),n(K,x)},A=t=>{const n=2*t.t.x-t.i.x,o=2*t.t.y-t.i.y;e(t.i,t.t.x,t.t.y),e(t.t,n,o)},L=t(),C=t();function O(t,n,e,o,s){c(L,n,t),c(C,o,e);const r=(-L.y*(t.x-e.x)+L.x*(t.y-e.y))/(-C.x*L.y+L.x*C.y),i=(C.x*(t.y-e.y)-C.y*(t.x-e.x))/(-C.x*L.y+L.x*C.y);return r>=0&&r<=1&&i>=0&&i<=1&&(s.x=t.x+i*L.x,s.y=t.y+i*L.y,!0)}const R=t(),D=t(),H=t(),N=t(),P=t(),I=t();const E=t(),K=t();function W(t,n,o,r){if(c(E,o,n),0===E.x&&0===E.y)throw new Error("ZeroLengthEdge");const a=((t.x-n.x)*E.x+(t.y-n.y)*E.y)/(E.x*E.x+E.y*E.y);r.u=a;const h=e(r.h,n.x+a*E.x,n.y+a*E.y);r.l=i(h,t);const l=((t,n,e)=>(t.y=e.x-n.x,t.x=n.y-e.y,u(t,t)))(r.p,n,o);c(K,t,h),r.v=s(l,K)}function j(t){return t&&"object"==typeof t&&"number"==typeof t.id}class F{constructor(t){this.M=t,this.g=F.hash(this.M),this.m=new Set}k(t){this.m.add(t)}S(t,n){const e=n.map(t=>t.T);this.M.every(t=>e.indexOf(t)>-1)&&!this.m.has(t)&&this.m.add(t)}A(t,n){const e=n.map(t=>t.T);this.M.every(t=>e.indexOf(t)>-1)&&this.m.has(t)&&this.m.delete(t)}static hash(t){return t.slice().sort().join("|")}}const $=33.3333333,G=new class{constructor(){this.L=1,this.m=new Map,this.C=new Map,this.O=new Set}R(t){const n={id:this.L++};return this.m.set(n,t),this.C.forEach(e=>e.S(n,t)),n}D(t){this.O.add(t)}H(t){return this.O.has(t)}N(){if(0===this.O.size)return;let t=!1;const n=e=>{e&&"object"==typeof e&&!j(e)&&Object.values(e).forEach(e=>{j(e)?(this.D(e),t=!0):n(e)})};this.O.forEach(t=>{if(this.O.delete(t),!this.m.has(t))return;const e=this.m.get(t);e.forEach(t=>{n(t)}),this.m.delete(t),this.C.forEach(n=>n.A(t,e))}),t&&this.N()}select(t){const n=F.hash(t);if(this.C.has(n))return this.C.get(n).m;const e=new F(t);return this.C.set(e.g,e),this.m.forEach((n,o)=>{let c=!0;for(let e=0;e<t.length;e++){const o=t[e];n.find(t=>t.T===o)||(c=!1)}c&&e.k(o)}),e.m}P(t){return this.select(t).values().next().value}data(t,n){const e=this.m.get(t);let o;for(let t=0;t<e.length;t++){const c=e[t];c.T===n&&(o=c)}return o}I(t){const n=this.P([t]);if(!n)return;return this.data(n,t)}};function B(){return G}function U(t,n,e){const o=e.getContext("2d"),c=window.devicePixelRatio||1;return e.style.width=t+"px",e.style.height=n+"px",e.width=Math.floor(t*c),e.height=Math.floor(n*c),o.scale(c,c),o.webkitImageSmoothingEnabled=!1,o.msImageSmoothingEnabled=!1,o.mozImageSmoothingEnabled=!1,o.imageSmoothingEnabled=!1,{width:t,height:n,K:e,W:o,j:c}}const Y=document.querySelector.bind(document),q=Y("#r"),z=Y("#c"),Z=Y("#u");if(!q||!z||!Z)throw new Error("Could not locate DOM!");function J(t,n,e,o){return t.addEventListener(n,e,o),()=>{t.removeEventListener(n,e,o)}}const Q="transparent",V="rgba(255,255,132,1)",X="rgba(255,255,132,0.5)",_="rgba(40,40,40,1)",tt=56,nt="Arial, sans-serif",et="Courier, Courier New, monospace";function ot(n=0,e=0){return t(n,e)}function ct(t){const n=B().I("vp"),e=n.F;return t/n.$*e.width}function st(t,n){const e=B().I("vp"),{G:o}=e;return ct(t-("x"===n?o.target.x:o.target.y))}const rt=t=>t/B().I("vp").F.width*100;function it(){const t=B().I("vp"),{W:n}=t.F;n.save(),function(t){const{W:n}=t.F,{G:e}=t;n.scale(1,-1),n.translate(-ct(e.B.x),-ct(e.B.y))}(t),n.clearRect(0,0,t.F.K.width,t.F.K.height),n.restore()}function at(t,n,e,c,s,r="transparent",i=nt){const a=B().I("vp"),{G:u}=a,h=ot();return h.x=u.target.x-u.B.x,h.y=u.target.y+u.B.y,o(h,h,n),ut(t,h,e,c,s,r,i)}function ut(t,n,e,o,c,s="transparent",r=nt){const i=B().I("vp"),{G:a}=i,{W:u}=i.F;u.save(),u.scale(1,-1);const{U:h,font:l}=ht(t,o,r);let f=0,p=ct(-n.y+a.target.y);return u.font=l,t.split("\n").forEach((t,o)=>{const r=u.measureText(t).width+1,i=ct(h);0===o&&(p+=i);const a="center"===e?st(n.x,"x")-r/2:"left"===e?st(n.x,"x"):st(n.x,"x")-r;"transparent"!==s&&(u.fillStyle=s,u.fillRect(a,p,r,-i)),u.fillStyle=c,u.fillText(t,a,p),p+=i,f+=i}),u.restore(),rt(f)}function ht(t,n,e=nt){const o=B().I("vp"),{W:c}=o.F,s=o.height/n;c.save();const r=`${s}px/1.2 ${e}`;c.font=r;const i=c.measureText(t),a=1.2*(i.actualBoundingBoxAscent?i.actualBoundingBoxAscent+i.actualBoundingBoxDescent:s);c.restore();const u=t.split("\n");return{font:r,total:rt(a*u.length),Y:1.2,U:rt(a)}}function lt(){const t=window.innerWidth<window.innerHeight?window.innerWidth:.6*window.innerHeight,n=window.innerWidth<window.innerHeight?window.innerWidth/.6:window.innerHeight;return{T:"vp",ratio:.6,width:t,height:n,$:100,q:100/.6,F:U(t,n,z),G:{B:ot(50,50),mode:"center",target:ot(0,0)}}}function ft(){const t=lt(),n=B(),e=n.P(["vp"]);e&&n.D(e);q.style.width=t.width+"px";const o=n=>Math.floor(n/t.$*t.F.width);t.F.W.translate(o(t.G.B.x),o(t.G.B.y)),t.F.W.scale(1,-1);const c=[t];n.R(c)}function pt(t,n,e,o){const c=n.x-e.x,s=n.y-e.y,r=Math.sin(o),i=Math.cos(o);return t.x=c*i-s*r+e.x,t.y=c*r+s*i+e.y,t}function wt(){return{l:0,v:0,u:0,h:t(),p:t()}}window.addEventListener("resize",ft);const dt=t(),vt=t(),Mt=t();function gt(t,n,e){return c(dt,n.t,n.i),u(vt,dt),r(Mt,vt,e),o(t,Mt,n.t),t}function yt(t){return Math.atan2(t.y,t.x)}function xt(t,n){const{width:e,height:c}=function(t){return{width:t.$,height:Math.min(.75*t.$,.75*t.q)}}(n),s=t.width/2,i=t.height/2,a=n.G.target,u=ot(Math.cos(t.Z),Math.sin(t.Z)),h=r(ot(),u,Math.min(e/2,c/2)),l=o(ot(),a,h),f=ot(l.x,l.y-s),p=ot(l.x,l.y+s);return pt(f,f,l,t.Z),pt(p,p,l,t.Z),{x:l.x,y:l.y,angle:t.Z,J:s,V:i,X:f,p1:p}}function bt(t,e,s,i){h(t,i);const{X:a,p1:u,V:l}=xt(e,s),f={_:a,tt:u},p=t,w=l,d=wt();W(p.t,f._,f.tt,d);const v=n(ot(),d.h),M=c(ot(),e.nt.t,e.nt.i),g=c(ot(),v,M),y=2+w;if(d.u>=0&&d.u<=1&&d.l<=y){const t=1,n=1e7,e=.5,s=.87,i=.87,a=ot(),u=ot();T(p.t,p.i,t,e,s,i,v,g,n,e,s,i,d.p,a,u),c(p.i,p.t,a);const h=Math.abs(y-d.l);((t,...n)=>{for(let e=0;e<n.length;e++){const c=n[e];o(c,c,t)}})(r(ot(),d.p,d.v>0?h:-h),p.t,p.i)}A(t)}const mt=new URLSearchParams(window.location.search).get("seed"),kt=mt?Number(mt):Date.now(),St=(At=61^(At=kt)^At>>>16,At+=At<<3,At=Math.imul(At,668265261),Tt=(At^=At>>>15)>>>0,t=>(Tt=Tt+1831565813|0,(((t=(t=Math.imul(Tt^Tt>>>15,1|Tt))+Math.imul(t^t>>>7,61|t)^t)^t>>>14)>>>0)/2**32));var Tt,At;const Lt=()=>St();function Ct(){const t=B().I("vp"),{G:n,F:{W:e}}=t;e.fillStyle=_,e.fillRect(st(n.target.x-n.B.x,"x"),st(n.target.y+n.B.y,"y"),ct(2*n.B.x),ct(2*-n.B.y))}let Ot;function Rt(){const t=B().I("vp"),{G:n}=t,e=2*n.B.x,o=2*n.B.y;if(!Ot){const n=document.createElement("canvas"),c=n.getContext("2d");Ot=U(ct(2*t.G.B.x),ct(2*t.G.B.y),n);const s=.1,r=.3,i=2*t.G.B.y*8;c.fillStyle=X;let a=0;for(;a<i;){const t=Lt()*e,n=Lt()*o,i=Lt()*(r-s)+s;c.beginPath(),c.arc(ct(t),ct(n),ct(i),0,2*Math.PI,!1),c.fill(),a++}}const c=n.target.x/e,s=n.target.y/o,r=Math.floor(c),i=Math.floor(s);let a=n.target.x%e/e,u=n.target.y%o/o;a=n.target.x<0?1-Math.abs(a):a,u=n.target.y<0?1-Math.abs(u):u;const h=t.F.W;Ct(),h.drawImage(Ot.K,0,0,ct(e),ct(o),st(r*e,"x"),st(i*o,"y"),ct(e),ct(o)),a<.5&&h.drawImage(Ot.K,0,0,ct(e),ct(o),st((r-1)*e,"x"),st(i*o,"y"),ct(e),ct(o)),a>=.5&&h.drawImage(Ot.K,0,0,ct(e),ct(o),st((r+1)*e,"x"),st(i*o,"y"),ct(e),ct(o)),u<.5&&h.drawImage(Ot.K,0,0,ct(e),ct(o),st(r*e,"x"),st((i-1)*o,"y"),ct(e),ct(o)),u>=.5&&h.drawImage(Ot.K,0,0,ct(e),ct(o),st(r*e,"x"),st((i+1)*o,"y"),ct(e),ct(o)),a<.5&&u<.5&&h.drawImage(Ot.K,0,0,ct(e),ct(o),st((r-1)*e,"x"),st((i-1)*o,"y"),ct(e),ct(o)),a>=.5&&u<.5&&h.drawImage(Ot.K,0,0,ct(e),ct(o),st((r+1)*e,"x"),st((i-1)*o,"y"),ct(e),ct(o)),a<.5&&u>=.5&&h.drawImage(Ot.K,0,0,ct(e),ct(o),st((r-1)*e,"x"),st((i+1)*o,"y"),ct(e),ct(o)),a>=.5&&u>=.5&&h.drawImage(Ot.K,0,0,ct(e),ct(o),st((r+1)*e,"x"),st((i+1)*o,"y"),ct(e),ct(o))}function Dt(t,n,e){if(!e.et)return;const o=ot(),c=O(gt(ot(),t,n),t.i,e._,e.tt,o),s=wt();W(t.i,e._,e.tt,s),c&&s.v<0&&(e.et=!1)}function Ht(t,n,e){if(e.et)return;const s=ot(),i=O(gt(ot(),t,n),t.i,e._,e.tt,s),a=wt();if(W(t.i,e._,e.tt,a),i&&a.v>0){h=t,l=n,f={t:e._,i:e._,o:ot()},p={t:e.tt,i:e.tt,o:ot()},c(H,h.t,h.i),u(N,H),r(P,N,l),o(I,P,h.t),O(I,h.i,f.t,p.t,R)&&(c(D,I,R),c(h.t,h.t,D),c(h.i,h.i,D));const i=1,w=1e7,d=1,v=0,M=0,g=ot(),y=ot();T(t.t,t.i,i,d,v,M,s,s,w,d,v,M,a.p,g,y),c(t.i,t.t,g)}var h,l,f,p}function Nt(t=ot(0,0)){const e=B().I("vp");return{Z:0,width:e.$/2,height:e.$/16,nt:{o:ot(),t:n(ot(),t),i:n(ot(),t)}}}function Pt(t=ot(),e=0,o=ot()){const s=B().I("vp"),i={t:n(ot(),t),i:n(ot(),t),o:ot(),width:s.$/32,height:s.$/32},a=r(ot(),o,e);return c(i.i,i.t,a),i}function It(t){return{nt:{t:n(ot(),t),i:n(ot(),t),o:ot()},ot:ot(10,10)}}function Et(t,n){return{_:t,tt:n,et:!1}}const Kt={ct:0,st:null,state:"boot",level:-1,rt:null,it:[],at:[function(){return{ut:Pt(ot(),.1,ot(1,1)),ht:Nt(),target:It(ot(-10,-10)),lt:[Et(ot(50,50),ot(-50,50)),Et(ot(-50,50),ot(-50,-50)),Et(ot(-50,-50),ot(50,-50)),Et(ot(50,-50),ot(50,50))],ft:[]}},function(){return{ut:Pt(ot(0,-10),.5,ot(0,1)),ht:Nt(),target:It(ot(30,10)),lt:[Et(ot(20,15),ot(-20,15)),(t=ot(-20,5),n=ot(20,5),{_:t,tt:n,et:!0}),Et(ot(50,50),ot(-50,50)),Et(ot(-50,50),ot(-50,-50)),Et(ot(-50,-50),ot(50,-50)),Et(ot(50,-50),ot(50,50))],ft:[]};var t,n},function(){const t=Nt();return{ut:Pt(ot(-30,-40),.5,ot(0,1)),ht:t,target:It(ot(30,-40)),lt:[Et(ot(50,50),ot(-50,50)),Et(ot(-50,50),ot(-50,-50)),Et(ot(-50,-50),ot(50,-50)),Et(ot(50,-50),ot(50,50))],ft:[(e=ot(-20,10),o=ot(1,-1),{nt:{t:n(ot(),e),i:n(ot(),e),o:ot()},ot:ot(10,10),wt:n(ot(),o)})]};var e,o}]};function Wt(t){const n=Kt;n.st=n.state,n.state=t,n.ct=0}function jt(t){return t*$/1e3}function Ft(t){return t.toFixed(3)}const $t={KeyW:!1,KeyA:!1,KeyS:!1,KeyD:!1,ArrowLeft:!1,ArrowRight:!1,ShiftLeft:!1,ShiftRight:!1};function Gt(){return $t}function Bt(t,n,e,o){const c=B().I("vp"),s=c.G.target,{B:r}=c.G,a=[[ot(s.x-r.x,s.y+r.y),ot(s.x+r.x,s.y+r.y),wt()],[ot(s.x+r.x,s.y+r.y),ot(s.x+r.x,s.y-r.y),wt()],[ot(s.x+r.x,s.y-r.y),ot(s.x-r.x,s.y-r.y),wt()],[ot(s.x-r.x,s.y-r.y),ot(s.x-r.x,s.y+r.y),wt()]];for(let n=0;n<a.length;n++){const[e,o,c]=a[n];W(t,e,o,c)}const[[u,h,l],[f,p,w],[d,v,M],[g,y,x]]=a;let b,m,k;const S=ht(o,tt);if(l.v>0&&w.v>0)b=ot(w.h.x,l.h.y),m=i(b,t),k="right";else if(w.v>0&&M.v>0)b=ot(w.h.x,M.h.y+S.U),m=i(b,t),k="right";else if(M.v>0&&x.v>0)b=ot(x.h.x,M.h.y+S.U),m=i(b,t),k="left";else if(x.v>0&&l.v>0)b=ot(x.h.x,l.h.y),m=i(b,t),k="left";else if(l.v>0)b=ot(Math.min(Math.max(l.h.x,u.x),h.x),l.h.y),m=l.l,k="center";else if(w.v>0)b=ot(w.h.x,Math.max(Math.min(f.y,w.h.y),p.y)),m=w.l,k="right";else if(M.v>0)b=ot(Math.max(Math.min(d.x,M.h.x),v.x),M.h.y+S.U),m=M.l,k="center";else{if(!(x.v>0))return;b=ot(x.h.x,Math.min(Math.max(g.y,x.h.y),y.y)),m=x.l,k="left"}if(m<.7*((n.x/2+n.y/2)/2))return;const T=c.F.W;T.save(),ut(o,b,k,tt,_,V),T.restore()}J(window,"keydown",t=>{$t[t.code]=!0}),J(window,"keyup",t=>{$t[t.code]=!1});function Ut(t,n){return!!((t,n,o,c,s,r,i,a,u)=>{const h=s-t,l=i/2+o/2-Math.abs(h),f=r-n,p=a/2+c/2-Math.abs(f);if(l<=0)return null;if(p<=0)return null;if(e(u.resolve,0,0),e(u.dt,0,0),e(u.vt,0,0),l<p){const n=h<0?-1:1;u.resolve.x=l*n,u.vt.x=n,u.dt.x=t+o/2*n,u.dt.y=r}else{const t=f<0?-1:1;u.resolve.y=p*t,u.vt.y=t,u.dt.x=s,u.dt.y=n+c/2*t}return u})(t.nt.t.x,t.nt.t.y,t.ot.x,t.ot.y,n.t.x,n.t.y,n.width,n.height,{resolve:ot(),dt:ot(),vt:ot()})}let Yt=0,qt=[];const zt=()=>{Yt=0,qt.length=0},Zt=B(),Jt=Zt.R([{T:"fps",Mt:60}]),Qt=t=>{at(t.I("fps").Mt.toFixed(2),ot(100,0),"right",tt,V)};function Vt(t){Zt.data(Jt,"fps").Mt=t}function Xt(t){const n=B().I("vp"),e=n.F.W,{x:o,y:c}=t.nt.t,s=t.ot.x/2,r=t.ot.x/4,i=n.$/64,a=t.ot.y/i,u=s*Math.SQRT2,h=i*Math.SQRT2/2;e.save(),e.fillStyle=V,e.strokeStyle=V;const l=yt(t.wt);e.translate(st(o,"x"),st(c,"y")),e.rotate(l-Math.PI/2),_t(e,a,i,u,0,0-r+h,Math.PI/4),_t(e,a,i,u,0,0+r-h,-Math.PI/4),e.restore()}function _t(t,n,e,o,c,s,r){for(let i=0;i<n;i+=2){t.save(),t.translate(ct(s),ct(c+i*e)),t.rotate(r);(i<Math.floor(n/4)?t.strokeRect:t.fillRect).call(t,ct(0-o/2),ct(0),ct(o),ct(e)),t.restore()}}function tn(t,o){const c=o.nt.t,s=(o.ot.y,o.ot.x/2),r=ot(c.x,c.y+s),i=ot(c.x,c.y-s),a=yt(o.wt);pt(r,r,c,a),pt(i,i,c,a);const u=ot(),h=O(t.i,t.t,r,i,u),l=wt();W(t.i,r,i,l),h&&l.v<0&&(n(t.t,o.nt.t),n(t.i,t.t),e(t.o,5*o.wt.x,5*o.wt.y))}function nn(){}!async function(){await async function(){}();const t=B();ft();const e=[],s=[];e.push(t=>{it()});const i=t.I("vp");e.push((function(t,n){switch(Kt.state){case"boot":{Rt();let t=10;t-=ut("SIGNAL DECAY",ot(0,t),"center",20,V,Q,et),t-=5,ut("a js13k entry by\nDrew Petersen",ot(0,t),"center",tt,V),t-=20,ut("TAP OR CLICK TO START",ot(0,t),"center",tt,V,Q,et);break}case"tutorial":{Ct();let t=50;const n=-45;t-=5,t-=ut(["Be the best signalmancer in the galaxy!","","Help messages from deep space colonies bounce their","way to their targets as quickly as possible."].join("\n"),ot(n,t),"left",tt,V),t-=5,t-=ut("CONTROLS (KEYBOARD)",ot(n,t),"left",tt,V,Q,et),t-=5,t-=ut(["WASD:  move","Hold any SHIFT to boost","","Arrow Left / Arrow Right: rotate the Deflector"].join("\n"),ot(n,t),"left",tt,V),t-=5,t-=ut("CONTROLS (TOUCH)",ot(n,t),"left",tt,V,Q,et),t-=5,t-=ut(["Left Stick:  move","Move stick and hold BOOST to boost","","Right Stick: rotate the Deflector"].join("\n"),ot(n,t),"left",tt,V),t-=5,t-=ut("TAP OR CLICK TO CONTINUE",ot(0,t),"center",tt,V,Q,et);break}case"level":{if(!Kt.rt)break;const{target:t,ht:n,ut:e,lt:o,ft:s}=Kt.rt;Rt(),function(t,n){const e=B().I("vp").F.W,{x:o,y:c}=t.nt.t,s=t.ot.x/2,r=t.ot.y/2;e.save(),e.fillStyle=V,e.translate(st(o,"x"),st(c,"y")),e.fillRect(0-ct(s),0-ct(r),ct(t.ot.x),ct(t.ot.y)),e.restore()}(t),function(t){const n=B().I("vp"),e=n.F.W,{x:o,y:c,angle:s,V:r,J:i,X:a,p1:u}=xt(t,n);e.save(),e.fillStyle=V,e.translate(st(o,"x"),st(c,"y")),e.rotate(Math.PI/2+s),e.fillRect(0-ct(i),0-ct(r),ct(t.width),ct(t.height)),e.restore()}(n),function(t,n){const e=B().I("vp"),o=e.F.W,{t:s,i:i,width:h,height:l}=t,f=h/2,p=l/2,w=st(i.x+1*(s.x-i.x),"x"),d=st(i.y+1*(s.y-i.y),"y"),v=ct(h),M=ct(l);o.save();{const t=c(ot(),s,i),n=u(t,t),a=r(n,n,10*e.$);o.lineWidth=ct(1),o.strokeStyle=X,o.setLineDash([ct(1),ct(3)]),o.beginPath(),o.moveTo(w,d),o.lineTo(w+ct(a.x),d+ct(a.y)),o.stroke(),o.setLineDash([])}{const t=f/8,n=c(ot(),s,i),e=a(n)/t,h=u(n,n);o.fillStyle="rgba(255,255,132,0.1)";const l=ot();for(let n=0;n<e;n++)r(l,h,n*t),o.fillRect(w-ct(l.x)-ct(f),d-ct(l.y)-ct(p),v,M)}o.fillStyle=V,o.fillRect(w-ct(f),d-ct(p),v,M),o.restore()}(e),function(t){for(let n=0;n<t.length;n++)Xt(t[n])}(s),function(t){const{F:{W:n}}=B().I("vp");n.save(),n.strokeStyle=V,n.lineWidth=ct(1);for(let e=0;e<t.length;e++){const o=t[e];o.et?n.setLineDash([ct(1),ct(2)]):n.setLineDash([]),n.beginPath(),n.moveTo(st(o._.x,"x"),st(o._.y,"y")),n.lineTo(st(o.tt.x,"x"),st(o.tt.y,"y")),n.closePath(),n.stroke()}n.restore()}(o),function(t,n){const e=B().I("vp");at(Ft(jt(t.ct)),ot(e.$/2,0),"center",tt,V),at(`Level ${t.level+1} of ??`,ot(0,0),"left",tt,V),t.rt&&(Bt(t.rt.target.nt.t,t.rt.target.ot,0,"TARGET"),Bt(t.rt.ut.t,ot(t.rt.ut.width,t.rt.ut.height),0,"SIGNAL"))}(Kt);break}case"win":{Ct();const n=t.I("vp");at(`Mission\nCompleted!\n${Ft(jt(Kt.it[Kt.level]))}s`,ot(n.$/2,-10),"center",15,V);break}case"nextlevel":break;case"thanks":Ct();at(`The SIGNAL\nmade it,\nthanks to you!\nTotal:\n${Ft(jt(Kt.it.reduce((t,n)=>t+=n,0)))}s`,ot(t.I("vp").$/2,-10),"center",15,V),console.log("thanks!");break}!function(t=_){const n=B().I("vp"),{W:e}=n.F;e.fillStyle=t;const o=2*n.G.B.x,c=n.q-2*n.G.B.y;e.fillRect(st(n.G.target.x-n.G.B.x,"x"),st(n.G.target.y-n.G.B.y,"y"),ct(o),ct(-c))}()})),s.push((t,e)=>{switch(Kt.state){case"boot":if(0===Kt.ct){const n=J(t.I("vp").F.K,"click",()=>{n(),zt(),Wt("tutorial")})}break;case"tutorial":if(0===Kt.ct){const n=J(t.I("vp").F.K,"click",()=>{n(),zt(),Wt("nextlevel")})}break;case"level":{if(0===Kt.ct){const t=Kt.at[Kt.level];if(!t)return Wt("thanks");Kt.rt=t()}if(!Kt.rt)break;const{target:t,ht:n,ut:e}=Kt.rt,c=Gt();c.ArrowLeft&&(n.Z+=.1),c.ArrowRight&&function(t){t.Z-=.1}(n);const s=c.ShiftLeft||c.ShiftRight?ot(1,0):ot(.2,0),r=ot();let i=0;if(c.KeyW&&c.KeyD?i=Math.PI/4:c.KeyW&&c.KeyA?i=Math.PI*(3/4):c.KeyS&&c.KeyD?i=-Math.PI/4:c.KeyS&&c.KeyA?i=-Math.PI*(3/4):c.KeyW?i=Math.PI/2:c.KeyA?i=Math.PI:c.KeyS?i=-Math.PI/2:c.KeyD&&(i=0),(0!==i||c.KeyD)&&function(t,n){o(t.nt.o,t.nt.o,n)}(n,pt(ot(),s,r,i)),Ut(t,e)){const t=Kt;return t.it[t.level]=t.ct,Wt("win")}break}case"win":0===Kt.ct&&(c=()=>Wt("nextlevel"),s=1e3,qt.push({id:++Yt,action:c,delay:s,gt:0}));break;case"nextlevel":{const t=Kt;return t.level+=1,t.rt=null,Wt("level")}}var c,s;if(!Kt.rt)return;const{target:r,ht:a,ut:u,lt:l,ft:f}=Kt.rt;r&&a&&u&&(((t,n)=>{const e=(t.i.x-t.t.x)*n,o=(t.i.y-t.t.y)*n;t.i.x=t.t.x+e,t.i.y=t.t.y+o})(a.nt,.8),h(a.nt,e),bt(u,a,i,e),function(t,n){for(let e=0;e<n.length;e++)tn(t,n[e])}(u,f),function(t,n){for(let e=0;e<t.length;e++){const o=t[e];Dt(n,n.width/2,o),Ht(n,n.width/2,o)}}(l,u),A(a.nt),function(t){const e=B().I("vp");n(e.G.target,t)}(a.nt.t)),Kt.ct+=1}),e.push(Qt);const{stop:l}=(({yt:t,xt:n,bt:e,update:o,kt:c=10,St:s=(()=>{}),Tt:r=(()=>{})})=>{const i=window.performance,a=t,u=n,h=i.now.bind(i),l=window.requestAnimationFrame.bind(window);let f=0,p=null,w=h(),d=h(),v=0,M=60;return function t(){const n=h();p=l(t),f+=n-w,w=n;let i=f-a>=0,g=Math.floor(f/u);if(g>=c)return f=0,w=h(),void s();for(;g-- >0;)f-=u,o(u);i&&e(f/a),v+=1,d+1e3<=n&&(M=.25*v+.75*M,v=0,d=n,r(M))}(),{stop:()=>{p&&cancelAnimationFrame(p)}}})({yt:16.6666666,xt:$,update:n=>{((t=1)=>{qt.slice().forEach((n,e)=>{n.gt+=t,n.gt>=n.delay&&(qt.splice(e,1),n.action(n.delay,n.gt))})})(n),s.forEach(e=>e(t,n)),t.N()},bt:n=>{e.forEach(e=>e(t,n))},St:nn,Tt:Vt})}()}();