!function(){"use strict";function t(t,n){return{x:t||0,y:n||0}}const n=(t,n)=>(t.x=n.x,t.y=n.y,t),e=(t,n,e)=>(t.x=n,t.y=e,t),o=(t,n,e)=>(t.x=n.x+e.x,t.y=n.y+e.y,t),r=(t,n,e)=>(t.x=n.x-e.x,t.y=n.y-e.y,t),c=(t,n)=>t.x*n.x+t.y*n.y,s=(t,n,e)=>(t.x=n.x*e,t.y=n.y*e,t),i=(t,n)=>{const e=t.x-n.x,o=t.y-n.y;return Math.sqrt(e*e+o*o)},a=t=>{const n=t.x,e=t.y;return Math.sqrt(n*n+e*e)},l=(t,n)=>{const e=n.x,o=n.y;let r=e*e+o*o;return r>0&&(r=1/Math.sqrt(r),t.x=n.x*r,t.y=n.y*r),t},u=(t,n)=>{t.t.x+=t.o.x*n*n*.001,t.t.y+=t.o.y*n*n*.001,e(t.o,0,0)},f=t(),h=t(),d=t(),p=t(),w=t(),v=t(),g=t(),M=t(),y=t(),x=t(),m=t(),b=t(),k=t(),S=t(),T=(i,u,T,A,O,L,C,D,I,R,N,P,H,E,F)=>{e(f,0,0),e(h,0,0),e(d,0,0),e(p,0,0),e(w,0,0),e(v,0,0),e(g,0,0),e(M,0,0),e(y,0,0),e(x,0,0),e(m,0,0),e(b,0,0),e(k,0,0),e(S,0,0),!H||0===H.x&&0===H.y?(r(f,i,C),l(f,f)):e(f,H.x,H.y),s(h,f,-1);const j=T+I,K=1+(A>R?A:R);r(d,i,u);const $=c(f,d);s(p,f,$),r(w,d,p),r(v,C,D);const W=c(h,v);s(g,h,W),r(M,v,g),s(m,p,(T-I)/j),s(b,g,K*I/j),o(y,m,b),o(y,y,w),s(k,p,K*T/j),s(S,g,(I-T)/j),o(x,k,S),o(x,x,M);const B=o(t(),y,x),G=t();s(G,f,c(B,f));const U=r(t(),B,G);l(U,U);let z=-c(B,U);z/=1/(T+I);const Y=Math.abs(z);if(Y>1e-4){const n=a(w),e=a(M),r=t(),c=t();s(r,U,Y<n*O?O:-n*L),s(c,U,Y<e*N?N:-e*P),o(y,y,r),o(x,x,c)}n(E,y),n(F,x)},A=t=>{const n=2*t.t.x-t.i.x,o=2*t.t.y-t.i.y;e(t.i,t.t.x,t.t.y),e(t.t,n,o)},O=(t,n,o,r,c,s,i,a,l)=>{const u=c-t,f=i/2+o/2-Math.abs(u),h=s-n,d=a/2+r/2-Math.abs(h);if(f<=0)return null;if(d<=0)return null;if(e(l.resolve,0,0),e(l.l,0,0),e(l.u,0,0),f<d){const n=u<0?-1:1;l.resolve.x=f*n,l.u.x=n,l.l.x=t+o/2*n,l.l.y=s}else{const t=h<0?-1:1;l.resolve.y=d*t,l.u.y=t,l.l.x=c,l.l.y=n+r/2*t}return l},L=t(),C=t();function D(t,n,e,o,c){r(L,n,t),r(C,o,e);const s=(-L.y*(t.x-e.x)+L.x*(t.y-e.y))/(-C.x*L.y+L.x*C.y),i=(C.x*(t.y-e.y)-C.y*(t.x-e.x))/(-C.x*L.y+L.x*C.y);return s>=0&&s<=1&&i>=0&&i<=1&&(c.x=t.x+i*L.x,c.y=t.y+i*L.y,!0)}const I=t(),R=t(),N=t(),P=t(),H=t(),E=t();const F=t(),j=t();function K(t,n,o,s){if(r(F,o,n),0===F.x&&0===F.y)throw new Error("ZeroLengthEdge");const a=((t.x-n.x)*F.x+(t.y-n.y)*F.y)/(F.x*F.x+F.y*F.y);s.h=a;const u=e(s.p,n.x+a*F.x,n.y+a*F.y);s.v=i(u,t);const f=((t,n,e)=>(t.y=e.x-n.x,t.x=n.y-e.y,l(t,t)))(s.g,n,o);r(j,t,u),s.M=c(f,j)}function $(t){return t&&"object"==typeof t&&"number"==typeof t.id}const W=new class{constructor(t=100){this.m=t,this.k=-1,this.S=void 0,this.T=new Set,this.A=new Map,this.S=new Array(t)}O(){for(;;){let t=++this.k;if(t<this.m){if(this.S[t])continue;return this.S[t]={id:t}}{this.k=-1;const t=this.m=10*this.m,n=new Array(t);for(let t=0;t<this.S.length;t++)n[t]=this.S[t];for(const[n,e]of this.A){const o=new Array(t);for(let t=0;t<e.length;t++)o[t]=e[t];this.A.set(n,o)}}}}L(t){this.T.add(t.id)}C(t){return this.T.has(t.id)}D(){if(0===this.T.size)return;let t=!1;const n=e=>{e&&"object"==typeof e&&!$(e)&&Object.values(e).forEach(e=>{$(e)?(this.L(e),t=!0):n(e)})};this.T.forEach(t=>{this.T.delete(t),this.S[t]=void 0;for(const[,e]of this.A){const o=e[t];o&&(n(o),e[t]=void 0)}}),t&&this.D()}I(t){const n=this.O();for(let e=0;e<t.length;e++){const o=t[e];this.add(n,o)}return n}data(t,n){return this.A.get(n)[t.id]}add(t,n){var e;const o=null!==(e=this.A.get(n.R))&&void 0!==e?e:Array(this.m);return o[t.id]=n,this.A.set(n.R,o),t}remove(t,n){const e=this.A.get(n);if(e)return e[t.id]=void 0,t}select(t){const n=new Set;for(let e=0;e<t.length;e++){const o=t[e],r=this.A.get(o);if(!r)return[];if(0===n.size)for(let t=0;t<r.length;t++){void 0!==r[t]&&n.add(this.S[t])}else for(const t of n.values())void 0===r[t.id]&&n.delete(t)}return[...n]}N(t){const n=this.A.get(t);return n||[]}P(t){return this.select(t)[0]}H(t){const n=this.A.get(t);for(let t=0;t<n.length;t++){const e=n[t];if(void 0!==e)return e}}};function B(){return W}function G(t,n,e){const o=e.getContext("2d"),r=window.devicePixelRatio||1;return e.style.width=t+"px",e.style.height=n+"px",e.width=Math.floor(t*r),e.height=Math.floor(n*r),o.scale(r,r),o.webkitImageSmoothingEnabled=!1,o.msImageSmoothingEnabled=!1,o.mozImageSmoothingEnabled=!1,o.imageSmoothingEnabled=!1,{width:t,height:n,F:e,j:o,K:r}}const U=document.querySelector.bind(document),z=(document.querySelectorAll.bind(document),U("#r")),Y=U("#c"),q=U("#u");if(!z||!Y||!q)throw new Error("Could not locate DOM!");function Z(t,n,e,o){return t.addEventListener(n,e,o),()=>{t.removeEventListener(n,e,o)}}const J="transparent",Q="rgba(255,255,132,1)",V="rgba(255,255,132,0.5)",X="rgba(40,40,40,1)",_=45,tt="Arial, sans-serif",nt="Courier, Courier New, monospace";function et(n=0,e=0){return t(n,e)}function ot(t){const n=B().H("vp"),e=n.$;return t/n.W*e.width}function rt(t,n){const e=B().H("vp"),{B:o}=e;return ot(t-("x"===n?o.target.x:o.target.y))}const ct=t=>t/B().H("vp").$.width*100;function st(t){const e=B().H("vp");n(e.B.target,t)}function it(){const t=B().H("vp"),{j:n}=t.$;n.save(),function(t){const{j:n}=t.$,{B:e}=t;n.scale(1,-1),n.translate(-ot(e.G.x),-ot(e.G.y))}(t),n.clearRect(0,0,t.$.F.width,t.$.F.height),n.restore()}function at(t=X){const n=B().H("vp"),{j:e}=n.$;e.fillStyle=t;const o=2*n.B.G.x,r=n.U-2*n.B.G.y;e.fillRect(rt(n.B.target.x-n.B.G.x,"x"),rt(n.B.target.y-n.B.G.y,"y"),ot(o),ot(-r))}function lt(t,n,e,r,c,s="transparent",i=tt){const a=B().H("vp"),{B:l}=a,u=et();return u.x=l.target.x-l.G.x,u.y=l.target.y+l.G.y,o(u,u,n),ut(t,u,e,r,c,s,i)}function ut(t,n,e,o,r,c="transparent",s=tt){const i=B().H("vp"),{B:a}=i,{j:l}=i.$;l.save(),l.scale(1,-1);const{Y:u,font:f}=ft(t,o,s);let h=0,d=ot(-n.y+a.target.y);return l.font=f,t.split("\n").forEach((t,o)=>{const s=l.measureText(t).width+1,i=ot(u);0===o&&(d+=i);const a="center"===e?rt(n.x,"x")-s/2:"left"===e?rt(n.x,"x"):rt(n.x,"x")-s;"transparent"!==c&&(l.fillStyle=c,l.fillRect(a,d,s,-i)),l.fillStyle=r,l.fillText(t,a,d),d+=i,h+=i}),l.restore(),ct(h)}function ft(t,n,e=tt){const o=B().H("vp"),{j:r}=o.$,c=o.height/n;r.save();const s=`${c}px/1.2 ${e}`;r.font=s;const i=r.measureText(t),a=1.2*(i.actualBoundingBoxAscent?i.actualBoundingBoxAscent+i.actualBoundingBoxDescent:c);r.restore();const l=t.split("\n");return{font:s,fontSize:c+"px",total:ct(a*l.length),q:1.2,Y:ct(a)}}function ht(){const t=window.innerWidth<window.innerHeight?window.innerWidth:.6*window.innerHeight,n=window.innerWidth<window.innerHeight?window.innerWidth/.6:window.innerHeight;return{R:"vp",ratio:.6,width:t,height:n,W:100,U:100/.6,$:G(t,n,Y),B:{G:et(50,50),mode:"center",target:et(0,0)}}}function dt(){const t=ht(),n=B(),e=n.P(["vp"]);e&&n.L(e);z.style.width=t.width+"px";const o=n=>Math.floor(n/t.W*t.$.width);t.$.j.translate(o(t.B.G.x),o(t.B.G.y)),t.$.j.scale(1,-1);const r=[t];n.I(r)}function pt(t,n,e,o){const r=n.x-e.x,c=n.y-e.y,s=Math.sin(o),i=Math.cos(o);return t.x=r*i-c*s+e.x,t.y=r*s+c*i+e.y,t}function wt(){return{v:0,M:0,h:0,p:t(),g:t()}}window.addEventListener("resize",dt);const vt=t(),gt=t(),Mt=t();function yt(t,n,e){return r(vt,n.t,n.i),l(gt,vt),s(Mt,gt,e),o(t,Mt,n.t),t}function xt(t){return Math.atan2(t.y,t.x)}const mt=new URLSearchParams(window.location.search);function bt(t,n){const{width:e,height:r}=function(t){return{width:t.W,height:Math.min(.75*t.W,.75*t.U)}}(n),c=t.width/2,i=t.height/2,a=n.B.target,l=et(Math.cos(t.Z),Math.sin(t.Z)),u=s(et(),l,Math.min(e/2,r/2)),f=o(et(),a,u),h=et(f.x,f.y-c),d=et(f.x,f.y+c);return pt(h,h,f,t.Z),pt(d,d,f,t.Z),{x:f.x,y:f.y,angle:t.Z,J:c,V:i,X:h,p1:d}}function kt(t){return{R:"mv",t:n(et(),t),i:n(et(),t),o:et()}}const St=33.3333333;const Tt=mt.get("seed"),At=Tt?Number(Tt):Date.now(),Ot=(Ct=61^(Ct=At)^Ct>>>16,Ct+=Ct<<3,Ct=Math.imul(Ct,668265261),Lt=(Ct^=Ct>>>15)>>>0,t=>(Lt=Lt+1831565813|0,(((t=(t=Math.imul(Lt^Lt>>>15,1|Lt))+Math.imul(t^t>>>7,61|t)^t)^t>>>14)>>>0)/2**32));var Lt,Ct;const Dt=()=>Ot();function It(t,n,e){Rt(t,10,1e3,n>0?e:pt(et(),e,t,Math.PI))}function Rt(t,n,o,r,c=.6,s=1,i=Math.PI){const a=B();for(let l=0;l<n;l++){const n=kt(t),l=s*Dt(),u=s*Dt();if(r){const t=xt(r),o=t+i/2,c=t-i/2,s=c+Dt()*(o-c);e(n.o,Math.cos(s)*l,Math.sin(s)*u)}else e(n.o,l,u);const f=Dt()*o,h=a.I([n]);a.I([{R:"particle",move:h,_:f,tt:f,size:c}])}}const Nt=(t,n)=>{const e=t.select(["particle"]);for(let o=0;o<e.length;o++){const r=e[o],c=t.data(r,"particle");c._-=n,c._<=0&&t.L(r)}};function Pt(t,e,c,i){u(t,i);const{X:a,p1:l,V:f}=bt(e,c),h={nt:a,et:l},d=t,p=f,w=wt();K(d.t,h.nt,h.et,w);const v=n(et(),w.p),g=r(et(),e.ot.t,e.ot.i),M=r(et(),v,g),y=2+p;if(w.h>=0&&w.h<=1&&w.v<=y){const t=1,n=1e7,e=.5,c=.87,i=.87,a=et(),l=et();T(d.t,d.i,t,e,c,i,v,M,n,e,c,i,w.g,a,l),r(d.i,d.t,a);const u=Math.abs(y-w.v);((t,...n)=>{for(let e=0;e<n.length;e++){const r=n[e];o(r,r,t)}})(s(et(),w.g,w.M>0?u:-u),d.t,d.i),It(d.i,w.M,w.g)}A(t)}function Ht(){const t=B().H("vp"),{B:n,$:{j:e}}=t;e.fillStyle=X,e.fillRect(rt(n.target.x-n.G.x,"x"),rt(n.target.y+n.G.y,"y"),ot(2*n.G.x),ot(2*-n.G.y))}let Et;function Ft(){const t=B().H("vp"),{B:n}=t,e=2*n.G.x,o=2*n.G.y;if(!Et){const n=document.createElement("canvas"),r=n.getContext("2d");Et=G(ot(2*t.B.G.x),ot(2*t.B.G.y),n);const c=.1,s=.3,i=2*t.B.G.y*8;r.fillStyle=V;let a=0;for(;a<i;){const t=Dt()*e,n=Dt()*o,i=Dt()*(s-c)+c;r.beginPath(),r.arc(ot(t),ot(n),ot(i),0,2*Math.PI,!1),r.fill(),a++}}const r=n.target.x/e,c=n.target.y/o,s=Math.floor(r),i=Math.floor(c);let a=n.target.x%e/e,l=n.target.y%o/o;a=n.target.x<0?1-Math.abs(a):a,l=n.target.y<0?1-Math.abs(l):l;const u=t.$.j;Ht(),u.drawImage(Et.F,0,0,ot(e),ot(o),rt(s*e,"x"),rt(i*o,"y"),ot(e),ot(o)),a<.5&&u.drawImage(Et.F,0,0,ot(e),ot(o),rt((s-1)*e,"x"),rt(i*o,"y"),ot(e),ot(o)),a>=.5&&u.drawImage(Et.F,0,0,ot(e),ot(o),rt((s+1)*e,"x"),rt(i*o,"y"),ot(e),ot(o)),l<.5&&u.drawImage(Et.F,0,0,ot(e),ot(o),rt(s*e,"x"),rt((i-1)*o,"y"),ot(e),ot(o)),l>=.5&&u.drawImage(Et.F,0,0,ot(e),ot(o),rt(s*e,"x"),rt((i+1)*o,"y"),ot(e),ot(o)),a<.5&&l<.5&&u.drawImage(Et.F,0,0,ot(e),ot(o),rt((s-1)*e,"x"),rt((i-1)*o,"y"),ot(e),ot(o)),a>=.5&&l<.5&&u.drawImage(Et.F,0,0,ot(e),ot(o),rt((s+1)*e,"x"),rt((i-1)*o,"y"),ot(e),ot(o)),a<.5&&l>=.5&&u.drawImage(Et.F,0,0,ot(e),ot(o),rt((s-1)*e,"x"),rt((i+1)*o,"y"),ot(e),ot(o)),a>=.5&&l>=.5&&u.drawImage(Et.F,0,0,ot(e),ot(o),rt((s+1)*e,"x"),rt((i+1)*o,"y"),ot(e),ot(o))}function jt(t=0,e=et(0,0)){const o=B().H("vp");return{Z:t,width:o.W/2,height:o.W/16,ot:{o:et(),t:n(et(),e),i:n(et(),e)}}}function Kt(t=et(),e=0,o=et()){const c=B().H("vp"),i={t:n(et(),t),i:n(et(),t),o:et(),width:c.W/32,height:c.W/32},a=s(et(),o,e);return r(i.i,i.t,a),i}function $t(t){return{ot:{t:n(et(),t),i:n(et(),t),o:et()},rt:et(10,10)}}function Wt(t,n){return{nt:t,et:n,ct:!1,st:!1}}function Bt(t,n,e=!1){return{nt:t,et:n,ct:!0,st:e}}function Gt(t,n=!0,e=!0){const o=[];for(let n=0;n<t.length;n++){const r=n>0?t[n-1]:null,c=t[n];r&&o.push(e?Wt(c,r):Wt(r,c))}return n&&o.push(e?Wt(t[0],t[t.length-1]):Wt(t[t.length-1],t[0])),o}function Ut(t,e,o=!1,r=!0){return{ot:{t:n(et(),t),i:n(et(),t),o:et()},rt:et(10,10),it:n(et(),e),at:o,lt:r}}const zt={ut:0,ft:null,state:"b",level:-1,ht:null,dt:[],wt:null,vt:!1,gt:[function(){return{Mt:Kt(et(20,0),.5,et(-1,0)),yt:jt(Math.PI),target:$t(et(40,0)),xt:Gt([et(-60,60),et(60,60),et(60,-60),et(-60,-60)]),bt:[],kt:"Signal, meet target"}},function(){return{Mt:Kt(et(20,0),.5,et(-1,0)),yt:jt(Math.PI),target:$t(et(40,-40)),xt:Gt([et(-60,60),et(60,60),et(60,-60),et(-60,-60)]),bt:[],kt:"Sometimes you need to rotate"}},function(){return{Mt:Kt(et(20,0),.2,et(-1,0)),yt:jt(Math.PI),target:$t(et(80,-40)),xt:Gt([et(-60,60),et(100,60),et(100,-60),et(-60,-60)]),bt:[],kt:"Offscreen targets are tracked"}},function(){return{Mt:Kt(et(20,0),.2,et(-1,0)),yt:jt(Math.PI),target:$t(et(80,-180)),xt:Gt([et(-60,60),et(100,60),et(100,-200),et(60,-200),et(60,-60),et(-60,-60)]),bt:[],kt:"Down the well..."}},function(){return{Mt:Kt(et(0,-10),.5,et(0,1)),yt:jt(Math.PI),target:$t(et(30,10)),xt:[Wt(et(20,15),et(-20,15)),Bt(et(-20,5),et(20,5)),...Gt([et(-60,60),et(60,60),et(60,-60),et(-60,-60)])],bt:[],kt:"One way is the only way"}},function(){const t=jt();return{Mt:Kt(et(-30,-40),.5,et(0,1)),yt:t,target:$t(et(30,-40)),xt:Gt([et(-60,60),et(60,60),et(60,-60),et(-60,-60)]),bt:[Ut(et(-20,10),et(1,-1))],kt:"Arrows, they shoot"}},function(){const t=jt(Math.PI);return{Mt:Kt(et(-30,-40),.5,et(0,1)),yt:t,target:$t(et(510,0)),xt:Gt([et(-60,60),et(60,60),et(60,5),et(500,10),et(500,20),et(520,20),et(520,-20),et(500,-20),et(500,-10),et(60,-5),et(60,-60),et(-60,-60)]),bt:[Ut(et(50,0),et(1,0),!0)],kt:"Some arrows take you with"}},function(){const t=jt();return{Mt:Kt(et(-21,20),.5,et(1,0)),yt:t,target:$t(et(0,0)),xt:Gt([et(-60,60),et(60,60),et(60,-60),et(-60,-60)]),bt:[Ut(et(-20,20),et(1,0)),Ut(et(20,20),et(0,-1)),Ut(et(20,-20),et(-1,0)),Ut(et(-20,-20),et(0,1))],kt:"Tetherball"}},function(){const t=jt(Math.PI,et(30,0));return{Mt:Kt(et(30,0),.5,et(0,1)),yt:t,target:$t(et(135,0)),xt:Gt([et(-25,25),et(25,25),et(25,20),et(55,30),et(60,10),et(65,30),et(70,9),et(75,30),et(80,8),et(85,30),et(90,7),et(95,30),et(100,6),et(105,30),et(110,5),et(115,30),et(120,4),et(125,30),et(145,25),et(145,-25),et(125,-25),et(120,-4),et(115,-30),et(110,-5),et(105,-30),et(100,-6),et(95,-30),et(90,-7),et(85,-30),et(80,-8),et(75,-30),et(70,-9),et(65,-30),et(60,-10),et(55,-30),et(50,-20),et(25,-25),et(-25,-25)]),bt:[],kt:"No death spikes here"}},function(){const t=jt(Math.PI,et(0,0)),n=Kt(et(-30,0),5,et(1,0)),e=$t(et(5e3,-10));return{Mt:n,yt:t,target:e,xt:Gt([et(-60,60),et(5010,60),et(5010,-110),et(-60,-110)]),bt:[...Array.from(new Array(250)).map((t,n)=>Ut(et(20*n,-10),et(1,0),!0,!1))],kt:"Chase! Shift or btn to boost!"}}]};function Yt(t){const n=zt;n.ft=n.state,n.state=t,n.ut=0}function qt(t){return t*St/1e3}function Zt(t){return t.toFixed(3)}function Jt(t){const n=zt;n.wt=t,n.vt=!1}function Qt(){zt.vt=!0}function Vt(){const t=zt;t.wt=null,t.vt=!1}function Xt(t,n,e,o){if(!e.ct)return;const r=et(),c=D(yt(et(),t,n),t.i,e.nt,e.et,r),s=wt();K(t.i,e.nt,e.et,s),c&&s.M<0&&(e.ct=!1,o.wt&&e.st&&Qt())}function _t(t,n,e){if(e.ct)return;const c=et(),i=D(yt(et(),t,n),t.i,e.nt,e.et,c),a=wt();if(K(t.i,e.nt,e.et,a),i&&a.M>0){u=t,f=n,h={t:e.nt,i:e.nt,o:et()},d={t:e.et,i:e.et,o:et()},r(N,u.t,u.i),l(P,N),s(H,P,f),o(E,H,u.t),D(E,u.i,h.t,d.t,I)&&(r(R,E,I),r(u.t,u.t,R),r(u.i,u.i,R));const i=1,p=1e7,w=1,v=0,g=0,M=et(),y=et();T(t.t,t.i,i,w,v,g,c,c,p,w,v,g,a.g,M,y),r(t.i,t.t,M),It(t.i,a.M,a.g)}var u,f,h,d}const tn={KeyW:!1,KeyA:!1,KeyS:!1,KeyD:!1,ArrowLeft:!1,ArrowRight:!1,ShiftLeft:!1,ShiftRight:!1,Enter:!1};function nn(){return tn}function en(t,n,e,o){const r=B().H("vp"),c=r.B.target,{G:s}=r.B,a=[[et(c.x-s.x,c.y+s.y),et(c.x+s.x,c.y+s.y),wt()],[et(c.x+s.x,c.y+s.y),et(c.x+s.x,c.y-s.y),wt()],[et(c.x+s.x,c.y-s.y),et(c.x-s.x,c.y-s.y),wt()],[et(c.x-s.x,c.y-s.y),et(c.x-s.x,c.y+s.y),wt()]];for(let n=0;n<a.length;n++){const[e,o,r]=a[n];K(t,e,o,r)}const[[l,u,f],[h,d,p],[w,v,g],[M,y,x]]=a;let m,b,k;const S=ft(o,_);if(f.M>0&&p.M>0)m=et(p.p.x,f.p.y),b=i(m,t),k="right";else if(p.M>0&&g.M>0)m=et(p.p.x,g.p.y+S.Y),b=i(m,t),k="right";else if(g.M>0&&x.M>0)m=et(x.p.x,g.p.y+S.Y),b=i(m,t),k="left";else if(x.M>0&&f.M>0)m=et(x.p.x,f.p.y),b=i(m,t),k="left";else if(f.M>0)m=et(Math.min(Math.max(f.p.x,l.x),u.x),f.p.y),b=f.v,k="center";else if(p.M>0)m=et(p.p.x,Math.max(Math.min(h.y,p.p.y),d.y)),b=p.v,k="right";else if(g.M>0)m=et(Math.max(Math.min(w.x,g.p.x),v.x),g.p.y+S.Y),b=g.v,k="center";else{if(!(x.M>0))return;m=et(x.p.x,Math.min(Math.max(M.y,x.p.y),y.y)),b=x.v,k="left"}if(b<.7*((n.x/2+n.y/2)/2))return;const T=r.$.j;T.save(),ut(o,m,k,_,X,Q),T.restore()}Z(window,"keydown",t=>{tn[t.code]=!0}),Z(window,"keyup",t=>{tn[t.code]=!1});let on=0,rn=[];const cn=()=>{on=0,rn.length=0},sn=B(),an=sn.I([{R:"fps",St:60}]),ln=t=>{if(!mt.has("debug"))return;lt(t.H("fps").St.toFixed(2),et(100,0),"right",_,Q)};function un(t){sn.data(an,"fps").St=t}function fn(n){const e=B().H("vp"),o=e.$.j,{x:r,y:c}=n.ot.t,s=n.rt.x/2,i=n.rt.x/4,a=e.W/64,l=n.rt.y/a,u=s*Math.SQRT2,f=a*Math.SQRT2/2;if(!O(e.B.target.x,e.B.target.y,3*e.B.G.x,3*e.B.G.y,r,2*n.rt.x,c,2*n.rt.y,{resolve:t(),l:t(),u:t()}))return;o.save(),o.fillStyle=Q,o.strokeStyle=Q;const h=xt(n.it);o.translate(rt(r,"x"),rt(c,"y")),o.rotate(h-Math.PI/2),hn(o,l,a,u,0,0-i+f,Math.PI/4),hn(o,l,a,u,0,0+i-f,-Math.PI/4),o.restore()}function hn(t,n,e,o,r,c,s){for(let i=0;i<n;i+=2){t.save(),t.translate(ot(c),ot(r+i*e)),t.rotate(s);(i<Math.floor(n/4)?t.strokeRect:t.fillRect).call(t,ot(0-o/2),ot(0),ot(o),ot(e)),t.restore()}}function dn(t,o,c){const s=c.ot.t,i=(c.rt.y,c.rt.x/2),a=et(s.x,s.y+i),l=et(s.x,s.y-i),u=xt(c.it),f=et(s.x-i,s.y-i),h=et(s.x+i,s.y-i),d=et(s.x+i,s.y+i),p=et(s.x-i,s.y+i);pt(a,a,s,u),pt(l,l,s,u),pt(f,f,s,u),pt(h,h,s,u),pt(d,d,s,u),pt(p,p,s,u);const w=[[a,l],[f,h],[d,p]];let v=!1;for(let t=0;t<w.length;t++){const n=w[t],e=et(),r=D(o.i,o.t,n[0],n[1],e),c=wt();if(K(o.i,n[0],n[1],c),r&&c.M<0){v=!0;break}}if(v){if(n(o.t,c.ot.t),n(o.i,o.t),c.lt)e(o.o,5*c.it.x,5*c.it.y);else{const t=et(8*c.it.x,8*c.it.y);r(o.i,o.t,t)}c.at&&Jt(o)}}const pn="--ctrlDisplay";function wn(t,n){U(":root").style.setProperty(t,n)}const vn={Tt:()=>{},At:()=>{}},gn={Ot:!1,move:t(),rotate:et()};function Mn(){const t=U("#btn-boost"),n=U("#btn-reset"),e=U("#stick-move"),o=U("#stick-move .ui-nub"),r=U("#stick-rotate"),c=U("#stick-rotate .ui-nub"),s=xn(e,o,gn.move),i=xn(r,c,gn.rotate),a=function(t,n){const e=Z(t,"mouseup",t=>{t.preventDefault(),n()}),o=Z(t,"touchstart",t=>{t.preventDefault()}),r=Z(t,"touchend",t=>{n()});return()=>{e(),o(),r()}}(n,()=>{vn.Tt()}),l=Z(t,"mousedown",()=>{gn.Ot=!0}),u=Z(t,"mouseup",()=>{gn.Ot=!1}),f=Z(t,"touchstart",()=>{gn.Ot=!0}),h=Z(t,"touchend",()=>{gn.Ot=!1});vn.At=()=>{l(),u(),f(),h(),a(),s(),i()}}function yn(){wn(pn,"none")}function xn(n,e,o){const r=t(),c=t(),s=Z(n,"touchstart",t=>{t.preventDefault();const e=t.targetTouches[0];r.x=e.screenX,r.y=e.screenY;const o=n.getBoundingClientRect();c.x=o.width,c.y=o.height}),i=Z(n,"touchmove",t=>{t.preventDefault();const n=t.targetTouches[0],s=n.screenX-r.x,i=-1*(n.screenY-r.y);o.x=s/(c.x/2),o.y=i/(c.y/2),l(o,e)}),a=Z(n,"touchend",t=>{t.preventDefault(),r.x=r.y=0,c.x=c.y=0,o.x=o.y=0,l(o,e)});function l(t,n){const e=(t.x+1)/2*100,o=-(t.y-1)/2*100,r=Math.max(Math.min(e,100),0),c=Math.max(Math.min(o,100),0);n.style.setProperty("--leftPct",r+"%"),n.style.setProperty("--topPct",c+"%")}return()=>{s(),i(),a(),r.x=r.y=0,c.x=c.y=0,o.x=o.y=0,l(o,e)}}function mn(){}!async function(){await async function(){}();const t=B();dt(),function(){const t=ot(B().H("vp").B.G.y),n=2*t,{fontSize:e}=ft("M",_,tt);wn("--yellowRGBA",Q),wn("--blackRGBA",X),wn("--bodyFontSize",e),wn("--ctrlPanelHeight",t+"px"),wn("--ctrlPanelTop",n+"px")}();const c=[],i=[];c.push(t=>{it()});const f=t.H("vp");c.push((function(t,n){switch(zt.state){case"b":{Ft();let t=10;t-=ut("SIGNAL DECAY",et(0,t),"center",20,Q,J,nt),t-=5,ut("a js13k 2020 entry",et(0,t),"center",_,Q),t-=20,ut("TAP OR CLICK TO START",et(0,t),"center",_,Q,J,nt),at();break}case"t":{Ht();let t=50;const n=-45,e=matchMedia("(hover: none)").matches;t-=5,t-=ut(["Be the best signalmancer in the galaxy!","","Help messages from deep space colonies bounce","their way home as quickly as possible.","","Only you can prevent 404s."].join("\n"),et(n,t),"left",_,Q),e||(t-=5,t-=ut("CONTROLS (KEYBOARD)",et(n,t),"left",_,Q,J,nt),t-=5,t-=ut(["WASD: move","Hold any SHIFT to boost","","Arrow Left / Arrow Right: rotate the Deflector"].join("\n"),et(n,t),"left",_,Q)),e&&(t-=5,t-=ut("CONTROLS (TOUCH)",et(n,t),"left",_,Q,J,nt),t-=5,t-=ut(["Left Stick:  move","Move stick and hold BOOST to boost","","Right Stick: rotate the Deflector"].join("\n"),et(n,t),"left",_,Q)),t-=5,t-=ut("TAP OR CLICK TO CONTINUE",et(0,t),"center",_,Q,J,nt),at();break}case"level":{if(!zt.ht)break;const{target:n,yt:e,Mt:o,xt:c,bt:i}=zt.ht;Ft(),function(t,n){const e=B().H("vp").$.j,{x:o,y:r}=t.ot.t,c=t.rt.x/2,s=t.rt.y/2;e.save(),e.fillStyle=Q,e.translate(rt(o,"x"),rt(r,"y")),e.fillRect(0-ot(c),0-ot(s),ot(t.rt.x),ot(t.rt.y)),e.restore()}(n),function(t){const n=B().H("vp"),e=n.$.j,{x:o,y:r,angle:c,V:s,J:i,X:a,p1:l}=bt(t,n);e.save(),e.fillStyle=Q,e.translate(rt(o,"x"),rt(r,"y")),e.rotate(Math.PI/2+c),e.fillRect(0-ot(i),0-ot(s),ot(t.width),ot(t.height)),e.restore()}(e),function(t,n){const e=B().H("vp"),o=e.$.j,{t:c,i:i,width:u,height:f}=t,h=u/2,d=f/2,p=rt(i.x+1*(c.x-i.x),"x"),w=rt(i.y+1*(c.y-i.y),"y"),v=ot(u),g=ot(f);o.save();{const t=r(et(),c,i),n=l(t,t),a=s(n,n,10*e.W);o.lineWidth=ot(1),o.strokeStyle=V,o.setLineDash([ot(1),ot(3)]),o.beginPath(),o.moveTo(p,w),o.lineTo(p+ot(a.x),w+ot(a.y)),o.stroke(),o.setLineDash([])}{const t=h/8,n=r(et(),c,i),e=a(n)/t,u=l(n,n);o.fillStyle="rgba(255,255,132,0.1)";const f=et();for(let n=0;n<e;n++)s(f,u,n*t),o.fillRect(p-ot(f.x)-ot(h),w-ot(f.y)-ot(d),v,g)}o.fillStyle=Q,o.fillRect(p-ot(h),w-ot(d),v,g),o.restore()}(o),function(t){for(let n=0;n<t.length;n++)fn(t[n])}(i),function(t){const{$:{j:n}}=B().H("vp");n.save(),n.strokeStyle=Q,n.lineWidth=ot(1);for(let e=0;e<t.length;e++){const o=t[e];o.ct?n.setLineDash([ot(1),ot(2)]):n.setLineDash([]),n.beginPath(),n.moveTo(rt(o.nt.x,"x"),rt(o.nt.y,"y")),n.lineTo(rt(o.et.x,"x"),rt(o.et.y,"y")),n.closePath(),n.stroke()}n.restore()}(c),((t,n)=>{const e=t.N("particle"),o=t.H("vp"),{j:r}=o.$;r.save();for(let n=0;n<e.length;n++){const o=e[n];if(!o)continue;const c=t.data(o.move,"mv"),s=o._/o.tt;r.fillStyle=Q.replace(",1)",`,${s.toFixed(5)})`),r.fillRect(rt(c.t.x,"x"),rt(c.t.y,"y"),ot(o.size),ot(o.size))}r.restore()})(t),at(),function(t,n){const e=B().H("vp");if(!t.ht)return;lt(Zt(qt(t.ut)),et(e.W/2,-1),"center",_,Q),lt(`MISSION ${t.level+1}: ${t.ht.kt.toUpperCase()}`,et(e.B.G.x,2*-e.B.G.y),"center",_,Q,J,nt),en(t.ht.target.ot.t,t.ht.target.rt,0,"TARGET"),en(t.ht.Mt.t,et(t.ht.Mt.width,t.ht.Mt.height),0,"SIGNAL")}(zt);break}case"win":{Ht();const t=Zt(qt(zt.dt[zt.level]));let n=10;n-=ut("MISSION SUCCESS",et(0,n),"center",20,Q,J,nt),n-=5,n-=ut(t+"s",et(0,n),"center",_,Q,J,tt),n-=10,n-=ut("Finding the next signal in\nneed of assistance...",et(0,n),"center",_,Q,J,tt),at();break}case"n":break;case"x":{Ht();let t=45;t-=ut("ALL SIGNALS MADE IT,\nTHANKS TO YOU!",et(0,t),"center",_,Q,J,nt);let n=0;t-=5;for(let e=0;e<zt.dt.length;e++){const o=zt.dt[e];n+=o,ut(`MISSION ${e+1}:`,et(-45,t),"left",_,Q,J,nt),t-=ut(Zt(qt(o))+"s:",et(45,t),"right",_,Q,J,nt)}const e=Zt(qt(n));t-=5,t-=ut(`TOTAL: ${e}s`,et(45,t),"right",_,Q,J,nt),at(),0===zt.ut&&(wn("--thanksDisplay","block"),function(t){const n=`I prevented Signal Decay in ${t}s!`,e=new URLSearchParams;e.append("text",n),e.append("url","https://kirbysayshi.com/js13k-2020"),e.append("hashtags",["js13k"].join(",")),U("#btn-tweet").setAttribute("href","https://twitter.com/intent/tweet?"+e.toString())}(e));break}}})),i.push((t,c)=>{switch(zt.state){case"b":if(0===zt.ut){yn();const n=Z(t.H("vp").$.F,"click",()=>{n(),cn(),Yt("t")})}break;case"t":if(0===zt.ut){yn();const n=Z(t.H("vp").$.F,"click",()=>{n(),cn(),Yt("n")})}break;case"level":{const s=gn,i=nn();if(0===zt.ut){const t=zt.gt[zt.level];if(!t)return Yt("x");zt.ht=t(),wn(pn,"flex"),Mn(),a=()=>{zt.ht=t(),Vt()},vn.Tt=a}if(i.Enter){const t=zt.gt[zt.level];zt.ht=t(),Vt()}if(!zt.ht)break;const{target:h,yt:d,Mt:p,bt:w,xt:v}=zt.ht;i.ArrowLeft&&(d.Z+=.1),i.ArrowRight&&function(t){t.Z-=.1}(d);const g=0!==s.rotate.x&&0!==s.rotate.y,M=xt(s.rotate);g&&function(t,n){t.Z=n}(d,M);const y=et();let x=0;i.KeyW&&i.KeyD?x=Math.PI/4:i.KeyW&&i.KeyA?x=Math.PI*(3/4):i.KeyS&&i.KeyD?x=-Math.PI/4:i.KeyS&&i.KeyA?x=-Math.PI*(3/4):i.KeyW?x=Math.PI/2:i.KeyA?x=Math.PI:i.KeyS?x=-Math.PI/2:i.KeyD&&(x=0);const m=0!==s.move.x&&0!==s.move.y,b=xt(s.move),k=i.ShiftLeft||i.ShiftRight||s.Ot?et(1,0):et(.2,0);m&&(x=b);const S=pt(et(),k,y,x);m&&e(S,S.x*Math.abs(s.move.x),S.y*Math.abs(s.move.y));if((0!==x||0===x&&i.KeyD||m)&&!zt.wt&&function(t,n){o(t.ot.o,t.ot.o,n)}(d,S),((t,n)=>{const e=(t.i.x-t.t.x)*n,o=(t.i.y-t.t.y)*n;t.i.x=t.t.x+e,t.i.y=t.t.y+o})(d.ot,.8),u(d.ot,c),Pt(p,d,f,c),function(t,n,e){for(let t=0;t<e.length;t++)dn(0,n,e[t])}(0,p,w),function(t,n,e){for(let o=0;o<t.length;o++){const r=t[o];Xt(n,n.width/2,r,e),_t(n,n.width/2,r)}}(v,p,zt),((t,n)=>{const e=t.N("mv");for(let t=0;t<e.length;t++){const o=e[t];o&&(u(o,n),A(o))}})(t,c),A(d.ot),zt.wt&&(n(d.ot.t,zt.wt.t),n(d.ot.i,zt.wt.t),zt.ut%3==0)){const t=r(et(),zt.wt.t,zt.wt.i),n=l(et(),t);Rt(zt.wt.i,25,1e3,n,.6,3,Math.PI/8)}if(st(d.ot.t),zt.vt&&Vt(),function(t,n){return!!O(t.ot.t.x,t.ot.t.y,t.rt.x,t.rt.y,n.t.x,n.t.y,n.width,n.height,{resolve:et(),l:et(),u:et()})}(h,p)){const t=zt;return t.dt[t.level]=t.ut,t.ht=null,Vt(),vn.At(),st(et(0,0)),Yt("win")}break}case"win":{st(et(0,0));const t=3e3;0===zt.ut&&(yn(),s=()=>Yt("n"),i=t,rn.push({id:++on,action:s,delay:i,_:0}));break}case"n":return zt.level+=1,Yt("level");case"x":yn(),st(et(0,0))}var s,i,a;zt.ut+=1}),i.push(Nt),c.push(ln);const{stop:h}=(({Lt:t,Ct:n,Dt:e,update:o,It:r=10,Rt:c=(()=>{}),Nt:s=(()=>{})})=>{const i=window.performance,a=t,l=n,u=i.now.bind(i),f=window.requestAnimationFrame.bind(window);let h=0,d=null,p=u(),w=u(),v=0,g=60;return function t(){const n=u();d=f(t),h+=n-p,p=n;let i=h-a>=0,M=Math.floor(h/l);if(M>=r)return h=0,p=u(),void c();for(;M-- >0;)h-=l,o(l);i&&e(h/a),v+=1,w+1e3<=n&&(g=.25*v+.75*g,v=0,w=n,s(g))}(),{stop:()=>{d&&cancelAnimationFrame(d)}}})({Lt:16.6666666,Ct:St,update:n=>{((t=1)=>{rn.slice().forEach((n,e)=>{n._+=t,n._>=n.delay&&(rn.splice(e,1),n.action(n.delay,n._))})})(n),i.forEach(e=>e(t,n)),t.D()},Dt:n=>{c.forEach(e=>e(t,n))},Rt:mn,Nt:un})}()}();