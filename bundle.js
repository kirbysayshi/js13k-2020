!function(){"use strict";function t(t,n){return{x:t||0,y:n||0}}const n=(t,n)=>(t.x=n.x,t.y=n.y,t),o=(t,n,o)=>(t.x=n,t.y=o,t),e=(t,n,o)=>(t.x=n.x+o.x,t.y=n.y+o.y,t),s=(t,n,o)=>(t.x=n.x-o.x,t.y=n.y-o.y,t),c=(t,n)=>t.x*n.x+t.y*n.y,i=(t,n,o)=>(t.x=n.x*o,t.y=n.y*o,t),r=(t,n)=>{t.t.x+=t.o.x*n*n*.001,t.t.y+=t.o.y*n*n*.001,o(t.o,0,0)},a={x:0,y:0},u={x:0,y:0},h={x:0,y:0},p={x:0,y:0},l=(t,n,c,i,r,l,w,f)=>{const d=((t,n)=>{const o=t.x-n.x,e=t.y-n.y;return o*o+e*e})(t.t,i.t),x=n+r;s(a,t.t,t.s),s(u,i.t,i.s),s(h,t.t,i.t);const v=Math.sqrt(d);let M=(v-x)/v;0===v&&(M=1);const b=c>0?c:1,y=l>0?l:1,g=b+y;if(p.x=h.x*M*(y/g),p.y=h.y*M*(y/g),c>0&&s(t.t,t.t,p),p.x=h.x*M*(b/g),p.y=h.y*M*(b/g),l>0&&e(i.t,i.t,p),!w)return;const m=(f=f||1)*(h.x*a.x+h.y*a.y)/(d||1),k=f*(h.x*u.x+h.y*u.y)/(d||1);a.x+=(k*h.x-m*h.x)/(b||1),u.x+=(m*h.x-k*h.x)/(y||1),a.y+=(k*h.y-m*h.y)/(b||1),u.y+=(m*h.y-k*h.y)/(y||1),c>0&&o(t.s,t.t.x-a.x,t.t.y-a.y),l>0&&o(i.s,i.t.x-u.x,i.t.y-u.y)},w=t(),f=t(),d=t(),x=t();function v(o,r,a,u,h,p,v,M,b){s(f,p.t,u.t),((t,n)=>{const o=n.x,e=n.y;let s=o*o+e*e;s>0&&(s=1/Math.sqrt(s),t.x=n.x*s,t.y=n.y*s)})(w,f),s(d,o.t,u.t);const y=c(f,d),g=c(f,f),m=Math.sqrt(g);if(y<0||y>g)return;const k=y/g,D=1-k;i(x,w,k*m),e(x,x,u.t);if(((t,n)=>{const o=t.x-n.x,e=t.y-n.y;return Math.sqrt(o*o+e*e)})(x,o.t)>r)return;const E=D*a,F=k*a,P={t:t(),s:t()},$={t:t(),s:t()};i(P.t,w,k*m),s(P.t,o.t,P.t),i(P.s,w,k*m),s(P.s,o.s,P.s),i($.t,w,D*m),e($.t,o.t,$.t),i($.s,w,D*m),e($.s,o.s,$.s);const j={t:t(),s:t()},A={t:t(),s:t()};n(j.t,P.t),n(j.s,P.s),n(A.t,$.t),n(A.s,$.s);l(P,r,E,u,0,h,M,b),l($,r,F,p,0,v,M,b);const B={t:t(),s:t()},O={t:t(),s:t()};s(B.t,P.t,j.t),s(O.t,$.t,A.t),i(B.t,B.t,D),i(O.t,O.t,k),e(o.t,o.t,B.t),e(o.t,o.t,O.t),M&&(s(B.s,P.s,j.s),s(O.s,$.s,A.s),i(B.s,B.s,D),i(O.s,O.s,k),e(o.s,o.s,B.s),e(o.s,o.s,O.s))}const M=t=>{const n=2*t.t.x-t.s.x,e=2*t.t.y-t.s.y;o(t.s,t.t.x,t.t.y),o(t.t,n,e)};let b=0,y=[];function g(t){return t&&"object"==typeof t&&"number"==typeof t.id}class m{constructor(t){this.i=t,this.u=m.hash(this.i),this.h=new Set}p(t){this.h.add(t)}l(t,n){const o=n.map(t=>t.v);this.i.every(t=>o.indexOf(t)>-1)&&!this.h.has(t)&&this.h.add(t)}M(t,n){const o=n.map(t=>t.v);this.i.every(t=>o.indexOf(t)>-1)&&this.h.has(t)&&this.h.delete(t)}static hash(t){return t.slice().sort().join("|")}}const k=new class{constructor(){this.g=1,this.h=new Map,this.m=new Map,this.k=new Set}D(t){const n={id:this.g++};return this.h.set(n,t),this.m.forEach(o=>o.l(n,t)),n}F(t){this.k.add(t)}P(t){return this.k.has(t)}$(){if(0===this.k.size)return;let t=!1;const n=o=>{o&&"object"==typeof o&&!g(o)&&Object.values(o).forEach(o=>{g(o)?(this.F(o),t=!0):n(o)})};this.k.forEach(t=>{if(this.k.delete(t),!this.h.has(t))return;const o=this.h.get(t);o.forEach(t=>{n(t)}),this.h.delete(t),this.m.forEach(n=>n.M(t,o))}),t&&this.$()}select(t){const n=m.hash(t);if(this.m.has(n))return this.m.get(n).h;const o=new m(t);return this.m.set(o.u,o),this.h.forEach((n,e)=>{let s=!0;for(let o=0;o<t.length;o++){const e=t[o];n.find(t=>t.v===e)||(s=!1)}s&&o.p(e)}),o.h}j(t){return this.select(t).values().next().value}data(t,n){const o=this.h.get(t);if(!o)throw new Error(`Entity(${t}) not found!`);let e;for(let t=0;t<o.length;t++){const s=o[t];s.v===n&&(e=s)}if(!e)throw new Error(`Data(${n}) not found for Entity(${t})!`);return e}A(t){const n=this.j([t]);if(!n)return;return this.data(n,t)}};function D(){return k}const E=document.querySelector.bind(document),F=E("#r"),P=E("#c"),$=E("#u");if(!F||!P||!$)throw new Error("Could not locate DOM!");function j(t,n,o,e){return t.addEventListener(n,o,e),()=>{t.removeEventListener(n,o,e)}}function A(n=0,o=0){return t(n,o)}function B(t){const n=D().A("vp"),o=n.B;return Math.floor(t/n.O*o.width)}function O(t,n){const o=D().A("vp"),{S:e}=o;return B(t-("x"===n?e.target.x:e.target.y))}function S(t){const{T:n}=t.B,{S:o}=t;n.scale(1,-1),n.translate(-B(o.W.x),-B(o.W.y))}function T(){const t=window.innerWidth<window.innerHeight?window.innerWidth:.6*window.innerHeight,n=window.innerWidth<window.innerHeight?window.innerWidth/.6:window.innerHeight;return{v:"vp",ratio:.6,width:t,height:n,O:100,H:100/.6,B:function(t,n,o){const e=o.getContext("2d"),s=window.devicePixelRatio||1;return o.style.width=t+"px",o.style.height=n+"px",o.width=Math.round(t*s),o.height=Math.round(n*s),e.scale(s,s),e.webkitImageSmoothingEnabled=!1,e.msImageSmoothingEnabled=!1,e.mozImageSmoothingEnabled=!1,e.C=!1,{width:t,height:n,I:o,T:e,N:s}}(t,n,P),S:{W:A(50,50),mode:"center",target:A(0,0)}}}function W(){const t=T(),n=D(),o=n.j(["vp"]);o&&n.F(o);F.style.width=t.width+"px";const e=n=>Math.floor(n/t.O*t.B.I.width);t.B.T.translate(e(t.S.W.x),e(t.S.W.y)),t.B.T.scale(1,-1);const s=[t];n.D(s)}function H(t,n,o,e){const s=n.x-o.x,c=n.y-o.y,i=Math.sin(e),r=Math.cos(e);return t.x=s*r-c*i+o.x,t.y=s*i+c*r+o.y,t}function C(t,n){const{width:o,height:s}=function(t){return{width:t.O,height:Math.min(t.O,t.H)}}(n),c=t.width/2,r=t.height/2,a=n.S.target,u=A(Math.cos(t.R),Math.sin(t.R)),h=i(A(),u,Math.min(o/2,s/2)),p=e(A(),a,h),l=A(p.x,p.y-c),w=A(p.x,p.y+c);return H(l,l,p,t.R),H(w,w,p,t.R),{x:p.x,y:p.y,angle:t.R,U:c,Y:r,q:l,p1:w}}function I(t){const n=D().A("vp"),o=n.B.T,{x:e,y:s,angle:c,Y:i,U:r,q:a,p1:u}=C(t,n);o.save(),o.fillStyle="rgba(255,255,255,1)",o.translate(O(e,"x"),O(s,"y")),o.rotate(Math.PI/2+c),o.fillRect(0-B(r),0-B(i),B(t.width),B(t.height)),o.restore(),function(t,n,o){z(t,n.q),z(t,n.p1),t.save(),t.beginPath(),t.strokeStyle="black",t.lineWidth=B(.5),t.moveTo(O(n.q.x,"x"),O(n.q.y,"y")),t.lineTo(O(n.p1.x,"x"),O(n.p1.y,"y")),t.stroke(),t.restore()}(o,{q:a,p1:u}),function(t,n,o){t.beginPath(),t.fillStyle="blue",t.arc(O(n.s.x+(n.t.x-n.s.x)*o,"x"),O(n.s.y+(n.t.y-n.s.y)*o,"y"),B(1),0,2*Math.PI),t.fill()}(o,t.G,1)}function z(t,n,o){t.save(),t.beginPath(),t.fillStyle="blue",t.arc(O(n.x,"x"),O(n.y,"y"),B(1),0,2*Math.PI),t.fill(),t.restore()}function N(t,n){return!!((t,n,e,s,c,i,r,a,u)=>{const h=c-t,p=r/2+e/2-Math.abs(h),l=i-n,w=a/2+s/2-Math.abs(l);if(p<=0)return null;if(w<=0)return null;if(o(u.resolve,0,0),o(u.J,0,0),o(u.K,0,0),p<w){const n=h<0?-1:1;u.resolve.x=p*n,u.K.x=n,u.J.x=t+e/2*n,u.J.y=i}else{const t=l<0?-1:1;u.resolve.y=w*t,u.K.y=t,u.J.x=c,u.J.y=n+s/2*t}return u})(t.G.t.x,t.G.t.y,t.L.x,t.L.y,n.t.x,n.t.y,n.width,n.height,{resolve:A(),J:A(),K:A()})}window.addEventListener("resize",W);const R={V:0,X:null,state:"boot",level:0,Z:{_:null,tt:null,target:null}};function U(t){const n=R;n.X=n.state,n.state=t,n.V=0}function Y(){}function q(t){D().A("fps").nt=t}!async function(){await async function(){}();const o=D();W();const s=[],c=[];s.push(t=>{!function(){const t=D().A("vp"),{T:n}=t.B;n.save(),S(t),n.clearRect(0,0,t.B.I.width,t.B.I.height),n.restore()}()});const i=o.A("vp");s.push((function(t,n){switch(R.state){case"boot":break;case"level":{const{target:t,_:o,tt:e}=R.Z;if(!t||!o||!e)return;!function(t,n){const o=D().A("vp").B.T,{x:e,y:s}=t.G.t,c=t.L.x/2,i=t.L.y/2;o.save(),o.fillStyle="rgba(128,255,255,1)",o.translate(O(e,"x"),O(s,"y")),o.fillRect(0-B(c),0-B(i),B(t.L.x),B(t.L.y)),o.restore()}(t),I(o),function(t,n){const o=D().A("vp").B.T,{t:e,s:s,width:c,height:i}=t,r=c/2,a=i/2,u=O(s.x+n*(e.x-s.x),"x"),h=O(s.y+n*(e.y-s.y),"y"),p=B(c),l=B(i);o.save(),o.fillStyle="rgba(255,255,255,1)",o.fillRect(u-B(r),h-B(a),p,l),o.restore()}(e,n);break}case"win":{const n=t.A("vp"),{T:o}=n.B;o.save();const e=5,s=n.height/e,c=1.5;o.font=`${s}px/${c} monospace`;const i="YOU\nWIN";S(n),o.fillStyle="black";let r=0;i.split("\n").forEach(t=>{const e=o.measureText(t),i=e.width+1,a="ot"in e?e.ot+e.et:s*c-s;r+=a,o.fillText(t,B(n.O/2)-i/2,r)}),o.restore();break}}})),c.push((o,s)=>{switch(R.state){case"boot":return console.log("boot"),U("nextlevel");case"level":{0===R.V&&(R.Z=function(){const t=D().A("vp"),n={R:0,width:t.O/8,height:t.O/16,G:{o:A(),t:A(),s:A()}},o={t:A(),s:A(),o:A(),width:t.O/16,height:t.O/16},e={G:{t:A(-10,-10),s:A(-10,-10),o:A()},L:A(10,10)};return o.o.x=.1,o.o.y=.1,{tt:o,_:n,target:e}}());const{target:t,_:n,tt:o}=R.Z;a.st&&(n.R+=.2),a.ct&&function(t){t.R-=.2}(n);const s=A(.2,0),c=A();let i=0;if(a.w&&a.d?i=Math.PI/4:a.w&&a.a?i=Math.PI*(3/4):a.it&&a.d?i=-Math.PI/4:a.it&&a.a?i=-Math.PI*(3/4):a.w?i=Math.PI/2:a.a?i=Math.PI:a.it?i=-Math.PI/2:a.d&&(i=0),(0!==i||a.d)&&function(t,n){e(t.G.o,t.G.o,n)}(n,H(A(),s,c,i)),N(t,o))return U("win");break}case"win":0===R.V&&(c=()=>U("nextlevel"),u=5e3,y.push({id:++b,action:c,rt:u,at:0}));break;case"nextlevel":return R.level+=1,U("level")}var c,u;const{target:h,_:p,tt:l}=R.Z;h&&p&&l&&(((t,n)=>{const o=(t.s.x-t.t.x)*n,e=(t.s.y-t.t.y)*n;t.s.x=t.t.x+o,t.s.y=t.t.y+e})(p.G,.8),r(p.G,s),M(p.G),function(o,e,s,c){r(o,c);const{q:i,p1:a}=C(e,s),u={t:i,s:n(t(),i),o:t()},h={t:a,s:n(t(),a),o:t()};v(o,2,1,u,-1,h,-1,!1,1),M(o),v(o,1,1,u,-1,h,-1,!0,1)}(l,p,i,s),function(t){const o=D().A("vp");n(o.S.target,t)}(p.G.t)),R.V+=1});const a={};j(window,"keydown",t=>{a[t.key]=!0}),j(window,"keyup",t=>{a[t.key]=!1}),o.D([{v:"fps",nt:60}]),s.push(t=>{const n=t.A("vp"),o=t.A("fps").nt.toFixed(2),e=n.height/44,{T:s}=n.B;s.save(),s.fillStyle="rgba(255,255,0,1)",s.font=e+"px/1.5 monospace";const c=s.measureText(o),i=c.width+1,r="ot"in c?c.ot+c.et:1.5*e-e;S(n),s.fillText(o,B(n.O)-i,0+r),s.restore()});const{stop:u}=(({ut:t,ht:n,pt:o,update:e,lt:s=10,wt:c=(()=>{}),ft:i=(()=>{})})=>{const r=window.performance,a=t,u=n,h=r.now.bind(r),p=window.requestAnimationFrame.bind(window);let l=0,w=null,f=h(),d=h(),x=0,v=60;return function t(){const n=h();w=p(t),l+=n-f,f=n;let r=l-a>=0,M=Math.floor(l/u);if(M>=s)return l=0,f=h(),void c();for(;M-- >0;)l-=u,e(u);r&&o(l/a),x+=1,d+1e3<=n&&(v=.25*x+.75*v,x=0,d=n,i(v))}(),{stop:()=>{w&&cancelAnimationFrame(w)}}})({ut:1e3/60,ht:1e3/30,update:t=>{((t=1)=>{y.slice().forEach((n,o)=>{n.at+=t,n.at>=n.rt&&(y.splice(o,1),n.action(n.rt,n.at))})})(t),c.forEach(n=>n(o,t)),o.$()},pt:t=>{s.forEach(n=>n(o,t))},wt:Y,ft:q})}()}();