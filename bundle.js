!function(){"use strict";function t(t,n){return{x:t||0,y:n||0}}const n=(t,n)=>(t.x=n.x,t.y=n.y,t),e=(t,n,e)=>(t.x=n,t.y=e,t),o=(t,n,e)=>(t.x=n.x+e.x,t.y=n.y+e.y,t),c=(t,n,e)=>(t.x=n.x-e.x,t.y=n.y-e.y,t),s=(t,n)=>t.x*n.x+t.y*n.y,r=(t,n,e)=>(t.x=n.x*e,t.y=n.y*e,t),i=(t,n)=>{const e=t.x-n.x,o=t.y-n.y;return Math.sqrt(e*e+o*o)},a=t=>{const n=t.x,e=t.y;return Math.sqrt(n*n+e*e)},u=(t,n)=>{const e=n.x,o=n.y;let c=e*e+o*o;return c>0&&(c=1/Math.sqrt(c),t.x=n.x*c,t.y=n.y*c),t},h=(t,n)=>{t.t.x+=t.o.x*n*n*.001,t.t.y+=t.o.y*n*n*.001,e(t.o,0,0)},f=t(),l=t(),p=t(),w=t(),d=t(),v=t(),M=t(),g=t(),y=t(),x=t(),b=t(),m=t(),k=t(),S=t(),T=(i,h,T,A,O,L,C,R,D,I,P,N,H,E,j)=>{e(f,0,0),e(l,0,0),e(p,0,0),e(w,0,0),e(d,0,0),e(v,0,0),e(M,0,0),e(g,0,0),e(y,0,0),e(x,0,0),e(b,0,0),e(m,0,0),e(k,0,0),e(S,0,0),!H||0===H.x&&0===H.y?(c(f,i,C),u(f,f)):e(f,H.x,H.y),r(l,f,-1);const F=T+D,K=1+(A>I?A:I);c(p,i,h);const W=s(f,p);r(w,f,W),c(d,p,w),c(v,C,R);const $=s(l,v);r(M,l,$),c(g,v,M),r(b,w,(T-D)/F),r(m,M,K*D/F),o(y,b,m),o(y,y,d),r(k,w,K*T/F),r(S,M,(D-T)/F),o(x,k,S),o(x,x,g);const G=o(t(),y,x),U=t();r(U,f,s(G,f));const B=c(t(),G,U);u(B,B);let z=-s(G,B);z/=1/(T+D);const Y=Math.abs(z);if(Y>1e-4){const n=a(d),e=a(g),c=t(),s=t();r(c,B,Y<n*O?O:-n*L),r(s,B,Y<e*P?P:-e*N),o(y,y,c),o(x,x,s)}n(E,y),n(j,x)},A=t=>{const n=2*t.t.x-t.i.x,o=2*t.t.y-t.i.y;e(t.i,t.t.x,t.t.y),e(t.t,n,o)},O=t(),L=t();function C(t,n,e,o,s){c(O,n,t),c(L,o,e);const r=(-O.y*(t.x-e.x)+O.x*(t.y-e.y))/(-L.x*O.y+O.x*L.y),i=(L.x*(t.y-e.y)-L.y*(t.x-e.x))/(-L.x*O.y+O.x*L.y);return r>=0&&r<=1&&i>=0&&i<=1&&(s.x=t.x+i*O.x,s.y=t.y+i*O.y,!0)}const R=t(),D=t(),I=t(),P=t(),N=t(),H=t();const E=t(),j=t();function F(t,n,o,r){if(c(E,o,n),0===E.x&&0===E.y)throw new Error("ZeroLengthEdge");const a=((t.x-n.x)*E.x+(t.y-n.y)*E.y)/(E.x*E.x+E.y*E.y);r.u=a;const h=e(r.h,n.x+a*E.x,n.y+a*E.y);r.l=i(h,t);const f=((t,n,e)=>(t.y=e.x-n.x,t.x=n.y-e.y,u(t,t)))(r.p,n,o);c(j,t,h),r.v=s(f,j)}function K(t){return t&&"object"==typeof t&&"number"==typeof t.id}class W{constructor(t){this.M=t,this.g=W.hash(this.M),this.m=new Set}k(t){this.m.add(t)}S(t,n){const e=n.map(t=>t.T);this.M.every(t=>e.indexOf(t)>-1)&&!this.m.has(t)&&this.m.add(t)}A(t,n){const e=n.map(t=>t.T);this.M.every(t=>e.indexOf(t)>-1)&&this.m.has(t)&&this.m.delete(t)}static hash(t){return t.slice().sort().join("|")}}const $=33.3333333,G=new class{constructor(){this.O=1,this.m=new Map,this.L=new Map,this.C=new Set}R(t){const n={id:this.O++};return this.m.set(n,t),this.L.forEach(e=>e.S(n,t)),n}D(t){this.C.add(t)}I(t){return this.C.has(t)}P(){if(0===this.C.size)return;let t=!1;const n=e=>{e&&"object"==typeof e&&!K(e)&&Object.values(e).forEach(e=>{K(e)?(this.D(e),t=!0):n(e)})};this.C.forEach(t=>{if(this.C.delete(t),!this.m.has(t))return;const e=this.m.get(t);e.forEach(t=>{n(t)}),this.m.delete(t),this.L.forEach(n=>n.A(t,e))}),t&&this.P()}select(t){const n=W.hash(t);if(this.L.has(n))return this.L.get(n).m;const e=new W(t);return this.L.set(e.g,e),this.m.forEach((n,o)=>{let c=!0;for(let e=0;e<t.length;e++){const o=t[e];n.find(t=>t.T===o)||(c=!1)}c&&e.k(o)}),e.m}N(t){return this.select(t).values().next().value}data(t,n){const e=this.m.get(t);let o;for(let t=0;t<e.length;t++){const c=e[t];c.T===n&&(o=c)}return o}H(t){const n=this.N([t]);if(!n)return;return this.data(n,t)}};function U(){return G}function B(t,n,e){const o=e.getContext("2d"),c=window.devicePixelRatio||1;return e.style.width=t+"px",e.style.height=n+"px",e.width=Math.floor(t*c),e.height=Math.floor(n*c),o.scale(c,c),o.webkitImageSmoothingEnabled=!1,o.msImageSmoothingEnabled=!1,o.mozImageSmoothingEnabled=!1,o.imageSmoothingEnabled=!1,{width:t,height:n,j:e,F:o,K:c}}const z=document.querySelector.bind(document),Y=(document.querySelectorAll.bind(document),z("#r")),q=z("#c"),Z=z("#u");if(!Y||!q||!Z)throw new Error("Could not locate DOM!");function J(t,n,e,o){return t.addEventListener(n,e,o),()=>{t.removeEventListener(n,e,o)}}const Q="transparent",V="rgba(255,255,132,1)",X="rgba(255,255,132,0.5)",_="rgba(40,40,40,1)",tt=45,nt="Arial, sans-serif",et="Courier, Courier New, monospace";function ot(n=0,e=0){return t(n,e)}function ct(t){const n=U().H("vp"),e=n.W;return t/n.$*e.width}function st(t,n){const e=U().H("vp"),{G:o}=e;return ct(t-("x"===n?o.target.x:o.target.y))}const rt=t=>t/U().H("vp").W.width*100;function it(t){const e=U().H("vp");n(e.G.target,t)}function at(){const t=U().H("vp"),{F:n}=t.W;n.save(),function(t){const{F:n}=t.W,{G:e}=t;n.scale(1,-1),n.translate(-ct(e.U.x),-ct(e.U.y))}(t),n.clearRect(0,0,t.W.j.width,t.W.j.height),n.restore()}function ut(t=_){const n=U().H("vp"),{F:e}=n.W;e.fillStyle=t;const o=2*n.G.U.x,c=n.B-2*n.G.U.y;e.fillRect(st(n.G.target.x-n.G.U.x,"x"),st(n.G.target.y-n.G.U.y,"y"),ct(o),ct(-c))}function ht(t,n,e,c,s,r="transparent",i=nt){const a=U().H("vp"),{G:u}=a,h=ot();return h.x=u.target.x-u.U.x,h.y=u.target.y+u.U.y,o(h,h,n),ft(t,h,e,c,s,r,i)}function ft(t,n,e,o,c,s="transparent",r=nt){const i=U().H("vp"),{G:a}=i,{F:u}=i.W;u.save(),u.scale(1,-1);const{Y:h,font:f}=lt(t,o,r);let l=0,p=ct(-n.y+a.target.y);return u.font=f,t.split("\n").forEach((t,o)=>{const r=u.measureText(t).width+1,i=ct(h);0===o&&(p+=i);const a="center"===e?st(n.x,"x")-r/2:"left"===e?st(n.x,"x"):st(n.x,"x")-r;"transparent"!==s&&(u.fillStyle=s,u.fillRect(a,p,r,-i)),u.fillStyle=c,u.fillText(t,a,p),p+=i,l+=i}),u.restore(),rt(l)}function lt(t,n,e=nt){const o=U().H("vp"),{F:c}=o.W,s=o.height/n;c.save();const r=`${s}px/1.2 ${e}`;c.font=r;const i=c.measureText(t),a=1.2*(i.actualBoundingBoxAscent?i.actualBoundingBoxAscent+i.actualBoundingBoxDescent:s);c.restore();const u=t.split("\n");return{font:r,fontSize:s+"px",total:rt(a*u.length),q:1.2,Y:rt(a)}}function pt(){const t=window.innerWidth<window.innerHeight?window.innerWidth:.6*window.innerHeight,n=window.innerWidth<window.innerHeight?window.innerWidth/.6:window.innerHeight;return{T:"vp",ratio:.6,width:t,height:n,$:100,B:100/.6,W:B(t,n,q),G:{U:ot(50,50),mode:"center",target:ot(0,0)}}}function wt(){const t=pt(),n=U(),e=n.N(["vp"]);e&&n.D(e);Y.style.width=t.width+"px";const o=n=>Math.floor(n/t.$*t.W.width);t.W.F.translate(o(t.G.U.x),o(t.G.U.y)),t.W.F.scale(1,-1);const c=[t];n.R(c)}function dt(t,n,e,o){const c=n.x-e.x,s=n.y-e.y,r=Math.sin(o),i=Math.cos(o);return t.x=c*i-s*r+e.x,t.y=c*r+s*i+e.y,t}function vt(){return{l:0,v:0,u:0,h:t(),p:t()}}window.addEventListener("resize",wt);const Mt=t(),gt=t(),yt=t();function xt(t,n,e){return c(Mt,n.t,n.i),u(gt,Mt),r(yt,gt,e),o(t,yt,n.t),t}function bt(t){return Math.atan2(t.y,t.x)}const mt=new URLSearchParams(window.location.search);function kt(t,n){const{width:e,height:c}=function(t){return{width:t.$,height:Math.min(.75*t.$,.75*t.B)}}(n),s=t.width/2,i=t.height/2,a=n.G.target,u=ot(Math.cos(t.Z),Math.sin(t.Z)),h=r(ot(),u,Math.min(e/2,c/2)),f=o(ot(),a,h),l=ot(f.x,f.y-s),p=ot(f.x,f.y+s);return dt(l,l,f,t.Z),dt(p,p,f,t.Z),{x:f.x,y:f.y,angle:t.Z,J:s,V:i,X:l,p1:p}}function St(t,e,s,i){h(t,i);const{X:a,p1:u,V:f}=kt(e,s),l={_:a,tt:u},p=t,w=f,d=vt();F(p.t,l._,l.tt,d);const v=n(ot(),d.h),M=c(ot(),e.nt.t,e.nt.i),g=c(ot(),v,M),y=2+w;if(d.u>=0&&d.u<=1&&d.l<=y){const t=1,n=1e7,e=.5,s=.87,i=.87,a=ot(),u=ot();T(p.t,p.i,t,e,s,i,v,g,n,e,s,i,d.p,a,u),c(p.i,p.t,a);const h=Math.abs(y-d.l);((t,...n)=>{for(let e=0;e<n.length;e++){const c=n[e];o(c,c,t)}})(r(ot(),d.p,d.v>0?h:-h),p.t,p.i)}A(t)}const Tt=mt.get("seed"),At=Tt?Number(Tt):Date.now(),Ot=(Ct=61^(Ct=At)^Ct>>>16,Ct+=Ct<<3,Ct=Math.imul(Ct,668265261),Lt=(Ct^=Ct>>>15)>>>0,t=>(Lt=Lt+1831565813|0,(((t=(t=Math.imul(Lt^Lt>>>15,1|Lt))+Math.imul(t^t>>>7,61|t)^t)^t>>>14)>>>0)/2**32));var Lt,Ct;const Rt=()=>Ot();function Dt(){const t=U().H("vp"),{G:n,W:{F:e}}=t;e.fillStyle=_,e.fillRect(st(n.target.x-n.U.x,"x"),st(n.target.y+n.U.y,"y"),ct(2*n.U.x),ct(2*-n.U.y))}let It;function Pt(){const t=U().H("vp"),{G:n}=t,e=2*n.U.x,o=2*n.U.y;if(!It){const n=document.createElement("canvas"),c=n.getContext("2d");It=B(ct(2*t.G.U.x),ct(2*t.G.U.y),n);const s=.1,r=.3,i=2*t.G.U.y*8;c.fillStyle=X;let a=0;for(;a<i;){const t=Rt()*e,n=Rt()*o,i=Rt()*(r-s)+s;c.beginPath(),c.arc(ct(t),ct(n),ct(i),0,2*Math.PI,!1),c.fill(),a++}}const c=n.target.x/e,s=n.target.y/o,r=Math.floor(c),i=Math.floor(s);let a=n.target.x%e/e,u=n.target.y%o/o;a=n.target.x<0?1-Math.abs(a):a,u=n.target.y<0?1-Math.abs(u):u;const h=t.W.F;Dt(),h.drawImage(It.j,0,0,ct(e),ct(o),st(r*e,"x"),st(i*o,"y"),ct(e),ct(o)),a<.5&&h.drawImage(It.j,0,0,ct(e),ct(o),st((r-1)*e,"x"),st(i*o,"y"),ct(e),ct(o)),a>=.5&&h.drawImage(It.j,0,0,ct(e),ct(o),st((r+1)*e,"x"),st(i*o,"y"),ct(e),ct(o)),u<.5&&h.drawImage(It.j,0,0,ct(e),ct(o),st(r*e,"x"),st((i-1)*o,"y"),ct(e),ct(o)),u>=.5&&h.drawImage(It.j,0,0,ct(e),ct(o),st(r*e,"x"),st((i+1)*o,"y"),ct(e),ct(o)),a<.5&&u<.5&&h.drawImage(It.j,0,0,ct(e),ct(o),st((r-1)*e,"x"),st((i-1)*o,"y"),ct(e),ct(o)),a>=.5&&u<.5&&h.drawImage(It.j,0,0,ct(e),ct(o),st((r+1)*e,"x"),st((i-1)*o,"y"),ct(e),ct(o)),a<.5&&u>=.5&&h.drawImage(It.j,0,0,ct(e),ct(o),st((r-1)*e,"x"),st((i+1)*o,"y"),ct(e),ct(o)),a>=.5&&u>=.5&&h.drawImage(It.j,0,0,ct(e),ct(o),st((r+1)*e,"x"),st((i+1)*o,"y"),ct(e),ct(o))}function Nt(t,n,e){if(!e.et)return;const o=ot(),c=C(xt(ot(),t,n),t.i,e._,e.tt,o),s=vt();F(t.i,e._,e.tt,s),c&&s.v<0&&(e.et=!1)}function Ht(t,n,e){if(e.et)return;const s=ot(),i=C(xt(ot(),t,n),t.i,e._,e.tt,s),a=vt();if(F(t.i,e._,e.tt,a),i&&a.v>0){h=t,f=n,l={t:e._,i:e._,o:ot()},p={t:e.tt,i:e.tt,o:ot()},c(I,h.t,h.i),u(P,I),r(N,P,f),o(H,N,h.t),C(H,h.i,l.t,p.t,R)&&(c(D,H,R),c(h.t,h.t,D),c(h.i,h.i,D));const i=1,w=1e7,d=1,v=0,M=0,g=ot(),y=ot();T(t.t,t.i,i,d,v,M,s,s,w,d,v,M,a.p,g,y),c(t.i,t.t,g)}var h,f,l,p}function Et(t=ot(0,0)){const e=U().H("vp");return{Z:0,width:e.$/2,height:e.$/16,nt:{o:ot(),t:n(ot(),t),i:n(ot(),t)}}}function jt(t=ot(),e=0,o=ot()){const s=U().H("vp"),i={t:n(ot(),t),i:n(ot(),t),o:ot(),width:s.$/32,height:s.$/32},a=r(ot(),o,e);return c(i.i,i.t,a),i}function Ft(t){return{nt:{t:n(ot(),t),i:n(ot(),t),o:ot()},ot:ot(10,10)}}function Kt(t,n){return{_:t,tt:n,et:!1}}const Wt={ct:0,st:null,state:"boot",level:-1,rt:null,it:[],at:[function(){return{ut:jt(ot(),.1,ot(1,1)),ht:Et(),target:Ft(ot(-10,-10)),ft:[Kt(ot(50,50),ot(-50,50)),Kt(ot(-50,50),ot(-50,-50)),Kt(ot(-50,-50),ot(50,-50)),Kt(ot(50,-50),ot(50,50))],lt:[],wt:"Signal, meet target"}},function(){return{ut:jt(ot(0,-10),.5,ot(0,1)),ht:Et(),target:Ft(ot(30,10)),ft:[Kt(ot(20,15),ot(-20,15)),(t=ot(-20,5),n=ot(20,5),{_:t,tt:n,et:!0}),Kt(ot(50,50),ot(-50,50)),Kt(ot(-50,50),ot(-50,-50)),Kt(ot(-50,-50),ot(50,-50)),Kt(ot(50,-50),ot(50,50))],lt:[],wt:"One way is the only way"};var t,n},function(){const t=Et();return{ut:jt(ot(-30,-40),.5,ot(0,1)),ht:t,target:Ft(ot(30,-40)),ft:[Kt(ot(50,50),ot(-50,50)),Kt(ot(-50,50),ot(-50,-50)),Kt(ot(-50,-50),ot(50,-50)),Kt(ot(50,-50),ot(50,50))],lt:[(e=ot(-20,10),o=ot(1,-1),{nt:{t:n(ot(),e),i:n(ot(),e),o:ot()},ot:ot(10,10),dt:n(ot(),o)})],wt:"Arrows, they shoot"};var e,o}]};function $t(t){const n=Wt;n.st=n.state,n.state=t,n.ct=0}function Gt(t){return t*$/1e3}function Ut(t){return t.toFixed(3)}const Bt={KeyW:!1,KeyA:!1,KeyS:!1,KeyD:!1,ArrowLeft:!1,ArrowRight:!1,ShiftLeft:!1,ShiftRight:!1};function zt(){return Bt}function Yt(t,n,e,o){const c=U().H("vp"),s=c.G.target,{U:r}=c.G,a=[[ot(s.x-r.x,s.y+r.y),ot(s.x+r.x,s.y+r.y),vt()],[ot(s.x+r.x,s.y+r.y),ot(s.x+r.x,s.y-r.y),vt()],[ot(s.x+r.x,s.y-r.y),ot(s.x-r.x,s.y-r.y),vt()],[ot(s.x-r.x,s.y-r.y),ot(s.x-r.x,s.y+r.y),vt()]];for(let n=0;n<a.length;n++){const[e,o,c]=a[n];F(t,e,o,c)}const[[u,h,f],[l,p,w],[d,v,M],[g,y,x]]=a;let b,m,k;const S=lt(o,tt);if(f.v>0&&w.v>0)b=ot(w.h.x,f.h.y),m=i(b,t),k="right";else if(w.v>0&&M.v>0)b=ot(w.h.x,M.h.y+S.Y),m=i(b,t),k="right";else if(M.v>0&&x.v>0)b=ot(x.h.x,M.h.y+S.Y),m=i(b,t),k="left";else if(x.v>0&&f.v>0)b=ot(x.h.x,f.h.y),m=i(b,t),k="left";else if(f.v>0)b=ot(Math.min(Math.max(f.h.x,u.x),h.x),f.h.y),m=f.l,k="center";else if(w.v>0)b=ot(w.h.x,Math.max(Math.min(l.y,w.h.y),p.y)),m=w.l,k="right";else if(M.v>0)b=ot(Math.max(Math.min(d.x,M.h.x),v.x),M.h.y+S.Y),m=M.l,k="center";else{if(!(x.v>0))return;b=ot(x.h.x,Math.min(Math.max(g.y,x.h.y),y.y)),m=x.l,k="left"}if(m<.7*((n.x/2+n.y/2)/2))return;const T=c.W.F;T.save(),ft(o,b,k,tt,_,V),T.restore()}J(window,"keydown",t=>{Bt[t.code]=!0}),J(window,"keyup",t=>{Bt[t.code]=!1});function qt(t,n){return!!((t,n,o,c,s,r,i,a,u)=>{const h=s-t,f=i/2+o/2-Math.abs(h),l=r-n,p=a/2+c/2-Math.abs(l);if(f<=0)return null;if(p<=0)return null;if(e(u.resolve,0,0),e(u.vt,0,0),e(u.Mt,0,0),f<p){const n=h<0?-1:1;u.resolve.x=f*n,u.Mt.x=n,u.vt.x=t+o/2*n,u.vt.y=r}else{const t=l<0?-1:1;u.resolve.y=p*t,u.Mt.y=t,u.vt.x=s,u.vt.y=n+c/2*t}return u})(t.nt.t.x,t.nt.t.y,t.ot.x,t.ot.y,n.t.x,n.t.y,n.width,n.height,{resolve:ot(),vt:ot(),Mt:ot()})}let Zt=0,Jt=[];const Qt=()=>{Zt=0,Jt.length=0},Vt=U(),Xt=Vt.R([{T:"fps",gt:60}]),_t=t=>{if(!mt.has("debug"))return;ht(t.H("fps").gt.toFixed(2),ot(100,0),"right",tt,V)};function tn(t){Vt.data(Xt,"fps").gt=t}function nn(t){const n=U().H("vp"),e=n.W.F,{x:o,y:c}=t.nt.t,s=t.ot.x/2,r=t.ot.x/4,i=n.$/64,a=t.ot.y/i,u=s*Math.SQRT2,h=i*Math.SQRT2/2;e.save(),e.fillStyle=V,e.strokeStyle=V;const f=bt(t.dt);e.translate(st(o,"x"),st(c,"y")),e.rotate(f-Math.PI/2),en(e,a,i,u,0,0-r+h,Math.PI/4),en(e,a,i,u,0,0+r-h,-Math.PI/4),e.restore()}function en(t,n,e,o,c,s,r){for(let i=0;i<n;i+=2){t.save(),t.translate(ct(s),ct(c+i*e)),t.rotate(r);(i<Math.floor(n/4)?t.strokeRect:t.fillRect).call(t,ct(0-o/2),ct(0),ct(o),ct(e)),t.restore()}}function on(t,o){const c=o.nt.t,s=(o.ot.y,o.ot.x/2),r=ot(c.x,c.y+s),i=ot(c.x,c.y-s),a=bt(o.dt);dt(r,r,c,a),dt(i,i,c,a);const u=ot(),h=C(t.i,t.t,r,i,u),f=vt();F(t.i,r,i,f),h&&f.v<0&&(n(t.t,o.nt.t),n(t.i,t.t),e(t.o,5*o.dt.x,5*o.dt.y))}const cn="--ctrlDisplay";function sn(t,n){z(":root").style.setProperty(t,n)}const rn={yt:()=>{},xt:()=>{}},an={bt:!1,move:t(),rotate:ot()};function un(){const t=z("#btn-boost"),n=z("#btn-reset"),e=z("#stick-move"),o=z("#stick-move .ui-nub"),c=z("#stick-rotate"),s=z("#stick-rotate .ui-nub"),r=fn(e,o,an.move),i=fn(c,s,an.rotate),a=function(t,n){const e=J(t,"mouseup",t=>{t.preventDefault(),n()}),o=J(t,"touchstart",t=>{t.preventDefault()}),c=J(t,"touchend",t=>{n()});return()=>{e(),o(),c()}}(n,()=>{rn.yt()}),u=J(t,"mousedown",()=>{an.bt=!0}),h=J(t,"mouseup",()=>{an.bt=!1}),f=J(t,"touchstart",()=>{an.bt=!0}),l=J(t,"touchend",()=>{an.bt=!1});rn.xt=()=>{u(),h(),f(),l(),a(),r(),i()}}function hn(){sn(cn,"none")}function fn(n,e,o){const c=t(),s=t(),r=J(n,"touchstart",t=>{t.preventDefault();const e=t.targetTouches[0];c.x=e.screenX,c.y=e.screenY;const o=n.getBoundingClientRect();s.x=o.width,s.y=o.height}),i=J(n,"touchmove",t=>{t.preventDefault();const n=t.targetTouches[0],r=n.screenX-c.x,i=-1*(n.screenY-c.y);o.x=r/(s.x/2),o.y=i/(s.y/2),u(o,e)}),a=J(n,"touchend",t=>{t.preventDefault(),c.x=c.y=0,s.x=s.y=0,o.x=o.y=0,u(o,e)});function u(t,n){const e=(t.x+1)/2*100,o=-(t.y-1)/2*100,c=Math.max(Math.min(e,100),0),s=Math.max(Math.min(o,100),0);n.style.setProperty("--leftPct",c+"%"),n.style.setProperty("--topPct",s+"%")}return()=>{r(),i(),a(),c.x=c.y=0,s.x=s.y=0,o.x=o.y=0,u(o,e)}}function ln(){}!async function(){await async function(){}();const t=U();wt(),function(){const t=ct(U().H("vp").G.U.y),n=2*t,{fontSize:e}=lt("M",tt,nt);sn("--yellowRGBA",V),sn("--blackRGBA",_),sn("--bodyFontSize",e),sn("--ctrlPanelHeight",t+"px"),sn("--ctrlPanelTop",n+"px")}();const n=[],s=[];n.push(t=>{at()});const i=t.H("vp");n.push((function(t,n){switch(Wt.state){case"boot":{Pt();let t=10;t-=ft("SIGNAL DECAY",ot(0,t),"center",20,V,Q,et),t-=5,ft("a js13k entry by\nDrew Petersen",ot(0,t),"center",tt,V),t-=20,ft("TAP OR CLICK TO START",ot(0,t),"center",tt,V,Q,et),ut();break}case"tutorial":{Dt();let t=50;const n=-45;t-=5,t-=ft(["Be the best signalmancer in the galaxy!","","Help messages from deep space colonies bounce their","way to their targets as quickly as possible."].join("\n"),ot(n,t),"left",tt,V),t-=5,t-=ft("CONTROLS (KEYBOARD)",ot(n,t),"left",tt,V,Q,et),t-=5,t-=ft(["WASD:  move","Hold any SHIFT to boost","","Arrow Left / Arrow Right: rotate the Deflector"].join("\n"),ot(n,t),"left",tt,V),t-=5,t-=ft("CONTROLS (TOUCH)",ot(n,t),"left",tt,V,Q,et),t-=5,t-=ft(["Left Stick:  move","Move stick and hold BOOST to boost","","Right Stick: rotate the Deflector"].join("\n"),ot(n,t),"left",tt,V),t-=5,t-=ft("TAP OR CLICK TO CONTINUE",ot(0,t),"center",tt,V,Q,et),ut();break}case"level":{if(!Wt.rt)break;const{target:t,ht:n,ut:e,ft:o,lt:s}=Wt.rt;Pt(),function(t,n){const e=U().H("vp").W.F,{x:o,y:c}=t.nt.t,s=t.ot.x/2,r=t.ot.y/2;e.save(),e.fillStyle=V,e.translate(st(o,"x"),st(c,"y")),e.fillRect(0-ct(s),0-ct(r),ct(t.ot.x),ct(t.ot.y)),e.restore()}(t),function(t){const n=U().H("vp"),e=n.W.F,{x:o,y:c,angle:s,V:r,J:i,X:a,p1:u}=kt(t,n);e.save(),e.fillStyle=V,e.translate(st(o,"x"),st(c,"y")),e.rotate(Math.PI/2+s),e.fillRect(0-ct(i),0-ct(r),ct(t.width),ct(t.height)),e.restore()}(n),function(t,n){const e=U().H("vp"),o=e.W.F,{t:s,i:i,width:h,height:f}=t,l=h/2,p=f/2,w=st(i.x+1*(s.x-i.x),"x"),d=st(i.y+1*(s.y-i.y),"y"),v=ct(h),M=ct(f);o.save();{const t=c(ot(),s,i),n=u(t,t),a=r(n,n,10*e.$);o.lineWidth=ct(1),o.strokeStyle=X,o.setLineDash([ct(1),ct(3)]),o.beginPath(),o.moveTo(w,d),o.lineTo(w+ct(a.x),d+ct(a.y)),o.stroke(),o.setLineDash([])}{const t=l/8,n=c(ot(),s,i),e=a(n)/t,h=u(n,n);o.fillStyle="rgba(255,255,132,0.1)";const f=ot();for(let n=0;n<e;n++)r(f,h,n*t),o.fillRect(w-ct(f.x)-ct(l),d-ct(f.y)-ct(p),v,M)}o.fillStyle=V,o.fillRect(w-ct(l),d-ct(p),v,M),o.restore()}(e),function(t){for(let n=0;n<t.length;n++)nn(t[n])}(s),function(t){const{W:{F:n}}=U().H("vp");n.save(),n.strokeStyle=V,n.lineWidth=ct(1);for(let e=0;e<t.length;e++){const o=t[e];o.et?n.setLineDash([ct(1),ct(2)]):n.setLineDash([]),n.beginPath(),n.moveTo(st(o._.x,"x"),st(o._.y,"y")),n.lineTo(st(o.tt.x,"x"),st(o.tt.y,"y")),n.closePath(),n.stroke()}n.restore()}(o),ut(),function(t,n){const e=U().H("vp");if(!t.rt)return;ht(Ut(Gt(t.ct)),ot(e.$/2,-1),"center",tt,V),ht(`MISSION ${t.level+1}: ${t.rt.wt.toUpperCase()}`,ot(e.G.U.x,2*-e.G.U.y),"center",tt,V,Q,et),Yt(t.rt.target.nt.t,t.rt.target.ot,0,"TARGET"),Yt(t.rt.ut.t,ot(t.rt.ut.width,t.rt.ut.height),0,"SIGNAL")}(Wt);break}case"win":{Dt();const t=Ut(Gt(Wt.it[Wt.level]));let n=10;n-=ft("MISSION SUCCESS",ot(0,n),"center",20,V,Q,et),n-=5,n-=ft(t+"s",ot(0,n),"center",tt,V,Q,nt),n-=10,n-=ft("Finding the next signal in\nneed of assistance...",ot(0,n),"center",tt,V,Q,nt),ut();break}case"nextlevel":break;case"thanks":{Dt();let t=45;t-=ft("ALL SIGNALS MADE IT,\nTHANKS TO YOU!",ot(0,t),"center",tt,V,Q,et);let n=0;t-=5;for(let e=0;e<Wt.it.length;e++){const o=Wt.it[e];n+=o,ft(`MISSION ${e+1}:`,ot(-45,t),"left",tt,V,Q,et),t-=ft(Ut(Gt(o))+"s:",ot(45,t),"right",tt,V,Q,et)}const e=Ut(Gt(n));t-=5,t-=ft(`TOTAL: ${e}s`,ot(45,t),"right",tt,V,Q,et),ut(),0===Wt.ct&&(sn("--thanksDisplay","block"),function(t){const n=`I prevented Signal Decay in ${t}s!`,e=new URLSearchParams;e.append("text",n),e.append("url","https://kirbysayshi.com/js13k-2020"),e.append("hashtags",["js13k"].join(",")),z("#btn-tweet").setAttribute("href","https://twitter.com/intent/tweet?"+e.toString())}(e));break}}})),s.push((t,n)=>{switch(Wt.state){case"boot":if(0===Wt.ct){hn();const n=J(t.H("vp").W.j,"click",()=>{n(),Qt(),$t("tutorial")})}break;case"tutorial":if(0===Wt.ct){hn();const n=J(t.H("vp").W.j,"click",()=>{n(),Qt(),$t("nextlevel")})}break;case"level":{if(0===Wt.ct){const t=Wt.at[Wt.level];if(!t)return $t("thanks");Wt.rt=t(),sn(cn,"flex"),un(),r=()=>{Wt.rt=t()},rn.yt=r}if(!Wt.rt)break;const{target:t,ht:c,ut:s,lt:a,ft:u}=Wt.rt,f=an,l=zt();l.ArrowLeft&&(c.Z+=.1),l.ArrowRight&&function(t){t.Z-=.1}(c);const p=0!==f.rotate.x&&0!==f.rotate.y,w=bt(f.rotate);p&&function(t,n){t.Z=n}(c,w);const d=ot();let v=0;l.KeyW&&l.KeyD?v=Math.PI/4:l.KeyW&&l.KeyA?v=Math.PI*(3/4):l.KeyS&&l.KeyD?v=-Math.PI/4:l.KeyS&&l.KeyA?v=-Math.PI*(3/4):l.KeyW?v=Math.PI/2:l.KeyA?v=Math.PI:l.KeyS?v=-Math.PI/2:l.KeyD&&(v=0);const M=0!==f.move.x&&0!==f.move.y,g=bt(f.move),y=l.ShiftLeft||l.ShiftRight||f.bt?ot(1,0):ot(.2,0);M&&(v=g);const x=dt(ot(),y,d,v);M&&e(x,x.x*Math.abs(f.move.x),x.y*Math.abs(f.move.y));if((0!==v||0===v&&l.KeyD||M)&&function(t,n){o(t.nt.o,t.nt.o,n)}(c,x),((t,n)=>{const e=(t.i.x-t.t.x)*n,o=(t.i.y-t.t.y)*n;t.i.x=t.t.x+e,t.i.y=t.t.y+o})(c.nt,.8),h(c.nt,n),St(s,c,i,n),function(t,n){for(let e=0;e<n.length;e++)on(t,n[e])}(s,a),function(t,n){for(let e=0;e<t.length;e++){const o=t[e];Nt(n,n.width/2,o),Ht(n,n.width/2,o)}}(u,s),A(c.nt),it(c.nt.t),qt(t,s)){const t=Wt;return t.it[t.level]=t.ct,t.rt=null,rn.xt(),it(ot(0,0)),$t("win")}break}case"win":{it(ot(0,0));const t=3e3;0===Wt.ct&&(hn(),c=()=>$t("nextlevel"),s=t,Jt.push({id:++Zt,action:c,delay:s,kt:0}));break}case"nextlevel":return Wt.level+=1,$t("level");case"thanks":hn(),it(ot(0,0))}var c,s,r;Wt.ct+=1}),n.push(_t);const{stop:f}=(({St:t,Tt:n,At:e,update:o,Ot:c=10,Lt:s=(()=>{}),Ct:r=(()=>{})})=>{const i=window.performance,a=t,u=n,h=i.now.bind(i),f=window.requestAnimationFrame.bind(window);let l=0,p=null,w=h(),d=h(),v=0,M=60;return function t(){const n=h();p=f(t),l+=n-w,w=n;let i=l-a>=0,g=Math.floor(l/u);if(g>=c)return l=0,w=h(),void s();for(;g-- >0;)l-=u,o(u);i&&e(l/a),v+=1,d+1e3<=n&&(M=.25*v+.75*M,v=0,d=n,r(M))}(),{stop:()=>{p&&cancelAnimationFrame(p)}}})({St:16.6666666,Tt:$,update:n=>{((t=1)=>{Jt.slice().forEach((n,e)=>{n.kt+=t,n.kt>=n.delay&&(Jt.splice(e,1),n.action(n.delay,n.kt))})})(n),s.forEach(e=>e(t,n)),t.P()},At:e=>{n.forEach(n=>n(t,e))},Lt:ln,Ct:tn})}()}();