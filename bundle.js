!function(){"use strict";function t(t,n){return{x:t||0,y:n||0}}const n=(t,n)=>(t.x=n.x,t.y=n.y,t),o=(t,n,o)=>(t.x=n,t.y=o,t),e=(t,n,o)=>(t.x=n.x+o.x,t.y=n.y+o.y,t),s=(t,n,o)=>(t.x=n.x-o.x,t.y=n.y-o.y,t),c=(t,n)=>t.x*n.x+t.y*n.y,i=(t,n,o)=>(t.x=n.x*o,t.y=n.y*o,t),r=(t,n)=>{t.t.x+=t.o.x*n*n*.001,t.t.y+=t.o.y*n*n*.001,o(t.o,0,0)},a={x:0,y:0},u={x:0,y:0},h={x:0,y:0},p={x:0,y:0},l=(t,n,c,i,r,l,w,f)=>{const d=((t,n)=>{const o=t.x-n.x,e=t.y-n.y;return o*o+e*e})(t.t,i.t),x=n+r;s(a,t.t,t.i),s(u,i.t,i.i),s(h,t.t,i.t);const v=Math.sqrt(d);let M=(v-x)/v;0===v&&(M=1);const b=c>0?c:1,y=l>0?l:1,g=b+y;if(p.x=h.x*M*(y/g),p.y=h.y*M*(y/g),c>0&&s(t.t,t.t,p),p.x=h.x*M*(b/g),p.y=h.y*M*(b/g),l>0&&e(i.t,i.t,p),!w)return;const m=(f=f||1)*(h.x*a.x+h.y*a.y)/(d||1),k=f*(h.x*u.x+h.y*u.y)/(d||1);a.x+=(k*h.x-m*h.x)/(b||1),u.x+=(m*h.x-k*h.x)/(y||1),a.y+=(k*h.y-m*h.y)/(b||1),u.y+=(m*h.y-k*h.y)/(y||1),c>0&&o(t.i,t.t.x-a.x,t.t.y-a.y),l>0&&o(i.i,i.t.x-u.x,i.t.y-u.y)},w=t(),f=t(),d=t(),x=t();function v(o,r,a,u,h,p,v,M,b){s(f,p.t,u.t),((t,n)=>{const o=n.x,e=n.y;let s=o*o+e*e;s>0&&(s=1/Math.sqrt(s),t.x=n.x*s,t.y=n.y*s)})(w,f),s(d,o.t,u.t);const y=c(f,d),g=c(f,f),m=Math.sqrt(g);if(y<0||y>g)return;const k=y/g,D=1-k;i(x,w,k*m),e(x,x,u.t);if(((t,n)=>{const o=t.x-n.x,e=t.y-n.y;return Math.sqrt(o*o+e*e)})(x,o.t)>r)return;const E=D*a,F=k*a,P={t:t(),i:t()},$={t:t(),i:t()};i(P.t,w,k*m),s(P.t,o.t,P.t),i(P.i,w,k*m),s(P.i,o.i,P.i),i($.t,w,D*m),e($.t,o.t,$.t),i($.i,w,D*m),e($.i,o.i,$.i);const j={t:t(),i:t()},A={t:t(),i:t()};n(j.t,P.t),n(j.i,P.i),n(A.t,$.t),n(A.i,$.i);l(P,r,E,u,0,h,M,b),l($,r,F,p,0,v,M,b);const B={t:t(),i:t()},O={t:t(),i:t()};s(B.t,P.t,j.t),s(O.t,$.t,A.t),i(B.t,B.t,D),i(O.t,O.t,k),e(o.t,o.t,B.t),e(o.t,o.t,O.t),M&&(s(B.i,P.i,j.i),s(O.i,$.i,A.i),i(B.i,B.i,D),i(O.i,O.i,k),e(o.i,o.i,B.i),e(o.i,o.i,O.i))}const M=t=>{const n=2*t.t.x-t.i.x,e=2*t.t.y-t.i.y;o(t.i,t.t.x,t.t.y),o(t.t,n,e)};let b=0,y=[];function g(t){return t&&"object"==typeof t&&"number"==typeof t.id}class m{constructor(t){this.u=t,this.h=m.hash(this.u),this.p=new Set}l(t){this.p.add(t)}v(t,n){const o=n.map(t=>t.M);this.u.every(t=>o.indexOf(t)>-1)&&!this.p.has(t)&&this.p.add(t)}g(t,n){const o=n.map(t=>t.M);this.u.every(t=>o.indexOf(t)>-1)&&this.p.has(t)&&this.p.delete(t)}static hash(t){return t.slice().sort().join("|")}}const k=new class{constructor(){this.m=1,this.p=new Map,this.k=new Map,this.D=new Set}F(t){const n={id:this.m++};return this.p.set(n,t),this.k.forEach(o=>o.v(n,t)),n}P(t){this.D.add(t)}$(t){return this.D.has(t)}j(){if(0===this.D.size)return;let t=!1;const n=o=>{o&&"object"==typeof o&&!g(o)&&Object.values(o).forEach(o=>{g(o)?(this.P(o),t=!0):n(o)})};this.D.forEach(t=>{if(this.D.delete(t),!this.p.has(t))return;const o=this.p.get(t);o.forEach(t=>{n(t)}),this.p.delete(t),this.k.forEach(n=>n.g(t,o))}),t&&this.j()}select(t){const n=m.hash(t);if(this.k.has(n))return this.k.get(n).p;const o=new m(t);return this.k.set(o.h,o),this.p.forEach((n,e)=>{let s=!0;for(let o=0;o<t.length;o++){const e=t[o];n.find(t=>t.M===e)||(s=!1)}s&&o.l(e)}),o.p}A(t){return this.select(t).values().next().value}data(t,n){const o=this.p.get(t);if(!o)throw new Error(`Entity(${t}) not found!`);let e;for(let t=0;t<o.length;t++){const s=o[t];s.M===n&&(e=s)}if(!e)throw new Error(`Data(${n}) not found for Entity(${t})!`);return e}B(t){const n=this.A([t]);if(!n)return;return this.data(n,t)}};function D(){return k}const E=document.querySelector.bind(document),F=E("#r"),P=E("#c"),$=E("#u");if(!F||!P||!$)throw new Error("Could not locate DOM!");function j(t,n,o,e){return t.addEventListener(n,o,e),()=>{t.removeEventListener(n,o,e)}}function A(n=0,o=0){return t(n,o)}function B(t){const n=D().B("vp"),o=n.O;return Math.floor(t/n.S*o.width)}function O(t,n){const o=D().B("vp"),{T:e}=o;return B(t-("x"===n?e.target.x:e.target.y))}function S(t){const{W:n}=t.O,{T:o}=t;n.scale(1,-1),n.translate(-B(o.H.x),-B(o.H.y))}function T(){const t=window.innerWidth<window.innerHeight?window.innerWidth:.6*window.innerHeight,n=window.innerWidth<window.innerHeight?window.innerWidth/.6:window.innerHeight;return{M:"vp",ratio:.6,width:t,height:n,S:100,C:100/.6,O:function(t,n,o){const e=o.getContext("2d"),s=window.devicePixelRatio||1;return o.style.width=t+"px",o.style.height=n+"px",o.width=Math.round(t*s),o.height=Math.round(n*s),e.scale(s,s),e.webkitImageSmoothingEnabled=!1,e.msImageSmoothingEnabled=!1,e.mozImageSmoothingEnabled=!1,e.I=!1,{width:t,height:n,N:o,W:e,R:s}}(t,n,P),T:{H:A(50,50),mode:"center",target:A(0,0)}}}function W(){const t=T(),n=D(),o=n.A(["vp"]);o&&n.P(o);F.style.width=t.width+"px";const e=n=>Math.floor(n/t.S*t.O.N.width);t.O.W.translate(e(t.T.H.x),e(t.T.H.y)),t.O.W.scale(1,-1);const s=[t];n.F(s)}function H(t,n,o,e){const s=n.x-o.x,c=n.y-o.y,i=Math.sin(e),r=Math.cos(e);return t.x=s*r-c*i+o.x,t.y=s*i+c*r+o.y,t}function C(t,n){const{width:o,height:s}=function(t){return{width:t.S,height:Math.min(t.S,t.C)}}(n),c=t.width/2,r=t.height/2,a=n.T.target,u=A(Math.cos(t.U),Math.sin(t.U)),h=i(A(),u,Math.min(o/2,s/2)),p=e(A(),a,h),l=A(p.x,p.y-c),w=A(p.x,p.y+c);return H(l,l,p,t.U),H(w,w,p,t.U),{x:p.x,y:p.y,angle:t.U,Y:c,q:r,G:l,p1:w}}function I(t){const n=D().B("vp"),o=n.O.W,{x:e,y:s,angle:c,q:i,Y:r,G:a,p1:u}=C(t,n);o.save(),o.fillStyle="rgba(255,255,255,1)",o.translate(O(e,"x"),O(s,"y")),o.rotate(Math.PI/2+c),o.fillRect(0-B(r),0-B(i),B(t.width),B(t.height)),o.restore(),function(t,n,o){z(t,n.G),z(t,n.p1),t.save(),t.beginPath(),t.strokeStyle="black",t.lineWidth=B(.5),t.moveTo(O(n.G.x,"x"),O(n.G.y,"y")),t.lineTo(O(n.p1.x,"x"),O(n.p1.y,"y")),t.stroke(),t.restore()}(o,{G:a,p1:u}),function(t,n,o){t.beginPath(),t.fillStyle="blue",t.arc(O(n.i.x+(n.t.x-n.i.x)*o,"x"),O(n.i.y+(n.t.y-n.i.y)*o,"y"),B(1),0,2*Math.PI),t.fill()}(o,t.J,1)}function z(t,n,o){t.save(),t.beginPath(),t.fillStyle="blue",t.arc(O(n.x,"x"),O(n.y,"y"),B(1),0,2*Math.PI),t.fill(),t.restore()}function N(t,n){return!!((t,n,e,s,c,i,r,a,u)=>{const h=c-t,p=r/2+e/2-Math.abs(h),l=i-n,w=a/2+s/2-Math.abs(l);if(p<=0)return null;if(w<=0)return null;if(o(u.resolve,0,0),o(u.K,0,0),o(u.L,0,0),p<w){const n=h<0?-1:1;u.resolve.x=p*n,u.L.x=n,u.K.x=t+e/2*n,u.K.y=i}else{const t=l<0?-1:1;u.resolve.y=w*t,u.L.y=t,u.K.x=c,u.K.y=n+s/2*t}return u})(t.J.t.x,t.J.t.y,t.V.x,t.V.y,n.t.x,n.t.y,n.width,n.height,{resolve:A(),K:A(),L:A()})}window.addEventListener("resize",W);const R={X:0,Z:null,state:"boot",level:0,_:{tt:null,nt:null,target:null}};function U(t){const n=R;n.Z=n.state,n.state=t,n.X=0}function Y(){}function q(t){D().B("fps").ot=t}!async function(){await async function(){}();const o=D();W();const s=[],c=[];s.push(t=>{!function(){const t=D().B("vp"),{W:n}=t.O;n.save(),S(t),n.clearRect(0,0,t.O.N.width,t.O.N.height),n.restore()}()});const i=o.B("vp");s.push((function(t,n){switch(R.state){case"boot":break;case"level":{const{target:t,tt:o,nt:e}=R._;if(!t||!o||!e)return;!function(t,n){const o=D().B("vp").O.W,{x:e,y:s}=t.J.t,c=t.V.x/2,i=t.V.y/2;o.save(),o.fillStyle="rgba(128,255,255,1)",o.translate(O(e,"x"),O(s,"y")),o.fillRect(0-B(c),0-B(i),B(t.V.x),B(t.V.y)),o.restore()}(t),I(o),function(t,n){const o=D().B("vp").O.W,{t:e,i:s,width:c,height:i}=t,r=c/2,a=i/2,u=O(s.x+n*(e.x-s.x),"x"),h=O(s.y+n*(e.y-s.y),"y"),p=B(c),l=B(i);o.save(),o.fillStyle="rgba(255,255,255,1)",o.fillRect(u-B(r),h-B(a),p,l),o.restore()}(e,n);break}case"win":{const n=t.B("vp"),{W:o}=n.O;o.save();const e=5,s=n.height/e,c=1.5;o.font=`${s}px/${c} monospace`;const i="YOU\nWIN";S(n),o.fillStyle="black";let r=0;i.split("\n").forEach(t=>{const e=o.measureText(t),i=e.width+1,a="et"in e?e.et+e.st:s*c-s;r+=a,o.fillText(t,B(n.S/2)-i/2,r)}),o.restore();break}}})),c.push((o,s)=>{switch(R.state){case"boot":return console.log("boot"),U("nextlevel");case"level":{0===R.X&&(R._=function(){const t=D().B("vp"),n={U:0,width:t.S/8,height:t.S/16,J:{o:A(),t:A(),i:A()}},o={t:A(),i:A(),o:A(),width:t.S/16,height:t.S/16},e={J:{t:A(-10,-10),i:A(-10,-10),o:A()},V:A(10,10)};return o.o.x=.1,o.o.y=.1,{nt:o,tt:n,target:e}}());const{target:t,tt:n,nt:o}=R._,s=a.ArrowLeft,c=a.ArrowRight,i=a.w,r=a.a,u=a.s,h=a.d;s&&(n.U+=.2),c&&function(t){t.U-=.2}(n);const p=A(.2,0),l=A();let w=0;if(i&&h?w=Math.PI/4:i&&r?w=Math.PI*(3/4):u&&h?w=-Math.PI/4:u&&r?w=-Math.PI*(3/4):i?w=Math.PI/2:r?w=Math.PI:u?w=-Math.PI/2:h&&(w=0),(0!==w||h)&&function(t,n){e(t.J.o,t.J.o,n)}(n,H(A(),p,l,w)),N(t,o))return U("win");break}case"win":0===R.X&&(c=()=>U("nextlevel"),u=5e3,y.push({id:++b,action:c,ct:u,it:0}));break;case"nextlevel":return R.level+=1,U("level")}var c,u;const{target:h,tt:p,nt:l}=R._;h&&p&&l&&(((t,n)=>{const o=(t.i.x-t.t.x)*n,e=(t.i.y-t.t.y)*n;t.i.x=t.t.x+o,t.i.y=t.t.y+e})(p.J,.8),r(p.J,s),M(p.J),function(o,e,s,c){r(o,c);const{G:i,p1:a}=C(e,s),u={t:i,i:n(t(),i),o:t()},h={t:a,i:n(t(),a),o:t()};v(o,2,1,u,-1,h,-1,!1,1),M(o),v(o,1,1,u,-1,h,-1,!0,1)}(l,p,i,s),function(t){const o=D().B("vp");n(o.T.target,t)}(p.J.t)),R.X+=1});const a={};j(window,"keydown",t=>{a[t.key]=!0}),j(window,"keyup",t=>{a[t.key]=!1}),o.F([{M:"fps",ot:60}]),s.push(t=>{const n=t.B("vp"),o=t.B("fps").ot.toFixed(2),e=n.height/44,{W:s}=n.O;s.save(),s.fillStyle="rgba(255,255,0,1)",s.font=e+"px/1.5 monospace";const c=s.measureText(o),i=c.width+1,r="et"in c?c.et+c.st:1.5*e-e;S(n),s.fillText(o,B(n.S)-i,0+r),s.restore()});const{stop:u}=(({rt:t,at:n,ut:o,update:e,ht:s=10,pt:c=(()=>{}),lt:i=(()=>{})})=>{const r=window.performance,a=t,u=n,h=r.now.bind(r),p=window.requestAnimationFrame.bind(window);let l=0,w=null,f=h(),d=h(),x=0,v=60;return function t(){const n=h();w=p(t),l+=n-f,f=n;let r=l-a>=0,M=Math.floor(l/u);if(M>=s)return l=0,f=h(),void c();for(;M-- >0;)l-=u,e(u);r&&o(l/a),x+=1,d+1e3<=n&&(v=.25*x+.75*v,x=0,d=n,i(v))}(),{stop:()=>{w&&cancelAnimationFrame(w)}}})({rt:1e3/60,at:1e3/30,update:t=>{((t=1)=>{y.slice().forEach((n,o)=>{n.it+=t,n.it>=n.ct&&(y.splice(o,1),n.action(n.ct,n.it))})})(t),c.forEach(n=>n(o,t)),o.j()},ut:t=>{s.forEach(n=>n(o,t))},pt:Y,lt:q})}()}();