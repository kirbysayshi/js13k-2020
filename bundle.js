!function(){"use strict";function t(t,n){return{x:t||0,y:n||0}}const n=(t,n)=>(t.x=n.x,t.y=n.y,t),e=(t,n,e)=>(t.x=n,t.y=e,t),o=(t,n,e)=>(t.x=n.x+e.x,t.y=n.y+e.y,t),r=(t,n,e)=>(t.x=n.x-e.x,t.y=n.y-e.y,t),c=(t,n)=>t.x*n.x+t.y*n.y,s=(t,n,e)=>(t.x=n.x*e,t.y=n.y*e,t),i=(t,n)=>{const e=t.x-n.x,o=t.y-n.y;return Math.sqrt(e*e+o*o)},a=t=>{const n=t.x,e=t.y;return Math.sqrt(n*n+e*e)},l=(t,n)=>{const e=n.x,o=n.y;let r=e*e+o*o;return r>0&&(r=1/Math.sqrt(r),t.x=n.x*r,t.y=n.y*r),t},u=(t,n)=>{t.t.x+=t.o.x*n*n*.001,t.t.y+=t.o.y*n*n*.001,e(t.o,0,0)},f=t(),h=t(),d=t(),p=t(),w=t(),v=t(),g=t(),M=t(),y=t(),m=t(),x=t(),b=t(),k=t(),S=t(),T=(i,u,T,A,O,L,C,D,I,R,N,P,H,E,F)=>{e(f,0,0),e(h,0,0),e(d,0,0),e(p,0,0),e(w,0,0),e(v,0,0),e(g,0,0),e(M,0,0),e(y,0,0),e(m,0,0),e(x,0,0),e(b,0,0),e(k,0,0),e(S,0,0),!H||0===H.x&&0===H.y?(r(f,i,C),l(f,f)):e(f,H.x,H.y),s(h,f,-1);const j=T+I,K=1+(A>R?A:R);r(d,i,u);const $=c(f,d);s(p,f,$),r(w,d,p),r(v,C,D);const W=c(h,v);s(g,h,W),r(M,v,g),s(x,p,(T-I)/j),s(b,g,K*I/j),o(y,x,b),o(y,y,w),s(k,p,K*T/j),s(S,g,(I-T)/j),o(m,k,S),o(m,m,M);const B=o(t(),y,m),G=t();s(G,f,c(B,f));const U=r(t(),B,G);l(U,U);let z=-c(B,U);z/=1/(T+I);const Y=Math.abs(z);if(Y>1e-4){const n=a(w),e=a(M),r=t(),c=t();s(r,U,Y<n*O?O:-n*L),s(c,U,Y<e*N?N:-e*P),o(y,y,r),o(m,m,c)}n(E,y),n(F,m)},A=t=>{const n=2*t.t.x-t.i.x,o=2*t.t.y-t.i.y;e(t.i,t.t.x,t.t.y),e(t.t,n,o)},O=(t,n,o,r,c,s,i,a,l)=>{const u=c-t,f=i/2+o/2-Math.abs(u),h=s-n,d=a/2+r/2-Math.abs(h);if(f<=0)return null;if(d<=0)return null;if(e(l.resolve,0,0),e(l.l,0,0),e(l.u,0,0),f<d){const n=u<0?-1:1;l.resolve.x=f*n,l.u.x=n,l.l.x=t+o/2*n,l.l.y=s}else{const t=h<0?-1:1;l.resolve.y=d*t,l.u.y=t,l.l.x=c,l.l.y=n+r/2*t}return l},L=t(),C=t();function D(t,n,e,o,c){r(L,n,t),r(C,o,e);const s=(-L.y*(t.x-e.x)+L.x*(t.y-e.y))/(-C.x*L.y+L.x*C.y),i=(C.x*(t.y-e.y)-C.y*(t.x-e.x))/(-C.x*L.y+L.x*C.y);return s>=0&&s<=1&&i>=0&&i<=1&&(c.x=t.x+i*L.x,c.y=t.y+i*L.y,!0)}const I=t(),R=t(),N=t(),P=t(),H=t(),E=t();const F=t(),j=t();function K(t,n,o,s){if(r(F,o,n),0===F.x&&0===F.y)throw new Error("ZeroLengthEdge");const a=((t.x-n.x)*F.x+(t.y-n.y)*F.y)/(F.x*F.x+F.y*F.y);s.h=a;const u=e(s.p,n.x+a*F.x,n.y+a*F.y);s.v=i(u,t);const f=((t,n,e)=>(t.y=e.x-n.x,t.x=n.y-e.y,l(t,t)))(s.g,n,o);r(j,t,u),s.M=c(f,j)}function $(t){return t&&"object"==typeof t&&"number"==typeof t.id}const W=new class{constructor(t=100){this.m=t,this.k=-1,this.S=new Set,this.T=new Set,this.A=new Map}O(){for(;;){let t=++this.k;if(t<this.m){if(this.S.has(t))continue;return this.S.add(t),{id:t}}{this.k=-1;const t=this.m=10*this.m;for(const[n,e]of this.A){const o=new Array(t);for(let t=0;t<e.length;t++)o[t]=e[t];this.A.set(n,o)}}}}L(t){this.T.add(t.id)}C(t){return this.T.has(t.id)}D(){if(0===this.T.size)return;let t=!1;const n=e=>{e&&"object"==typeof e&&!$(e)&&Object.values(e).forEach(e=>{$(e)?(this.L(e),t=!0):n(e)})};this.T.forEach(t=>{this.T.delete(t),this.S.delete(t);for(const[,e]of this.A){const o=e[t];o&&(n(o),e[t]=void 0)}}),t&&this.D()}I(t){const n=this.O();for(let e=0;e<t.length;e++){const o=t[e];this.add(n,o)}return n}data(t,n){return this.A.get(n)[t.id]}add(t,n){var e;const o=null!==(e=this.A.get(n.R))&&void 0!==e?e:Array(this.m);return o[t.id]=n,this.A.set(n.R,o),t}remove(t,n){const e=this.A.get(n);if(e)return e[t.id]=void 0,t}select(t){const n=new Set;for(let e=0;e<t.length;e++){const o=t[e],r=this.A.get(o);if(!r)return[];if(0===n.size)for(let t=0;t<r.length;t++){void 0!==r[t]&&n.add(t)}else for(const t of n.values())void 0===r[t]&&n.delete(t)}return[...n].map(t=>({id:t}))}N(t){return this.select(t)[0]}P(t){const n=this.A.get(t);for(let t=0;t<n.length;t++){const e=n[t];if(void 0!==e)return e}}};function B(){return W}function G(t,n,e){const o=e.getContext("2d"),r=window.devicePixelRatio||1;return e.style.width=t+"px",e.style.height=n+"px",e.width=Math.floor(t*r),e.height=Math.floor(n*r),o.scale(r,r),o.webkitImageSmoothingEnabled=!1,o.msImageSmoothingEnabled=!1,o.mozImageSmoothingEnabled=!1,o.imageSmoothingEnabled=!1,{width:t,height:n,H:e,F:o,j:r}}const U=document.querySelector.bind(document),z=(document.querySelectorAll.bind(document),U("#r")),Y=U("#c"),q=U("#u");if(!z||!Y||!q)throw new Error("Could not locate DOM!");function Z(t,n,e,o){return t.addEventListener(n,e,o),()=>{t.removeEventListener(n,e,o)}}const J="transparent",Q="rgba(255,255,132,1)",V="rgba(255,255,132,0.5)",X="rgba(40,40,40,1)",_=45,tt="Arial, sans-serif",nt="Courier, Courier New, monospace";function et(n=0,e=0){return t(n,e)}function ot(t){const n=B().P("vp"),e=n.K;return t/n.$*e.width}function rt(t,n){const e=B().P("vp"),{W:o}=e;return ot(t-("x"===n?o.target.x:o.target.y))}const ct=t=>t/B().P("vp").K.width*100;function st(t){const e=B().P("vp");n(e.W.target,t)}function it(){const t=B().P("vp"),{F:n}=t.K;n.save(),function(t){const{F:n}=t.K,{W:e}=t;n.scale(1,-1),n.translate(-ot(e.B.x),-ot(e.B.y))}(t),n.clearRect(0,0,t.K.H.width,t.K.H.height),n.restore()}function at(t=X){const n=B().P("vp"),{F:e}=n.K;e.fillStyle=t;const o=2*n.W.B.x,r=n.G-2*n.W.B.y;e.fillRect(rt(n.W.target.x-n.W.B.x,"x"),rt(n.W.target.y-n.W.B.y,"y"),ot(o),ot(-r))}function lt(t,n,e,r,c,s="transparent",i=tt){const a=B().P("vp"),{W:l}=a,u=et();return u.x=l.target.x-l.B.x,u.y=l.target.y+l.B.y,o(u,u,n),ut(t,u,e,r,c,s,i)}function ut(t,n,e,o,r,c="transparent",s=tt){const i=B().P("vp"),{W:a}=i,{F:l}=i.K;l.save(),l.scale(1,-1);const{U:u,font:f}=ft(t,o,s);let h=0,d=ot(-n.y+a.target.y);return l.font=f,t.split("\n").forEach((t,o)=>{const s=l.measureText(t).width+1,i=ot(u);0===o&&(d+=i);const a="center"===e?rt(n.x,"x")-s/2:"left"===e?rt(n.x,"x"):rt(n.x,"x")-s;"transparent"!==c&&(l.fillStyle=c,l.fillRect(a,d,s,-i)),l.fillStyle=r,l.fillText(t,a,d),d+=i,h+=i}),l.restore(),ct(h)}function ft(t,n,e=tt){const o=B().P("vp"),{F:r}=o.K,c=o.height/n;r.save();const s=`${c}px/1.2 ${e}`;r.font=s;const i=r.measureText(t),a=1.2*(i.actualBoundingBoxAscent?i.actualBoundingBoxAscent+i.actualBoundingBoxDescent:c);r.restore();const l=t.split("\n");return{font:s,fontSize:c+"px",total:ct(a*l.length),Y:1.2,U:ct(a)}}function ht(){const t=window.innerWidth<window.innerHeight?window.innerWidth:.6*window.innerHeight,n=window.innerWidth<window.innerHeight?window.innerWidth/.6:window.innerHeight;return{R:"vp",ratio:.6,width:t,height:n,$:100,G:100/.6,K:G(t,n,Y),W:{B:et(50,50),mode:"center",target:et(0,0)}}}function dt(){const t=ht(),n=B(),e=n.N(["vp"]);e&&n.L(e);z.style.width=t.width+"px";const o=n=>Math.floor(n/t.$*t.K.width);t.K.F.translate(o(t.W.B.x),o(t.W.B.y)),t.K.F.scale(1,-1);const r=[t];n.I(r)}function pt(t,n,e,o){const r=n.x-e.x,c=n.y-e.y,s=Math.sin(o),i=Math.cos(o);return t.x=r*i-c*s+e.x,t.y=r*s+c*i+e.y,t}function wt(){return{v:0,M:0,h:0,p:t(),g:t()}}window.addEventListener("resize",dt);const vt=t(),gt=t(),Mt=t();function yt(t,n,e){return r(vt,n.t,n.i),l(gt,vt),s(Mt,gt,e),o(t,Mt,n.t),t}function mt(t){return Math.atan2(t.y,t.x)}const xt=new URLSearchParams(window.location.search);function bt(t,n){const{width:e,height:r}=function(t){return{width:t.$,height:Math.min(.75*t.$,.75*t.G)}}(n),c=t.width/2,i=t.height/2,a=n.W.target,l=et(Math.cos(t.q),Math.sin(t.q)),u=s(et(),l,Math.min(e/2,r/2)),f=o(et(),a,u),h=et(f.x,f.y-c),d=et(f.x,f.y+c);return pt(h,h,f,t.q),pt(d,d,f,t.q),{x:f.x,y:f.y,angle:t.q,Z:c,J:i,V:h,p1:d}}function kt(t){return{R:"mv",t:n(et(),t),i:n(et(),t),o:et()}}const St=33.3333333;const Tt=xt.get("seed"),At=Tt?Number(Tt):Date.now(),Ot=(Ct=61^(Ct=At)^Ct>>>16,Ct+=Ct<<3,Ct=Math.imul(Ct,668265261),Lt=(Ct^=Ct>>>15)>>>0,t=>(Lt=Lt+1831565813|0,(((t=(t=Math.imul(Lt^Lt>>>15,1|Lt))+Math.imul(t^t>>>7,61|t)^t)^t>>>14)>>>0)/2**32));var Lt,Ct;const Dt=()=>Ot();function It(t,n,e){Rt(t,10,1e3,n>0?e:pt(et(),e,t,Math.PI))}function Rt(t,n,o,r,c=.6,s=1,i=Math.PI){const a=B();for(let l=0;l<n;l++){const n=kt(t),l=s*Dt(),u=s*Dt();if(r){const t=mt(r),o=t+i/2,c=t-i/2,s=c+Dt()*(o-c);e(n.o,Math.cos(s)*l,Math.sin(s)*u)}else e(n.o,l,u);const f=Dt()*o,h=a.I([n]);a.I([{R:"particle",move:h,X:f,_:f,size:c}])}}const Nt=(t,n)=>{const e=t.select(["particle"]);for(let o=0;o<e.length;o++){const r=e[o],c=t.data(r,"particle");c.X-=n,c.X<=0&&t.L(r)}};function Pt(t,e,c,i){u(t,i);const{V:a,p1:l,J:f}=bt(e,c),h={tt:a,nt:l},d=t,p=f,w=wt();K(d.t,h.tt,h.nt,w);const v=n(et(),w.p),g=r(et(),e.et.t,e.et.i),M=r(et(),v,g),y=2+p;if(w.h>=0&&w.h<=1&&w.v<=y){const t=1,n=1e7,e=.5,c=.87,i=.87,a=et(),l=et();T(d.t,d.i,t,e,c,i,v,M,n,e,c,i,w.g,a,l),r(d.i,d.t,a);const u=Math.abs(y-w.v);((t,...n)=>{for(let e=0;e<n.length;e++){const r=n[e];o(r,r,t)}})(s(et(),w.g,w.M>0?u:-u),d.t,d.i),It(d.i,w.M,w.g)}A(t)}function Ht(){const t=B().P("vp"),{W:n,K:{F:e}}=t;e.fillStyle=X,e.fillRect(rt(n.target.x-n.B.x,"x"),rt(n.target.y+n.B.y,"y"),ot(2*n.B.x),ot(2*-n.B.y))}let Et;function Ft(){const t=B().P("vp"),{W:n}=t,e=2*n.B.x,o=2*n.B.y;if(!Et){const n=document.createElement("canvas"),r=n.getContext("2d");Et=G(ot(2*t.W.B.x),ot(2*t.W.B.y),n);const c=.1,s=.3,i=2*t.W.B.y*8;r.fillStyle=V;let a=0;for(;a<i;){const t=Dt()*e,n=Dt()*o,i=Dt()*(s-c)+c;r.beginPath(),r.arc(ot(t),ot(n),ot(i),0,2*Math.PI,!1),r.fill(),a++}}const r=n.target.x/e,c=n.target.y/o,s=Math.floor(r),i=Math.floor(c);let a=n.target.x%e/e,l=n.target.y%o/o;a=n.target.x<0?1-Math.abs(a):a,l=n.target.y<0?1-Math.abs(l):l;const u=t.K.F;Ht(),u.drawImage(Et.H,0,0,ot(e),ot(o),rt(s*e,"x"),rt(i*o,"y"),ot(e),ot(o)),a<.5&&u.drawImage(Et.H,0,0,ot(e),ot(o),rt((s-1)*e,"x"),rt(i*o,"y"),ot(e),ot(o)),a>=.5&&u.drawImage(Et.H,0,0,ot(e),ot(o),rt((s+1)*e,"x"),rt(i*o,"y"),ot(e),ot(o)),l<.5&&u.drawImage(Et.H,0,0,ot(e),ot(o),rt(s*e,"x"),rt((i-1)*o,"y"),ot(e),ot(o)),l>=.5&&u.drawImage(Et.H,0,0,ot(e),ot(o),rt(s*e,"x"),rt((i+1)*o,"y"),ot(e),ot(o)),a<.5&&l<.5&&u.drawImage(Et.H,0,0,ot(e),ot(o),rt((s-1)*e,"x"),rt((i-1)*o,"y"),ot(e),ot(o)),a>=.5&&l<.5&&u.drawImage(Et.H,0,0,ot(e),ot(o),rt((s+1)*e,"x"),rt((i-1)*o,"y"),ot(e),ot(o)),a<.5&&l>=.5&&u.drawImage(Et.H,0,0,ot(e),ot(o),rt((s-1)*e,"x"),rt((i+1)*o,"y"),ot(e),ot(o)),a>=.5&&l>=.5&&u.drawImage(Et.H,0,0,ot(e),ot(o),rt((s+1)*e,"x"),rt((i+1)*o,"y"),ot(e),ot(o))}function jt(t=0,e=et(0,0)){const o=B().P("vp");return{q:t,width:o.$/2,height:o.$/16,et:{o:et(),t:n(et(),e),i:n(et(),e)}}}function Kt(t=et(),e=0,o=et()){const c=B().P("vp"),i={t:n(et(),t),i:n(et(),t),o:et(),width:c.$/32,height:c.$/32},a=s(et(),o,e);return r(i.i,i.t,a),i}function $t(t){return{et:{t:n(et(),t),i:n(et(),t),o:et()},ot:et(10,10)}}function Wt(t,n){return{tt:t,nt:n,rt:!1,ct:!1}}function Bt(t,n,e=!1){return{tt:t,nt:n,rt:!0,ct:e}}function Gt(t,n=!0,e=!0){const o=[];for(let n=0;n<t.length;n++){const r=n>0?t[n-1]:null,c=t[n];r&&o.push(e?Wt(c,r):Wt(r,c))}return n&&o.push(e?Wt(t[0],t[t.length-1]):Wt(t[t.length-1],t[0])),o}function Ut(t,e,o=!1,r=!0){return{et:{t:n(et(),t),i:n(et(),t),o:et()},ot:et(10,10),st:n(et(),e),it:o,at:r}}const zt={lt:0,ut:null,state:"b",level:-1,ft:null,ht:[],dt:null,wt:!1,vt:[function(){return{gt:Kt(et(20,0),.5,et(-1,0)),Mt:jt(Math.PI),target:$t(et(40,0)),yt:Gt([et(-60,60),et(60,60),et(60,-60),et(-60,-60)]),xt:[],bt:"Signal, meet target"}},function(){return{gt:Kt(et(20,0),.5,et(-1,0)),Mt:jt(Math.PI),target:$t(et(40,-40)),yt:Gt([et(-60,60),et(60,60),et(60,-60),et(-60,-60)]),xt:[],bt:"Sometimes you need to rotate"}},function(){return{gt:Kt(et(20,0),.2,et(-1,0)),Mt:jt(Math.PI),target:$t(et(80,-40)),yt:Gt([et(-60,60),et(100,60),et(100,-60),et(-60,-60)]),xt:[],bt:"Offscreen targets are tracked"}},function(){return{gt:Kt(et(20,0),.2,et(-1,0)),Mt:jt(Math.PI),target:$t(et(80,-180)),yt:Gt([et(-60,60),et(100,60),et(100,-200),et(60,-200),et(60,-60),et(-60,-60)]),xt:[],bt:"Down the well..."}},function(){return{gt:Kt(et(0,-10),.5,et(0,1)),Mt:jt(Math.PI),target:$t(et(30,10)),yt:[Wt(et(20,15),et(-20,15)),Bt(et(-20,5),et(20,5)),...Gt([et(-60,60),et(60,60),et(60,-60),et(-60,-60)])],xt:[],bt:"One way is the only way"}},function(){const t=jt();return{gt:Kt(et(-30,-40),.5,et(0,1)),Mt:t,target:$t(et(30,-40)),yt:Gt([et(-60,60),et(60,60),et(60,-60),et(-60,-60)]),xt:[Ut(et(-20,10),et(1,-1))],bt:"Arrows, they shoot"}},function(){const t=jt(Math.PI);return{gt:Kt(et(-30,-40),.5,et(0,1)),Mt:t,target:$t(et(510,0)),yt:Gt([et(-60,60),et(60,60),et(60,5),et(500,10),et(500,20),et(520,20),et(520,-20),et(500,-20),et(500,-10),et(60,-5),et(60,-60),et(-60,-60)]),xt:[Ut(et(50,0),et(1,0),!0)],bt:"Some arrows take you with"}},function(){const t=jt();return{gt:Kt(et(-21,20),.5,et(1,0)),Mt:t,target:$t(et(0,0)),yt:Gt([et(-60,60),et(60,60),et(60,-60),et(-60,-60)]),xt:[Ut(et(-20,20),et(1,0)),Ut(et(20,20),et(0,-1)),Ut(et(20,-20),et(-1,0)),Ut(et(-20,-20),et(0,1))],bt:"Tetherball"}},function(){const t=jt(Math.PI,et(30,0));return{gt:Kt(et(30,0),.5,et(0,1)),Mt:t,target:$t(et(135,0)),yt:Gt([et(-25,25),et(25,25),et(25,20),et(55,30),et(60,10),et(65,30),et(70,9),et(75,30),et(80,8),et(85,30),et(90,7),et(95,30),et(100,6),et(105,30),et(110,5),et(115,30),et(120,4),et(125,30),et(145,25),et(145,-25),et(125,-25),et(120,-4),et(115,-30),et(110,-5),et(105,-30),et(100,-6),et(95,-30),et(90,-7),et(85,-30),et(80,-8),et(75,-30),et(70,-9),et(65,-30),et(60,-10),et(55,-30),et(50,-20),et(25,-25),et(-25,-25)]),xt:[],bt:"No death spikes here"}},function(){const t=jt(Math.PI,et(0,0)),n=Kt(et(-30,0),5,et(1,0)),e=$t(et(5e3,-10));return{gt:n,Mt:t,target:e,yt:Gt([et(-60,60),et(5010,60),et(5010,-110),et(-60,-110)]),xt:[...Array.from(new Array(250)).map((t,n)=>Ut(et(20*n,-10),et(1,0),!0,!1))],bt:"Chase! Shift or btn to boost!"}}]};function Yt(t){const n=zt;n.ut=n.state,n.state=t,n.lt=0}function qt(t){return t*St/1e3}function Zt(t){return t.toFixed(3)}function Jt(t){const n=zt;n.dt=t,n.wt=!1}function Qt(){zt.wt=!0}function Vt(){const t=zt;t.dt=null,t.wt=!1}function Xt(t,n,e,o){if(!e.rt)return;const r=et(),c=D(yt(et(),t,n),t.i,e.tt,e.nt,r),s=wt();K(t.i,e.tt,e.nt,s),c&&s.M<0&&(e.rt=!1,o.dt&&e.ct&&Qt())}function _t(t,n,e){if(e.rt)return;const c=et(),i=D(yt(et(),t,n),t.i,e.tt,e.nt,c),a=wt();if(K(t.i,e.tt,e.nt,a),i&&a.M>0){u=t,f=n,h={t:e.tt,i:e.tt,o:et()},d={t:e.nt,i:e.nt,o:et()},r(N,u.t,u.i),l(P,N),s(H,P,f),o(E,H,u.t),D(E,u.i,h.t,d.t,I)&&(r(R,E,I),r(u.t,u.t,R),r(u.i,u.i,R));const i=1,p=1e7,w=1,v=0,g=0,M=et(),y=et();T(t.t,t.i,i,w,v,g,c,c,p,w,v,g,a.g,M,y),r(t.i,t.t,M),It(t.i,a.M,a.g)}var u,f,h,d}const tn={KeyW:!1,KeyA:!1,KeyS:!1,KeyD:!1,ArrowLeft:!1,ArrowRight:!1,ShiftLeft:!1,ShiftRight:!1,Enter:!1};function nn(){return tn}function en(t,n,e,o){const r=B().P("vp"),c=r.W.target,{B:s}=r.W,a=[[et(c.x-s.x,c.y+s.y),et(c.x+s.x,c.y+s.y),wt()],[et(c.x+s.x,c.y+s.y),et(c.x+s.x,c.y-s.y),wt()],[et(c.x+s.x,c.y-s.y),et(c.x-s.x,c.y-s.y),wt()],[et(c.x-s.x,c.y-s.y),et(c.x-s.x,c.y+s.y),wt()]];for(let n=0;n<a.length;n++){const[e,o,r]=a[n];K(t,e,o,r)}const[[l,u,f],[h,d,p],[w,v,g],[M,y,m]]=a;let x,b,k;const S=ft(o,_);if(f.M>0&&p.M>0)x=et(p.p.x,f.p.y),b=i(x,t),k="right";else if(p.M>0&&g.M>0)x=et(p.p.x,g.p.y+S.U),b=i(x,t),k="right";else if(g.M>0&&m.M>0)x=et(m.p.x,g.p.y+S.U),b=i(x,t),k="left";else if(m.M>0&&f.M>0)x=et(m.p.x,f.p.y),b=i(x,t),k="left";else if(f.M>0)x=et(Math.min(Math.max(f.p.x,l.x),u.x),f.p.y),b=f.v,k="center";else if(p.M>0)x=et(p.p.x,Math.max(Math.min(h.y,p.p.y),d.y)),b=p.v,k="right";else if(g.M>0)x=et(Math.max(Math.min(w.x,g.p.x),v.x),g.p.y+S.U),b=g.v,k="center";else{if(!(m.M>0))return;x=et(m.p.x,Math.min(Math.max(M.y,m.p.y),y.y)),b=m.v,k="left"}if(b<.7*((n.x/2+n.y/2)/2))return;const T=r.K.F;T.save(),ut(o,x,k,_,X,Q),T.restore()}Z(window,"keydown",t=>{tn[t.code]=!0}),Z(window,"keyup",t=>{tn[t.code]=!1});let on=0,rn=[];const cn=()=>{on=0,rn.length=0},sn=B(),an=sn.I([{R:"fps",kt:60}]),ln=t=>{if(!xt.has("debug"))return;lt(t.P("fps").kt.toFixed(2),et(100,0),"right",_,Q)};function un(t){sn.data(an,"fps").kt=t}function fn(n){const e=B().P("vp"),o=e.K.F,{x:r,y:c}=n.et.t,s=n.ot.x/2,i=n.ot.x/4,a=e.$/64,l=n.ot.y/a,u=s*Math.SQRT2,f=a*Math.SQRT2/2;if(!O(e.W.target.x,e.W.target.y,3*e.W.B.x,3*e.W.B.y,r,2*n.ot.x,c,2*n.ot.y,{resolve:t(),l:t(),u:t()}))return;o.save(),o.fillStyle=Q,o.strokeStyle=Q;const h=mt(n.st);o.translate(rt(r,"x"),rt(c,"y")),o.rotate(h-Math.PI/2),hn(o,l,a,u,0,0-i+f,Math.PI/4),hn(o,l,a,u,0,0+i-f,-Math.PI/4),o.restore()}function hn(t,n,e,o,r,c,s){for(let i=0;i<n;i+=2){t.save(),t.translate(ot(c),ot(r+i*e)),t.rotate(s);(i<Math.floor(n/4)?t.strokeRect:t.fillRect).call(t,ot(0-o/2),ot(0),ot(o),ot(e)),t.restore()}}function dn(t,o,c){const s=c.et.t,i=(c.ot.y,c.ot.x/2),a=et(s.x,s.y+i),l=et(s.x,s.y-i),u=mt(c.st),f=et(s.x-i,s.y-i),h=et(s.x+i,s.y-i),d=et(s.x+i,s.y+i),p=et(s.x-i,s.y+i);pt(a,a,s,u),pt(l,l,s,u),pt(f,f,s,u),pt(h,h,s,u),pt(d,d,s,u),pt(p,p,s,u);const w=[[a,l],[f,h],[d,p]];let v=!1;for(let t=0;t<w.length;t++){const n=w[t],e=et(),r=D(o.i,o.t,n[0],n[1],e),c=wt();if(K(o.i,n[0],n[1],c),r&&c.M<0){v=!0;break}}if(v){if(n(o.t,c.et.t),n(o.i,o.t),c.at)e(o.o,5*c.st.x,5*c.st.y);else{const t=et(8*c.st.x,8*c.st.y);r(o.i,o.t,t)}c.it&&Jt(o)}}const pn="--ctrlDisplay";function wn(t,n){U(":root").style.setProperty(t,n)}const vn={St:()=>{},Tt:()=>{}},gn={At:!1,move:t(),rotate:et()};function Mn(){const t=U("#btn-boost"),n=U("#btn-reset"),e=U("#stick-move"),o=U("#stick-move .ui-nub"),r=U("#stick-rotate"),c=U("#stick-rotate .ui-nub"),s=mn(e,o,gn.move),i=mn(r,c,gn.rotate),a=function(t,n){const e=Z(t,"mouseup",t=>{t.preventDefault(),n()}),o=Z(t,"touchstart",t=>{t.preventDefault()}),r=Z(t,"touchend",t=>{n()});return()=>{e(),o(),r()}}(n,()=>{vn.St()}),l=Z(t,"mousedown",()=>{gn.At=!0}),u=Z(t,"mouseup",()=>{gn.At=!1}),f=Z(t,"touchstart",()=>{gn.At=!0}),h=Z(t,"touchend",()=>{gn.At=!1});vn.Tt=()=>{l(),u(),f(),h(),a(),s(),i()}}function yn(){wn(pn,"none")}function mn(n,e,o){const r=t(),c=t(),s=Z(n,"touchstart",t=>{t.preventDefault();const e=t.targetTouches[0];r.x=e.screenX,r.y=e.screenY;const o=n.getBoundingClientRect();c.x=o.width,c.y=o.height}),i=Z(n,"touchmove",t=>{t.preventDefault();const n=t.targetTouches[0],s=n.screenX-r.x,i=-1*(n.screenY-r.y);o.x=s/(c.x/2),o.y=i/(c.y/2),l(o,e)}),a=Z(n,"touchend",t=>{t.preventDefault(),r.x=r.y=0,c.x=c.y=0,o.x=o.y=0,l(o,e)});function l(t,n){const e=(t.x+1)/2*100,o=-(t.y-1)/2*100,r=Math.max(Math.min(e,100),0),c=Math.max(Math.min(o,100),0);n.style.setProperty("--leftPct",r+"%"),n.style.setProperty("--topPct",c+"%")}return()=>{s(),i(),a(),r.x=r.y=0,c.x=c.y=0,o.x=o.y=0,l(o,e)}}function xn(){}!async function(){await async function(){}();const t=B();dt(),function(){const t=ot(B().P("vp").W.B.y),n=2*t,{fontSize:e}=ft("M",_,tt);wn("--yellowRGBA",Q),wn("--blackRGBA",X),wn("--bodyFontSize",e),wn("--ctrlPanelHeight",t+"px"),wn("--ctrlPanelTop",n+"px")}();const c=[],i=[];c.push(t=>{it()});const f=t.P("vp");c.push((function(t,n){switch(zt.state){case"b":{Ft();let t=10;t-=ut("SIGNAL DECAY",et(0,t),"center",20,Q,J,nt),t-=5,ut("a js13k 2020 entry",et(0,t),"center",_,Q),t-=20,ut("TAP OR CLICK TO START",et(0,t),"center",_,Q,J,nt),at();break}case"t":{Ht();let t=50;const n=-45,e=matchMedia("(hover: none)").matches;t-=5,t-=ut(["Be the best signalmancer in the galaxy!","","Help messages from deep space colonies bounce","their way home as quickly as possible.","","Only you can prevent 404s."].join("\n"),et(n,t),"left",_,Q),e||(t-=5,t-=ut("CONTROLS (KEYBOARD)",et(n,t),"left",_,Q,J,nt),t-=5,t-=ut(["WASD: move","Hold any SHIFT to boost","","Arrow Left / Arrow Right: rotate the Deflector"].join("\n"),et(n,t),"left",_,Q)),e&&(t-=5,t-=ut("CONTROLS (TOUCH)",et(n,t),"left",_,Q,J,nt),t-=5,t-=ut(["Left Stick:  move","Move stick and hold BOOST to boost","","Right Stick: rotate the Deflector"].join("\n"),et(n,t),"left",_,Q)),t-=5,t-=ut("TAP OR CLICK TO CONTINUE",et(0,t),"center",_,Q,J,nt),at();break}case"level":{if(!zt.ft)break;const{target:n,Mt:e,gt:o,yt:c,xt:i}=zt.ft;Ft(),function(t,n){const e=B().P("vp").K.F,{x:o,y:r}=t.et.t,c=t.ot.x/2,s=t.ot.y/2;e.save(),e.fillStyle=Q,e.translate(rt(o,"x"),rt(r,"y")),e.fillRect(0-ot(c),0-ot(s),ot(t.ot.x),ot(t.ot.y)),e.restore()}(n),function(t){const n=B().P("vp"),e=n.K.F,{x:o,y:r,angle:c,J:s,Z:i,V:a,p1:l}=bt(t,n);e.save(),e.fillStyle=Q,e.translate(rt(o,"x"),rt(r,"y")),e.rotate(Math.PI/2+c),e.fillRect(0-ot(i),0-ot(s),ot(t.width),ot(t.height)),e.restore()}(e),function(t,n){const e=B().P("vp"),o=e.K.F,{t:c,i:i,width:u,height:f}=t,h=u/2,d=f/2,p=rt(i.x+1*(c.x-i.x),"x"),w=rt(i.y+1*(c.y-i.y),"y"),v=ot(u),g=ot(f);o.save();{const t=r(et(),c,i),n=l(t,t),a=s(n,n,10*e.$);o.lineWidth=ot(1),o.strokeStyle=V,o.setLineDash([ot(1),ot(3)]),o.beginPath(),o.moveTo(p,w),o.lineTo(p+ot(a.x),w+ot(a.y)),o.stroke(),o.setLineDash([])}{const t=h/8,n=r(et(),c,i),e=a(n)/t,u=l(n,n);o.fillStyle="rgba(255,255,132,0.1)";const f=et();for(let n=0;n<e;n++)s(f,u,n*t),o.fillRect(p-ot(f.x)-ot(h),w-ot(f.y)-ot(d),v,g)}o.fillStyle=Q,o.fillRect(p-ot(h),w-ot(d),v,g),o.restore()}(o),function(t){for(let n=0;n<t.length;n++)fn(t[n])}(i),function(t){const{K:{F:n}}=B().P("vp");n.save(),n.strokeStyle=Q,n.lineWidth=ot(1);for(let e=0;e<t.length;e++){const o=t[e];o.rt?n.setLineDash([ot(1),ot(2)]):n.setLineDash([]),n.beginPath(),n.moveTo(rt(o.tt.x,"x"),rt(o.tt.y,"y")),n.lineTo(rt(o.nt.x,"x"),rt(o.nt.y,"y")),n.closePath(),n.stroke()}n.restore()}(c),((t,n)=>{const e=t.select(["particle"]),o=t.P("vp"),{F:r}=o.K;r.save();for(let n=0;n<e.length;n++){const o=e[n],c=t.data(o,"particle"),s=t.data(c.move,"mv"),i=c.X/c._;r.fillStyle=Q.replace(",1)",`,${i.toFixed(5)})`),r.fillRect(rt(s.t.x,"x"),rt(s.t.y,"y"),ot(c.size),ot(c.size))}r.restore()})(t),at(),function(t,n){const e=B().P("vp");if(!t.ft)return;lt(Zt(qt(t.lt)),et(e.$/2,-1),"center",_,Q),lt(`MISSION ${t.level+1}: ${t.ft.bt.toUpperCase()}`,et(e.W.B.x,2*-e.W.B.y),"center",_,Q,J,nt),en(t.ft.target.et.t,t.ft.target.ot,0,"TARGET"),en(t.ft.gt.t,et(t.ft.gt.width,t.ft.gt.height),0,"SIGNAL")}(zt);break}case"win":{Ht();const t=Zt(qt(zt.ht[zt.level]));let n=10;n-=ut("MISSION SUCCESS",et(0,n),"center",20,Q,J,nt),n-=5,n-=ut(t+"s",et(0,n),"center",_,Q,J,tt),n-=10,n-=ut("Finding the next signal in\nneed of assistance...",et(0,n),"center",_,Q,J,tt),at();break}case"n":break;case"x":{Ht();let t=45;t-=ut("ALL SIGNALS MADE IT,\nTHANKS TO YOU!",et(0,t),"center",_,Q,J,nt);let n=0;t-=5;for(let e=0;e<zt.ht.length;e++){const o=zt.ht[e];n+=o,ut(`MISSION ${e+1}:`,et(-45,t),"left",_,Q,J,nt),t-=ut(Zt(qt(o))+"s:",et(45,t),"right",_,Q,J,nt)}const e=Zt(qt(n));t-=5,t-=ut(`TOTAL: ${e}s`,et(45,t),"right",_,Q,J,nt),at(),0===zt.lt&&(wn("--thanksDisplay","block"),function(t){const n=`I prevented Signal Decay in ${t}s!`,e=new URLSearchParams;e.append("text",n),e.append("url","https://kirbysayshi.com/js13k-2020"),e.append("hashtags",["js13k"].join(",")),U("#btn-tweet").setAttribute("href","https://twitter.com/intent/tweet?"+e.toString())}(e));break}}})),i.push((t,c)=>{switch(zt.state){case"b":if(0===zt.lt){yn();const n=Z(t.P("vp").K.H,"click",()=>{n(),cn(),Yt("t")})}break;case"t":if(0===zt.lt){yn();const n=Z(t.P("vp").K.H,"click",()=>{n(),cn(),Yt("n")})}break;case"level":{const s=gn,i=nn();if(0===zt.lt){const t=zt.vt[zt.level];if(!t)return Yt("x");zt.ft=t(),wn(pn,"flex"),Mn(),a=()=>{zt.ft=t(),Vt()},vn.St=a}if(i.Enter){const t=zt.vt[zt.level];zt.ft=t(),Vt()}if(!zt.ft)break;const{target:h,Mt:d,gt:p,xt:w,yt:v}=zt.ft;i.ArrowLeft&&(d.q+=.1),i.ArrowRight&&function(t){t.q-=.1}(d);const g=0!==s.rotate.x&&0!==s.rotate.y,M=mt(s.rotate);g&&function(t,n){t.q=n}(d,M);const y=et();let m=0;i.KeyW&&i.KeyD?m=Math.PI/4:i.KeyW&&i.KeyA?m=Math.PI*(3/4):i.KeyS&&i.KeyD?m=-Math.PI/4:i.KeyS&&i.KeyA?m=-Math.PI*(3/4):i.KeyW?m=Math.PI/2:i.KeyA?m=Math.PI:i.KeyS?m=-Math.PI/2:i.KeyD&&(m=0);const x=0!==s.move.x&&0!==s.move.y,b=mt(s.move),k=i.ShiftLeft||i.ShiftRight||s.At?et(1,0):et(.2,0);x&&(m=b);const S=pt(et(),k,y,m);x&&e(S,S.x*Math.abs(s.move.x),S.y*Math.abs(s.move.y));if((0!==m||0===m&&i.KeyD||x)&&!zt.dt&&function(t,n){o(t.et.o,t.et.o,n)}(d,S),((t,n)=>{const e=(t.i.x-t.t.x)*n,o=(t.i.y-t.t.y)*n;t.i.x=t.t.x+e,t.i.y=t.t.y+o})(d.et,.8),u(d.et,c),Pt(p,d,f,c),function(t,n,e){for(let t=0;t<e.length;t++)dn(0,n,e[t])}(0,p,w),function(t,n,e){for(let o=0;o<t.length;o++){const r=t[o];Xt(n,n.width/2,r,e),_t(n,n.width/2,r)}}(v,p,zt),((t,n)=>{const e=t.select(["mv"]);for(let o=0;o<e.length;o++){const r=e[o],c=t.data(r,"mv");u(c,n),A(c)}})(t,c),A(d.et),zt.dt&&(n(d.et.t,zt.dt.t),n(d.et.i,zt.dt.t),zt.lt%3==0)){const t=r(et(),zt.dt.t,zt.dt.i),n=l(et(),t);Rt(zt.dt.i,25,1e3,n,.6,3,Math.PI/8)}if(st(d.et.t),zt.wt&&Vt(),function(t,n){return!!O(t.et.t.x,t.et.t.y,t.ot.x,t.ot.y,n.t.x,n.t.y,n.width,n.height,{resolve:et(),l:et(),u:et()})}(h,p)){const t=zt;return t.ht[t.level]=t.lt,t.ft=null,Vt(),vn.Tt(),st(et(0,0)),Yt("win")}break}case"win":{st(et(0,0));const t=3e3;0===zt.lt&&(yn(),s=()=>Yt("n"),i=t,rn.push({id:++on,action:s,delay:i,X:0}));break}case"n":return zt.level+=1,Yt("level");case"x":yn(),st(et(0,0))}var s,i,a;zt.lt+=1}),i.push(Nt),c.push(ln);const{stop:h}=(({Ot:t,Lt:n,Ct:e,update:o,Dt:r=10,It:c=(()=>{}),Rt:s=(()=>{})})=>{const i=window.performance,a=t,l=n,u=i.now.bind(i),f=window.requestAnimationFrame.bind(window);let h=0,d=null,p=u(),w=u(),v=0,g=60;return function t(){const n=u();d=f(t),h+=n-p,p=n;let i=h-a>=0,M=Math.floor(h/l);if(M>=r)return h=0,p=u(),void c();for(;M-- >0;)h-=l,o(l);i&&e(h/a),v+=1,w+1e3<=n&&(g=.25*v+.75*g,v=0,w=n,s(g))}(),{stop:()=>{d&&cancelAnimationFrame(d)}}})({Ot:16.6666666,Lt:St,update:n=>{((t=1)=>{rn.slice().forEach((n,e)=>{n.X+=t,n.X>=n.delay&&(rn.splice(e,1),n.action(n.delay,n.X))})})(n),i.forEach(e=>e(t,n)),t.D()},Ct:n=>{c.forEach(e=>e(t,n))},It:xn,Rt:un})}()}();