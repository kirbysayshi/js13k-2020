!function(){"use strict";function t(t,n){return{x:t||0,y:n||0}}const n=(t,n)=>(t.x=n.x,t.y=n.y,t),o=(t,n,o)=>(t.x=n,t.y=o,t),e=(t,n,o)=>(t.x=n.x+o.x,t.y=n.y+o.y,t),s=(t,n,o)=>(t.x=n.x-o.x,t.y=n.y-o.y,t),c=(t,n)=>t.x*n.x+t.y*n.y,i=(t,n,o)=>(t.x=n.x*o,t.y=n.y*o,t),r=(t,...n)=>{for(let o=0;o<n.length;o++){const s=n[o];e(s,s,t)}},a=(t,n)=>{t.t.x+=t.o.x*n*n*.001,t.t.y+=t.o.y*n*n*.001,o(t.o,0,0)},h={x:0,y:0},l={x:0,y:0},u={x:0,y:0},p={x:0,y:0},w=(t,n,c,i,r,a,w,f)=>{const d=((t,n)=>{const o=t.x-n.x,e=t.y-n.y;return o*o+e*e})(t.t,i.t),v=n+r;s(h,t.t,t.i),s(l,i.t,i.i),s(u,t.t,i.t);const y=Math.sqrt(d);let b=(y-v)/y;0===y&&(b=1);const M=c>0?c:1,x=a>0?a:1,g=M+x;if(p.x=u.x*b*(x/g),p.y=u.y*b*(x/g),c>0&&s(t.t,t.t,p),p.x=u.x*b*(M/g),p.y=u.y*b*(M/g),a>0&&e(i.t,i.t,p),!w)return;const m=(f=f||1)*(u.x*h.x+u.y*h.y)/(d||1),k=f*(u.x*l.x+u.y*l.y)/(d||1);h.x+=(k*u.x-m*u.x)/(M||1),l.x+=(m*u.x-k*u.x)/(x||1),h.y+=(k*u.y-m*u.y)/(M||1),l.y+=(m*u.y-k*u.y)/(x||1),c>0&&o(t.i,t.t.x-h.x,t.t.y-h.y),a>0&&o(i.i,i.t.x-l.x,i.t.y-l.y)},f=t(),d=t(),v=t(),y=t();function b(o,r,a,h,l,u,p,b,M){s(d,u.t,h.t),((t,n)=>{const o=n.x,e=n.y;let s=o*o+e*e;s>0&&(s=1/Math.sqrt(s),t.x=n.x*s,t.y=n.y*s)})(f,d),s(v,o.t,h.t);const x=c(d,v),g=c(d,d),m=Math.sqrt(g);if(x<0||x>g)return;const k=x/g,D=1-k;i(y,f,k*m),e(y,y,h.t);if(((t,n)=>{const o=t.x-n.x,e=t.y-n.y;return Math.sqrt(o*o+e*e)})(y,o.t)>r)return;const E=D*a,F=k*a,P={t:t(),i:t()},j={t:t(),i:t()};i(P.t,f,k*m),s(P.t,o.t,P.t),i(P.i,f,k*m),s(P.i,o.i,P.i),i(j.t,f,D*m),e(j.t,o.t,j.t),i(j.i,f,D*m),e(j.i,o.i,j.i);const A={t:t(),i:t()},O={t:t(),i:t()};n(A.t,P.t),n(A.i,P.i),n(O.t,j.t),n(O.i,j.i);w(P,r,E,h,0,l,b,M),w(j,r,F,u,0,p,b,M);const S={t:t(),i:t()},T={t:t(),i:t()};s(S.t,P.t,A.t),s(T.t,j.t,O.t),i(S.t,S.t,D),i(T.t,T.t,k),e(o.t,o.t,S.t),e(o.t,o.t,T.t),b&&(s(S.i,P.i,A.i),s(T.i,j.i,O.i),i(S.i,S.i,D),i(T.i,T.i,k),e(o.i,o.i,S.i),e(o.i,o.i,T.i))}const M=t=>{const n=2*t.t.x-t.i.x,e=2*t.t.y-t.i.y;o(t.i,t.t.x,t.t.y),o(t.t,n,e)};let x=0,g=[];function m(t){return t&&"object"==typeof t&&"number"==typeof t.id}class k{constructor(t){this.h=t,this.l=k.hash(this.h),this.u=new Set}p(t){this.u.add(t)}v(t,n){const o=n.map(t=>t.M);this.h.every(t=>o.indexOf(t)>-1)&&!this.u.has(t)&&this.u.add(t)}g(t,n){const o=n.map(t=>t.M);this.h.every(t=>o.indexOf(t)>-1)&&this.u.has(t)&&this.u.delete(t)}static hash(t){return t.slice().sort().join("|")}}const D=33.3333333,E=new class{constructor(){this.m=1,this.u=new Map,this.k=new Map,this.D=new Set}F(t){const n={id:this.m++};return this.u.set(n,t),this.k.forEach(o=>o.v(n,t)),n}P(t){this.D.add(t)}j(t){return this.D.has(t)}A(){if(0===this.D.size)return;let t=!1;const n=o=>{o&&"object"==typeof o&&!m(o)&&Object.values(o).forEach(o=>{m(o)?(this.P(o),t=!0):n(o)})};this.D.forEach(t=>{if(this.D.delete(t),!this.u.has(t))return;const o=this.u.get(t);o.forEach(t=>{n(t)}),this.u.delete(t),this.k.forEach(n=>n.g(t,o))}),t&&this.A()}select(t){const n=k.hash(t);if(this.k.has(n))return this.k.get(n).u;const o=new k(t);return this.k.set(o.l,o),this.u.forEach((n,e)=>{let s=!0;for(let o=0;o<t.length;o++){const e=t[o];n.find(t=>t.M===e)||(s=!1)}s&&o.p(e)}),o.u}O(t){return this.select(t).values().next().value}data(t,n){const o=this.u.get(t);if(!o)throw new Error(`Entity(${t}) not found!`);let e;for(let t=0;t<o.length;t++){const s=o[t];s.M===n&&(e=s)}if(!e)throw new Error(`Data(${n}) not found for Entity(${t})!`);return e}S(t){const n=this.O([t]);if(!n)return;return this.data(n,t)}};function F(){return E}const P=document.querySelector.bind(document),j=P("#r"),A=P("#c"),O=P("#u");if(!j||!A||!O)throw new Error("Could not locate DOM!");function S(t,n,o,e){return t.addEventListener(n,o,e),()=>{t.removeEventListener(n,o,e)}}function T(n=0,o=0){return t(n,o)}function W(t){const n=F().S("vp"),o=n.T;return Math.floor(t/n.W*o.width)}function $(t,n){const o=F().S("vp"),{$:e}=o;return W(t-("x"===n?e.target.x:e.target.y))}function H(t){const{H:n}=t.T,{$:o}=t;n.scale(1,-1),n.translate(-W(o.C.x),-W(o.C.y))}function C(t,n,o,e,s){const c=F().S("vp"),{H:i}=c.T;i.save();const r=c.height/e;i.font=r+"px/1.5 monospace",H(c),i.fillStyle=s;let a=W(n.y);t.split("\n").forEach(t=>{const e=i.measureText(t),s=e.width+1,c=e.actualBoundingBoxAscent?e.actualBoundingBoxAscent+e.actualBoundingBoxDescent:1.5*r-r;a+=c,i.fillText(t,"center"===o?W(n.x)-s/2:"left"===o?W(n.x):W(n.x)-s,a)}),i.restore()}function I(){const t=window.innerWidth<window.innerHeight?window.innerWidth:.6*window.innerHeight,n=window.innerWidth<window.innerHeight?window.innerWidth/.6:window.innerHeight;return{M:"vp",ratio:.6,width:t,height:n,W:100,I:100/.6,T:function(t,n,o){const e=o.getContext("2d"),s=window.devicePixelRatio||1;return o.style.width=t+"px",o.style.height=n+"px",o.width=Math.round(t*s),o.height=Math.round(n*s),e.scale(s,s),e.webkitImageSmoothingEnabled=!1,e.msImageSmoothingEnabled=!1,e.mozImageSmoothingEnabled=!1,e.imageSmoothingEnabled=!1,{width:t,height:n,L:o,H:e,R:s}}(t,n,A),$:{C:T(50,50),mode:"center",target:T(0,0)}}}function L(){const t=I(),n=F(),o=n.O(["vp"]);o&&n.P(o);j.style.width=t.width+"px";const e=n=>Math.floor(n/t.W*t.T.L.width);t.T.H.translate(e(t.$.C.x),e(t.$.C.y)),t.T.H.scale(1,-1);const s=[t];n.F(s)}function R(t,n,o,e){const s=n.x-o.x,c=n.y-o.y,i=Math.sin(e),r=Math.cos(e);return t.x=s*r-c*i+o.x,t.y=s*i+c*r+o.y,t}function z(t,n){const{width:o,height:s}=function(t){return{width:t.W,height:Math.min(t.W,t.I)}}(n),c=t.width/2,r=t.height/2,a=n.$.target,h=T(Math.cos(t.N),Math.sin(t.N)),l=i(T(),h,Math.min(o/2,s/2)),u=e(T(),a,l),p=T(u.x,u.y-c),w=T(u.x,u.y+c);return R(p,p,u,t.N),R(w,w,u,t.N),{x:u.x,y:u.y,angle:t.N,U:c,Y:r,q:p,p1:w}}function N(t){const n=F().S("vp"),o=n.T.H,{x:e,y:s,angle:c,Y:i,U:r,q:a,p1:h}=z(t,n);o.save(),o.fillStyle="rgba(255,255,255,1)",o.translate($(e,"x"),$(s,"y")),o.rotate(Math.PI/2+c),o.fillRect(0-W(r),0-W(i),W(t.width),W(t.height)),o.restore(),function(t,n,o){U(t,n.q),U(t,n.p1),t.save(),t.beginPath(),t.strokeStyle="black",t.lineWidth=W(.5),t.moveTo($(n.q.x,"x"),$(n.q.y,"y")),t.lineTo($(n.p1.x,"x"),$(n.p1.y,"y")),t.stroke(),t.restore()}(o,{q:a,p1:h}),function(t,n,o){t.beginPath(),t.fillStyle="blue",t.arc($(n.i.x+(n.t.x-n.i.x)*o,"x"),$(n.i.y+(n.t.y-n.i.y)*o,"y"),W(1),0,2*Math.PI),t.fill()}(o,t.B,1)}function U(t,n,o){t.save(),t.beginPath(),t.fillStyle="blue",t.arc($(n.x,"x"),$(n.y,"y"),W(1),0,2*Math.PI),t.fill(),t.restore()}function Y(t,n){return!!((t,n,e,s,c,i,r,a,h)=>{const l=c-t,u=r/2+e/2-Math.abs(l),p=i-n,w=a/2+s/2-Math.abs(p);if(u<=0)return null;if(w<=0)return null;if(o(h.resolve,0,0),o(h.G,0,0),o(h.J,0,0),u<w){const n=l<0?-1:1;h.resolve.x=u*n,h.J.x=n,h.G.x=t+e/2*n,h.G.y=i}else{const t=p<0?-1:1;h.resolve.y=w*t,h.J.y=t,h.G.x=c,h.G.y=n+s/2*t}return h})(t.B.t.x,t.B.t.y,t.K.x,t.K.y,n.t.x,n.t.y,n.width,n.height,{resolve:T(),G:T(),J:T()})}function q(){const t=F().S("vp"),n={N:0,width:t.W/8,height:t.W/16,B:{o:T(),t:T(),i:T()}},o={t:T(),i:T(),o:T(),width:t.W/16,height:t.W/16},e={B:{t:T(),i:T(),o:T()},K:T(10,10)};return r(T(-10,-10),e.B.t,e.B.i),o.o.x=.1,o.o.y=.1,{V:o,X:n,target:e}}function B(){const t=F().S("vp"),n={N:0,width:t.W/8,height:t.W/16,B:{o:T(),t:T(),i:T()}},o={t:T(),i:T(),o:T(),width:t.W/16,height:t.W/16},e={B:{t:T(),i:T(),o:T()},K:T(10,10)};return r(T(-30,-10),e.B.t,e.B.i),o.o.x=.1,o.o.y=.1,{V:o,X:n,target:e}}window.addEventListener("resize",L);const G={Z:0,_:null,state:"boot",level:-1,tt:{X:null,V:null,target:null}};function J(t){const n=G;n._=n.state,n.state=t,n.Z=0}function K(){}function Q(t){F().S("fps").nt=t}!async function(){await async function(){}();const o=F();L();const s=[],c=[];s.push(t=>{!function(){const t=F().S("vp"),{H:n}=t.T;n.save(),H(t),n.clearRect(0,0,t.T.L.width,t.T.L.height),n.restore()}()});const i=o.S("vp");s.push((function(t,n){switch(G.state){case"boot":break;case"level":{const{target:t,X:o,V:e}=G.tt;if(!t||!o||!e)return;!function(t,n){const o=F().S("vp").T.H,{x:e,y:s}=t.B.t,c=t.K.x/2,i=t.K.y/2;o.save(),o.fillStyle="rgba(128,255,255,1)",o.translate($(e,"x"),$(s,"y")),o.fillRect(0-W(c),0-W(i),W(t.K.x),W(t.K.y)),o.restore()}(t),N(o),function(t,n){const o=F().S("vp").T.H,{t:e,i:s,width:c,height:i}=t,r=c/2,a=i/2,h=$(s.x+n*(e.x-s.x),"x"),l=$(s.y+n*(e.y-s.y),"y"),u=W(c),p=W(i);o.save(),o.fillStyle="rgba(255,255,255,1)",o.fillRect(h-W(r),l-W(a),u,p),o.restore()}(e,n),function(t,n){const o=F().S("vp");C((t.Z*D/1e3).toFixed(3),T(o.W/2,0),"center",44,"yellow"),C(`Level ${t.level} of ??`,T(0,0),"left",44,"yellow")}(G);break}case"win":C("YOU\nWIN",T(t.S("vp").W/2,0),"center",5,"black");break;case"nextlevel":break;case"thanks":console.log("thanks!")}})),c.push((o,s)=>{switch(G.state){case"boot":return console.log("boot"),J("nextlevel");case"level":{if(0===G.Z){const t=[q,B][G.level];if(!t)return J("thanks");G.tt=t()}const{target:t,X:n,V:o}=G.tt;r.ArrowLeft&&(n.N+=.2),r.ArrowRight&&function(t){t.N-=.2}(n);const s=T(.2,0),c=T();let i=0;if(r.w&&r.d?i=Math.PI/4:r.w&&r.a?i=Math.PI*(3/4):r.s&&r.d?i=-Math.PI/4:r.s&&r.a?i=-Math.PI*(3/4):r.w?i=Math.PI/2:r.a?i=Math.PI:r.s?i=-Math.PI/2:r.d&&(i=0),(0!==i||r.d)&&function(t,n){e(t.B.o,t.B.o,n)}(n,R(T(),s,c,i)),Y(t,o))return J("win");break}case"win":0===G.Z&&(c=()=>J("nextlevel"),h=5e3,g.push({id:++x,action:c,delay:h,ot:0}));break;case"nextlevel":{const t=G;return t.level+=1,t.tt.V=null,t.tt.X=null,t.tt.target=null,J("level")}}var c,h;const{target:l,X:u,V:p}=G.tt;l&&u&&p&&(((t,n)=>{const o=(t.i.x-t.t.x)*n,e=(t.i.y-t.t.y)*n;t.i.x=t.t.x+o,t.i.y=t.t.y+e})(u.B,.8),a(u.B,s),M(u.B),function(o,e,s,c){a(o,c);const{q:i,p1:r}=z(e,s),h={t:i,i:n(t(),i),o:t()},l={t:r,i:n(t(),r),o:t()};b(o,2,1,h,-1,l,-1,!1,1),M(o),b(o,1,1,h,-1,l,-1,!0,1)}(p,u,i,s),function(t){const o=F().S("vp");n(o.$.target,t)}(u.B.t)),G.Z+=1});const r={w:!1,a:!1,s:!1,d:!1,ArrowLeft:!1,ArrowRight:!1};S(window,"keydown",t=>{r[t.key]=!0}),S(window,"keyup",t=>{r[t.key]=!1}),o.F([{M:"fps",nt:60}]),s.push(t=>{C(t.S("fps").nt.toFixed(2),T(100,0),"right",44,"yellow")});const{stop:h}=(({et:t,st:n,ct:o,update:e,it:s=10,rt:c=(()=>{}),at:i=(()=>{})})=>{const r=window.performance,a=t,h=n,l=r.now.bind(r),u=window.requestAnimationFrame.bind(window);let p=0,w=null,f=l(),d=l(),v=0,y=60;return function t(){const n=l();w=u(t),p+=n-f,f=n;let r=p-a>=0,b=Math.floor(p/h);if(b>=s)return p=0,f=l(),void c();for(;b-- >0;)p-=h,e(h);r&&o(p/a),v+=1,d+1e3<=n&&(y=.25*v+.75*y,v=0,d=n,i(y))}(),{stop:()=>{w&&cancelAnimationFrame(w)}}})({et:16.6666666,st:D,update:t=>{((t=1)=>{g.slice().forEach((n,o)=>{n.ot+=t,n.ot>=n.delay&&(g.splice(o,1),n.action(n.delay,n.ot))})})(t),c.forEach(n=>n(o,t)),o.A()},ct:t=>{s.forEach(n=>n(o,t))},rt:K,at:Q})}()}();