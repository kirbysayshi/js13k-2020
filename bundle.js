!function(){"use strict";function t(t,n){return{x:t||0,y:n||0}}const n=(t,n)=>(t.x=n.x,t.y=n.y,t),o=(t,n,o)=>(t.x=n,t.y=o,t),e=(t,n,o)=>(t.x=n.x+o.x,t.y=n.y+o.y,t),s=(t,n,o)=>(t.x=n.x-o.x,t.y=n.y-o.y,t),c=(t,n)=>t.x*n.x+t.y*n.y,i=(t,n,o)=>(t.x=n.x*o,t.y=n.y*o,t),r=(t,n)=>{t.t.x+=t.o.x*n*n*.001,t.t.y+=t.o.y*n*n*.001,o(t.o,0,0)},a={x:0,y:0},h={x:0,y:0},u={x:0,y:0},p={x:0,y:0},l=(t,n,c,i,r,l,w,f)=>{const d=((t,n)=>{const o=t.x-n.x,e=t.y-n.y;return o*o+e*e})(t.t,i.t),v=n+r;s(a,t.t,t.i),s(h,i.t,i.i),s(u,t.t,i.t);const M=Math.sqrt(d);let b=(M-v)/M;0===M&&(b=1);const x=c>0?c:1,y=l>0?l:1,g=x+y;if(p.x=u.x*b*(y/g),p.y=u.y*b*(y/g),c>0&&s(t.t,t.t,p),p.x=u.x*b*(x/g),p.y=u.y*b*(x/g),l>0&&e(i.t,i.t,p),!w)return;const m=(f=f||1)*(u.x*a.x+u.y*a.y)/(d||1),k=f*(u.x*h.x+u.y*h.y)/(d||1);a.x+=(k*u.x-m*u.x)/(x||1),h.x+=(m*u.x-k*u.x)/(y||1),a.y+=(k*u.y-m*u.y)/(x||1),h.y+=(m*u.y-k*u.y)/(y||1),c>0&&o(t.i,t.t.x-a.x,t.t.y-a.y),l>0&&o(i.i,i.t.x-h.x,i.t.y-h.y)},w=t(),f=t(),d=t(),v=t();function M(o,r,a,h,u,p,M,b,x){s(f,p.t,h.t),((t,n)=>{const o=n.x,e=n.y;let s=o*o+e*e;s>0&&(s=1/Math.sqrt(s),t.x=n.x*s,t.y=n.y*s)})(w,f),s(d,o.t,h.t);const y=c(f,d),g=c(f,f),m=Math.sqrt(g);if(y<0||y>g)return;const k=y/g,D=1-k;i(v,w,k*m),e(v,v,h.t);if(((t,n)=>{const o=t.x-n.x,e=t.y-n.y;return Math.sqrt(o*o+e*e)})(v,o.t)>r)return;const E=D*a,F=k*a,P={t:t(),i:t()},$={t:t(),i:t()};i(P.t,w,k*m),s(P.t,o.t,P.t),i(P.i,w,k*m),s(P.i,o.i,P.i),i($.t,w,D*m),e($.t,o.t,$.t),i($.i,w,D*m),e($.i,o.i,$.i);const j={t:t(),i:t()},A={t:t(),i:t()};n(j.t,P.t),n(j.i,P.i),n(A.t,$.t),n(A.i,$.i);l(P,r,E,h,0,u,b,x),l($,r,F,p,0,M,b,x);const O={t:t(),i:t()},S={t:t(),i:t()};s(O.t,P.t,j.t),s(S.t,$.t,A.t),i(O.t,O.t,D),i(S.t,S.t,k),e(o.t,o.t,O.t),e(o.t,o.t,S.t),b&&(s(O.i,P.i,j.i),s(S.i,$.i,A.i),i(O.i,O.i,D),i(S.i,S.i,k),e(o.i,o.i,O.i),e(o.i,o.i,S.i))}const b=t=>{const n=2*t.t.x-t.i.x,e=2*t.t.y-t.i.y;o(t.i,t.t.x,t.t.y),o(t.t,n,e)};let x=0,y=[];function g(t){return t&&"object"==typeof t&&"number"==typeof t.id}class m{constructor(t){this.h=t,this.u=m.hash(this.h),this.p=new Set}l(t){this.p.add(t)}v(t,n){const o=n.map(t=>t.M);this.h.every(t=>o.indexOf(t)>-1)&&!this.p.has(t)&&this.p.add(t)}g(t,n){const o=n.map(t=>t.M);this.h.every(t=>o.indexOf(t)>-1)&&this.p.has(t)&&this.p.delete(t)}static hash(t){return t.slice().sort().join("|")}}const k=new class{constructor(){this.m=1,this.p=new Map,this.k=new Map,this.D=new Set}F(t){const n={id:this.m++};return this.p.set(n,t),this.k.forEach(o=>o.v(n,t)),n}P(t){this.D.add(t)}$(t){return this.D.has(t)}j(){if(0===this.D.size)return;let t=!1;const n=o=>{o&&"object"==typeof o&&!g(o)&&Object.values(o).forEach(o=>{g(o)?(this.P(o),t=!0):n(o)})};this.D.forEach(t=>{if(this.D.delete(t),!this.p.has(t))return;const o=this.p.get(t);o.forEach(t=>{n(t)}),this.p.delete(t),this.k.forEach(n=>n.g(t,o))}),t&&this.j()}select(t){const n=m.hash(t);if(this.k.has(n))return this.k.get(n).p;const o=new m(t);return this.k.set(o.u,o),this.p.forEach((n,e)=>{let s=!0;for(let o=0;o<t.length;o++){const e=t[o];n.find(t=>t.M===e)||(s=!1)}s&&o.l(e)}),o.p}A(t){return this.select(t).values().next().value}data(t,n){const o=this.p.get(t);if(!o)throw new Error(`Entity(${t}) not found!`);let e;for(let t=0;t<o.length;t++){const s=o[t];s.M===n&&(e=s)}if(!e)throw new Error(`Data(${n}) not found for Entity(${t})!`);return e}O(t){const n=this.A([t]);if(!n)return;return this.data(n,t)}};function D(){return k}const E=document.querySelector.bind(document),F=E("#r"),P=E("#c"),$=E("#u");if(!F||!P||!$)throw new Error("Could not locate DOM!");function j(t,n,o,e){return t.addEventListener(n,o,e),()=>{t.removeEventListener(n,o,e)}}function A(n=0,o=0){return t(n,o)}function O(t){const n=D().O("vp"),o=n.S;return Math.floor(t/n.T*o.width)}function S(t,n){const o=D().O("vp"),{W:e}=o;return O(t-("x"===n?e.target.x:e.target.y))}function T(t){const{H:n}=t.S,{W:o}=t;n.scale(1,-1),n.translate(-O(o.C.x),-O(o.C.y))}function W(){const t=window.innerWidth<window.innerHeight?window.innerWidth:.6*window.innerHeight,n=window.innerWidth<window.innerHeight?window.innerWidth/.6:window.innerHeight;return{M:"vp",ratio:.6,width:t,height:n,T:100,I:100/.6,S:function(t,n,o){const e=o.getContext("2d"),s=window.devicePixelRatio||1;return o.style.width=t+"px",o.style.height=n+"px",o.width=Math.round(t*s),o.height=Math.round(n*s),e.scale(s,s),e.webkitImageSmoothingEnabled=!1,e.msImageSmoothingEnabled=!1,e.mozImageSmoothingEnabled=!1,e.R=!1,{width:t,height:n,L:o,H:e,N:s}}(t,n,P),W:{C:A(50,50),mode:"center",target:A(0,0)}}}function H(){const t=W(),n=D(),o=n.A(["vp"]);o&&n.P(o);F.style.width=t.width+"px";const e=n=>Math.floor(n/t.T*t.S.L.width);t.S.H.translate(e(t.W.C.x),e(t.W.C.y)),t.S.H.scale(1,-1);const s=[t];n.F(s)}function C(t,n,o,e){const s=n.x-o.x,c=n.y-o.y,i=Math.sin(e),r=Math.cos(e);return t.x=s*r-c*i+o.x,t.y=s*i+c*r+o.y,t}function I(t,n){const{width:o,height:s}=function(t){return{width:t.T,height:Math.min(t.T,t.I)}}(n),c=t.width/2,r=t.height/2,a=n.W.target,h=A(Math.cos(t.U),Math.sin(t.U)),u=i(A(),h,Math.min(o/2,s/2)),p=e(A(),a,u),l=A(p.x,p.y-c),w=A(p.x,p.y+c);return C(l,l,p,t.U),C(w,w,p,t.U),{x:p.x,y:p.y,angle:t.U,Y:c,q:r,B:l,p1:w}}function R(t){const n=D().O("vp"),o=n.S.H,{x:e,y:s,angle:c,q:i,Y:r,B:a,p1:h}=I(t,n);o.save(),o.fillStyle="rgba(255,255,255,1)",o.translate(S(e,"x"),S(s,"y")),o.rotate(Math.PI/2+c),o.fillRect(0-O(r),0-O(i),O(t.width),O(t.height)),o.restore(),function(t,n,o){z(t,n.B),z(t,n.p1),t.save(),t.beginPath(),t.strokeStyle="black",t.lineWidth=O(.5),t.moveTo(S(n.B.x,"x"),S(n.B.y,"y")),t.lineTo(S(n.p1.x,"x"),S(n.p1.y,"y")),t.stroke(),t.restore()}(o,{B:a,p1:h}),function(t,n,o){t.beginPath(),t.fillStyle="blue",t.arc(S(n.i.x+(n.t.x-n.i.x)*o,"x"),S(n.i.y+(n.t.y-n.i.y)*o,"y"),O(1),0,2*Math.PI),t.fill()}(o,t.G,1)}function z(t,n,o){t.save(),t.beginPath(),t.fillStyle="blue",t.arc(S(n.x,"x"),S(n.y,"y"),O(1),0,2*Math.PI),t.fill(),t.restore()}function L(t,n){return!!((t,n,e,s,c,i,r,a,h)=>{const u=c-t,p=r/2+e/2-Math.abs(u),l=i-n,w=a/2+s/2-Math.abs(l);if(p<=0)return null;if(w<=0)return null;if(o(h.resolve,0,0),o(h.J,0,0),o(h.K,0,0),p<w){const n=u<0?-1:1;h.resolve.x=p*n,h.K.x=n,h.J.x=t+e/2*n,h.J.y=i}else{const t=l<0?-1:1;h.resolve.y=w*t,h.K.y=t,h.J.x=c,h.J.y=n+s/2*t}return h})(t.G.t.x,t.G.t.y,t.V.x,t.V.y,n.t.x,n.t.y,n.width,n.height,{resolve:A(),J:A(),K:A()})}window.addEventListener("resize",H);const N={X:0,Z:null,state:"boot",level:0,_:{tt:null,nt:null,target:null}};function U(t){const n=N;n.Z=n.state,n.state=t,n.X=0}function Y(){}function q(t){D().O("fps").ot=t}!async function(){await async function(){}();const o=D();H();const s=[],c=[];s.push(t=>{!function(){const t=D().O("vp"),{H:n}=t.S;n.save(),T(t),n.clearRect(0,0,t.S.L.width,t.S.L.height),n.restore()}()});const i=o.O("vp");s.push((function(t,n){switch(N.state){case"boot":break;case"level":{const{target:t,tt:o,nt:e}=N._;if(!t||!o||!e)return;!function(t,n){const o=D().O("vp").S.H,{x:e,y:s}=t.G.t,c=t.V.x/2,i=t.V.y/2;o.save(),o.fillStyle="rgba(128,255,255,1)",o.translate(S(e,"x"),S(s,"y")),o.fillRect(0-O(c),0-O(i),O(t.V.x),O(t.V.y)),o.restore()}(t),R(o),function(t,n){const o=D().O("vp").S.H,{t:e,i:s,width:c,height:i}=t,r=c/2,a=i/2,h=S(s.x+n*(e.x-s.x),"x"),u=S(s.y+n*(e.y-s.y),"y"),p=O(c),l=O(i);o.save(),o.fillStyle="rgba(255,255,255,1)",o.fillRect(h-O(r),u-O(a),p,l),o.restore()}(e,n);break}case"win":{const n=t.O("vp"),{H:o}=n.S;o.save();const e=5,s=n.height/e,c=1.5;o.font=`${s}px/${c} monospace`;const i="YOU\nWIN";T(n),o.fillStyle="black";let r=0;i.split("\n").forEach(t=>{const e=o.measureText(t),i=e.width+1,a=e.actualBoundingBoxAscent?e.actualBoundingBoxAscent+e.actualBoundingBoxDescent:s*c-s;r+=a,o.fillText(t,O(n.T/2)-i/2,r)}),o.restore();break}}})),c.push((o,s)=>{switch(N.state){case"boot":return console.log("boot"),U("nextlevel");case"level":{0===N.X&&(N._=function(){const t=D().O("vp"),n={U:0,width:t.T/8,height:t.T/16,G:{o:A(),t:A(),i:A()}},o={t:A(),i:A(),o:A(),width:t.T/16,height:t.T/16},e={G:{t:A(-10,-10),i:A(-10,-10),o:A()},V:A(10,10)};return o.o.x=.1,o.o.y=.1,{nt:o,tt:n,target:e}}());const{target:t,tt:n,nt:o}=N._;a.ArrowLeft&&(n.U+=.2),a.ArrowRight&&function(t){t.U-=.2}(n);const s=A(.2,0),c=A();let i=0;if(a.w&&a.d?i=Math.PI/4:a.w&&a.a?i=Math.PI*(3/4):a.s&&a.d?i=-Math.PI/4:a.s&&a.a?i=-Math.PI*(3/4):a.w?i=Math.PI/2:a.a?i=Math.PI:a.s?i=-Math.PI/2:a.d&&(i=0),(0!==i||a.d)&&function(t,n){e(t.G.o,t.G.o,n)}(n,C(A(),s,c,i)),L(t,o))return U("win");break}case"win":0===N.X&&(c=()=>U("nextlevel"),h=5e3,y.push({id:++x,action:c,et:h,st:0}));break;case"nextlevel":return N.level+=1,U("level")}var c,h;const{target:u,tt:p,nt:l}=N._;u&&p&&l&&(((t,n)=>{const o=(t.i.x-t.t.x)*n,e=(t.i.y-t.t.y)*n;t.i.x=t.t.x+o,t.i.y=t.t.y+e})(p.G,.8),r(p.G,s),b(p.G),function(o,e,s,c){r(o,c);const{B:i,p1:a}=I(e,s),h={t:i,i:n(t(),i),o:t()},u={t:a,i:n(t(),a),o:t()};M(o,2,1,h,-1,u,-1,!1,1),b(o),M(o,1,1,h,-1,u,-1,!0,1)}(l,p,i,s),function(t){const o=D().O("vp");n(o.W.target,t)}(p.G.t)),N.X+=1});const a={w:!1,a:!1,s:!1,d:!1,ArrowLeft:!1,ArrowRight:!1};j(window,"keydown",t=>{a[t.key]=!0}),j(window,"keyup",t=>{a[t.key]=!1}),o.F([{M:"fps",ot:60}]),s.push(t=>{const n=t.O("vp"),o=t.O("fps").ot.toFixed(2),e=n.height/44,{H:s}=n.S;s.save(),s.fillStyle="rgba(255,255,0,1)",s.font=e+"px/1.5 monospace";const c=s.measureText(o),i=c.width+1,r=c.actualBoundingBoxAscent?c.actualBoundingBoxAscent+c.actualBoundingBoxDescent:1.5*e-e;T(n),s.fillText(o,O(n.T)-i,0+r),s.restore()});const{stop:h}=(({ct:t,it:n,rt:o,update:e,at:s=10,ht:c=(()=>{}),ut:i=(()=>{})})=>{const r=window.performance,a=t,h=n,u=r.now.bind(r),p=window.requestAnimationFrame.bind(window);let l=0,w=null,f=u(),d=u(),v=0,M=60;return function t(){const n=u();w=p(t),l+=n-f,f=n;let r=l-a>=0,b=Math.floor(l/h);if(b>=s)return l=0,f=u(),void c();for(;b-- >0;)l-=h,e(h);r&&o(l/a),v+=1,d+1e3<=n&&(M=.25*v+.75*M,v=0,d=n,i(M))}(),{stop:()=>{w&&cancelAnimationFrame(w)}}})({ct:1e3/60,it:1e3/30,update:t=>{((t=1)=>{y.slice().forEach((n,o)=>{n.st+=t,n.st>=n.et&&(y.splice(o,1),n.action(n.et,n.st))})})(t),c.forEach(n=>n(o,t)),o.j()},rt:t=>{s.forEach(n=>n(o,t))},ht:Y,ut:q})}()}();